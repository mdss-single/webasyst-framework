var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,c){a.raw=c;return a};$jscomp.arrayIteratorImpl=function(a){var c=0;return function(){return c<a.length?{done:!1,value:a[c++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var c="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return c?c.call(a):$jscomp.arrayIterator(a)};
$jscomp.arrayFromIterator=function(a){for(var c,e=[];!(c=a.next()).done;)e.push(c.value);return e};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.findInternal=function(a,c,e){a instanceof String&&(a=String(a));for(var f=a.length,h=0;h<f;h++){var b=a[h];if(c.call(e,b,h,a))return{i:h,v:b}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;
$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,e){if(a==Array.prototype||a==Object.prototype)return a;a[c]=e.value;return a};
$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var c=0;c<a.length;++c){var e=a[c];if(e&&e.Math==Math)return e}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,c){var e=$jscomp.propertyToPolyfillSymbol[c];if(null==e)return a[c];e=a[e];return void 0!==e?e:a[c]};$jscomp.polyfill=function(a,c,e,f){c&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,c,e,f):$jscomp.polyfillUnisolated(a,c,e,f))};
$jscomp.polyfillUnisolated=function(a,c,e,f){e=$jscomp.global;a=a.split(".");for(f=0;f<a.length-1;f++){var h=a[f];if(!(h in e))return;e=e[h]}a=a[a.length-1];f=e[a];c=c(f);c!=f&&null!=c&&$jscomp.defineProperty(e,a,{configurable:!0,writable:!0,value:c})};
$jscomp.polyfillIsolated=function(a,c,e,f){var h=a.split(".");a=1===h.length;f=h[0];f=!a&&f in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var b=0;b<h.length-1;b++){var d=h[b];if(!(d in f))return;f=f[d]}h=h[h.length-1];e=$jscomp.IS_SYMBOL_NATIVE&&"es6"===e?f[h]:null;c=c(e);null!=c&&(a?$jscomp.defineProperty($jscomp.polyfills,h,{configurable:!0,writable:!0,value:c}):c!==e&&(void 0===$jscomp.propertyToPolyfillSymbol[h]&&($jscomp.propertyToPolyfillSymbol[h]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(h):
$jscomp.POLYFILL_PREFIX+h),$jscomp.defineProperty(f,$jscomp.propertyToPolyfillSymbol[h],{configurable:!0,writable:!0,value:c})))};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(c,e){return $jscomp.findInternal(this,c,e).v}},"es6","es3");$jscomp.owns=function(a,c){return Object.prototype.hasOwnProperty.call(a,c)};
$jscomp.assign=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.assign?Object.assign:function(a,c){for(var e=1;e<arguments.length;e++){var f=arguments[e];if(f)for(var h in f)$jscomp.owns(f,h)&&(a[h]=f[h])}return a};$jscomp.polyfill("Object.assign",function(a){return a||$jscomp.assign},"es6","es3");$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(a){if(a)return a;var c=function(h,b){this.$jscomp$symbol$id_=h;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:b})};c.prototype.toString=function(){return this.$jscomp$symbol$id_};var e=0,f=function(h){if(this instanceof f)throw new TypeError("Symbol is not a constructor");return new c("jscomp_symbol_"+(h||"")+"_"+e++,h)};return f},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var c="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),e=0;e<c.length;e++){var f=$jscomp.global[c[e]];"function"===typeof f&&"function"!=typeof f.prototype[a]&&$jscomp.defineProperty(f.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return a},"es6",
"es3");$jscomp.iteratorPrototype=function(a){a={next:a};a[Symbol.iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,c){a instanceof String&&(a+="");var e=0,f=!1,h={next:function(){if(!f&&e<a.length){var b=e++;return{value:c(b,a[b]),done:!1}}f=!0;return{done:!0,value:void 0}}};h[Symbol.iterator]=function(){return h};return h};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(c){return c})}},"es6","es3");
$jscomp.polyfill("Array.from",function(a){return a?a:function(c,e,f){e=null!=e?e:function(g){return g};var h=[],b="undefined"!=typeof Symbol&&Symbol.iterator&&c[Symbol.iterator];if("function"==typeof b){c=b.call(c);for(var d=0;!(b=c.next()).done;)h.push(e.call(f,b.value,d++))}else for(b=c.length,d=0;d<b;d++)h.push(e.call(f,c[d],d));return h}},"es6","es3");$jscomp.polyfill("Object.is",function(a){return a?a:function(c,e){return c===e?0!==c||1/c===1/e:c!==c&&e!==e}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(c,e){var f=this;f instanceof String&&(f=String(f));var h=f.length;e=e||0;for(0>e&&(e=Math.max(e+h,0));e<h;e++){var b=f[e];if(b===c||Object.is(b,c))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(a,c,e){if(null==a)throw new TypeError("The 'this' value for String.prototype."+e+" must not be null or undefined");if(c instanceof RegExp)throw new TypeError("First argument to String.prototype."+e+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(c,e){return-1!==$jscomp.checkStringArgs(this,c,"includes").indexOf(c,e||0)}},"es6","es3");$.wa=$.ui?$.extend(!0,$.wa,$.ui):{};
$.wa=$.extend(!0,$.wa,{data:{},content:!1,get:function(a,c){return void 0==a?this.data:this.data[name]||c||null},set:function(a,c){if(void 0==a)return this.data;"object"==typeof a?$.extend(this.data,a):this.data[a]=value;return this.data},encodeHTML:function(a){return a&&(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},decodeHTML:function(a){return a.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">")},setHash:function(a){a instanceof String||!a.toString||(a=a.toString());
a=a.replace(/\/\//g,"/");a=a.replace(/^.*#/,"");$.browser&&$.browser.safari?parent?parent.window.location=parent.window.location.href.replace(/#.*/,"")+"#"+a:window.location=location.href.replace(/#.*/,"")+"#"+a:!parent||$.browser&&$.browser.msie?location.hash=a:parent.window.location.hash=a;return!0},back:function(a){2<history.length?"number"==typeof a&&parseInt(a)==a?history.go(-a):history.go(-1):$.browser.msie&&0<history.length?history.back():a&&this.setHash(a);return!1},toggleHashParam:function(a){-1==
location.hash.search(a)?this.addToHash(a):this.removeFromHash(a)},addToHash:function(a){var c=location.hash;-1==c.search(a)&&(c+="/"+a+"/");this.setHash(c)},removeFromHash:function(a){var c=location.hash;-1<c.search(a)&&(c=c.replace(a,""));this.setHash(c)},setTitle:function(a){document.title=a},array_search:function(a,c,e){e=!!e;for(var f in c)if(e&&c[f]===a||!e&&c[f]==a)return f;return!1},dialogCreate:function(a,c){c=$.extend({content:'<h1>Loading... <i class="icon16 loading"></i></h1>',buttons:null,
url:null,post:null,small:!1,onload:null,oncancel:null},c);c.content=$(c.content);c.buttons=c.buttons?$(c.buttons):$('<input type="submit" class="button gray" value="'+$_("Cancel")+'">').click(function(){c.oncancel&&c.oncancel.call(e[0]);$.wa.dialogHide()});var e=$("#"+a);0>=e.size()&&(e=$('<div class="dialog" id="'+a+'" style="display: none"><div class="dialog-background"></div><div class="dialog-window"><div class="dialog-content"><div class="dialog-content-indent"></div></div><div class="dialog-buttons"><div class="dialog-buttons-gradient"></div></div></div></div>').appendTo("body"));
e.find(".dialog-buttons-gradient").empty().append(c.buttons);e.find(".dialog-content-indent").empty().append(c.content);e.show();c.small?e.addClass("small"):e.removeClass("small");c.url&&(a=function(h){e.find(".dialog-content-indent").html(h);$.wa.waCenterDialog(e);c.onload&&c.onload.call(e[0])},c.post?$.post(c.url,c.post,a):$.get(c.url,a));this.waCenterDialog(e);var f=function(h){if(e.is(":visible"))if(h&&27==h.keyCode)c.oncancel&&"function"==typeof c.oncancel&&c.oncancel.call(e[0]),$.wa.dialogHide();
else $(document).one("keyup",f)};f();$(document).one("hashchange",$.wa.dialogHide);return e},waCenterDialog:function(a){a=$(a);a=a.find(".dialog-window");var c=a.outerWidth(!0),e=a.outerHeight(!0),f=$(window).width(),h=$(window).height();a.css({left:Math.round((f-c)/2/f*100)+"%",top:Math.round((h-e)/2/h*100)+"%"})},dialogHide:function(){$(".dialog").hide();return!1},dropdownsClose:function(){var a=$(".dropdown:not(.disabled)");a.addClass("disabled");setTimeout(function(){a.removeClass("disabled")},
600)},dropdownsCloseEnable:function(){$(document).on("click",".dropdown:not(.disabled)",this.dropdownsClickHandler)},dropdownsCloseDisable:function(){$(document).off("click",".dropdown:not(.disabled)",this.dropdownsClickHandler)},dropdownsClickHandler:function(a){var c=$(this);c.hasClass("no-click-close")||(c.addClass("disabled"),setTimeout(function(){c.removeClass("disabled")},600))},defaultInputValue:function(a,c,e){a instanceof jQuery||(a=$(a));var f=function(){var h=a.val();h&&h!=c||(a.val(c),
a.addClass(e))};f();a.blur(f);a.focus(function(){a.hasClass(e)&&(a.removeClass(e),a.val(""))})},loadFiles:function(a){$.isArray(a)||(a="object"!==typeof a||$.isArray(a)?[].slice.apply(arguments):$.map(a,function(e,f){return e?f:null}));var c=a.map(function(e){return e?"string"!=typeof e?"object"===typeof e&&"function"===typeof e.then?e:null:e.match(/\.css(\?.*)?$/)?($("<link>").appendTo("head").attr({type:"text/css",rel:"stylesheet",href:e}),null):$.ajax({cache:!0,dataType:"script",url:e}):null}).filter(function(e){return!!e});
return $.when.apply($,c)},determineTimezone:function(a,c){var e=!1;$.each(document.cookie.split(/;\s*/g),function(h,b){b=b.split("=",2);if("tz"==b[0])return e=!0,c&&c(b[1]),!1});if(!e){var f={};f[a+"wa-content/js/jstz/jstz.min.js"]=!window.jstz;$.wa.loadFiles(f).then(function(){var h=window.jstz.determine().name();document.cookie="tz="+jstz.determine().name()+"; sameSite=LAX";var b=new Date;b.setTime(b.getTime()+12096E5);document.cookie="oldtz="+h+"; expires="+b.toUTCString()+"; sameSite=LAX";c&&
c(h)})}},util:{formatFileSize:function(a){var c=-1;do a/=1024,c++;while(99<a);return Math.max(a,.01).toFixed(2)+(0<=c?" "+$_("kB MB GB TB PB EB".split(" ")[c]):"")}}});
window.wa_skip_ajax_setup||($.ajaxSetup({cache:!1}),$(document).ajaxError(function(a,c,e,f){if(502===c.status&&"abort"==f||e.url&&0<=e.url.indexOf("background_process")||e.data&&0<=e.data.indexOf("background_process"))console&&console.log&&console.log("Notice: XHR failed on load: "+e.url);else if(200!==c.status&&c.responseText){if(!$.wa.errorHandler||$.wa.errorHandler(c))-1!=c.responseText.indexOf("Exception")?$.wa.dialogCreate("ajax-error",{content:"<div>"+c.responseText+"</div>"}):(document.open("text/html"),
document.write(c.responseText),document.close(),$(window).one("hashchange",function(){window.location.reload()}))}else c.getResponseHeader("wa-session-expired")?window.location.reload():"undefined"!==typeof c.responseText&&-1!=c.responseText.indexOf("Exception")&&$.wa.dialogCreate("ajax-error",{content:"<div>"+c.responseText+"</div>"})}));
window.wa_skip_csrf_prefilter||$.ajaxPrefilter(function(a,c,e){a.crossDomain||"POST"!==(a.type||"").toUpperCase()||(c=document.cookie.match(/(?:^|; )_csrf=([^;]*)/))&&c[1]&&(c=decodeURIComponent(c[1]),a.data||0===a.data||(a.data=""),"string"==typeof a.data?-1==a.data.indexOf("_csrf=")&&(a.data+=(0<a.data.length?"&":"")+"_csrf="+c,e.setRequestHeader("Content-type","application/x-www-form-urlencoded")):"object"==typeof a.data&&(window.FormData&&a.data instanceof window.FormData?"function"==typeof a.data.set?
a.data.set("_csrf",c):a.data.append("_csrf",c):a.data._csrf=c))});Array.prototype.indexOf||(Array.prototype.indexOf=function(a,c){var e=this.length;c=Number(c)||0;c=0>c?Math.ceil(c):Math.floor(c);for(0>c&&(c+=e);c<e;c++)if(c in this&&this[c]===a)return c;return-1});$.wa.locale=$.wa.locale||{};
$_=function(a,c){if(!$||!$.wa||!$.wa.locale)return console.log("JS localization failed: empty $.wa.locale"),"string"===typeof c?c:a;if(c){if(!$.wa.locale[c])return console&&console.log("JS localization failed: "+c),c;if("string"==typeof $.wa.locale[c])return $.wa.locale[c];var e=a%10;return 1==Math.floor(a/10)%10||4<e||0==e?$.wa.locale[c][2]:1==e?$.wa.locale[c][0]:$.wa.locale[c][1]}if($.wa.locale[a])return"string"==typeof $.wa.locale[a]?$.wa.locale[a]:$.wa.locale[a][0];console&&console.log("JS localization failed: "+
a);return a};/*
 (c) 2008-2009 Benjamin Arthur Lupton {@link http://www.balupton.com}
 @license GNU Affero General Public License - {@link http://www.gnu.org/licenses/agpl.html}
 @example Visit {@link http://jquery.com/plugins/project/jquery_history_bal} for more information.


 I would like to take this space to thank the following projects, blogs, articles and people:
 - jQuery {@link http://jquery.com/}
 - jQuery UI History - Klaus Hartl {@link http://www.stilbuero.de/jquery/ui_history/}
 - Really Simple History - Brian Dillard and Brad Neuberg {@link http://code.google.com/p/reallysimplehistory/}
 - jQuery History Plugin - Taku Sano (Mikage Sawatari) {@link http://www.mikage.to/jquery/jquery_history.html}
 - jQuery History Remote Plugin - Klaus Hartl {@link http://stilbuero.de/jquery/history/}
 - Content With Style: Fixing the back button and enabling bookmarking for ajax apps - Mike Stenhouse {@link http://www.contentwithstyle.co.uk/Articles/38/fixing-the-back-button-and-enabling-bookmarking-for-ajax-apps}
 - Bookmarks and Back Buttons {@link http://ajax.howtosetup.info/options-and-efficiencies/bookmarks-and-back-buttons/}
 - Ajax: How to handle bookmarks and back buttons - Brad Neuberg {@link http://dev.aol.com/ajax-handling-bookmarks-and-back-button}

*
**
 CHANGELOG
*
 v1.0.1-final, July 11, 2009
 - Restructured a little bit
 - Documented
 - Cleaned go/request

 v1.0.0-final, June 19, 2009
 - Been stable for over a year now, pushing live.

 v0.1.0-dev, July 24, 2008
 - Initial Release

*/
(function(a){"undefined"===typeof console&&(console="undefined"!==typeof window.console?window.console:{});console.log=console.log||function(){};console.debug=console.debug||console.log;console.warn=console.warn||console.log;console.error=console.error||function(){for(var c=[],e=0;e<arguments.length;e++)c.push(arguments[e]);alert(c.join("\n"))};console.trace=console.trace||console.log;console.group=console.group||console.log;console.groupEnd=console.groupEnd||console.log;console.profile=console.profile||
console.log;console.profileEnd=console.profileEnd||console.log;a.History={options:{debug:!1},state:"",$window:null,$iframe:null,handlers:{generic:[],specific:{}},format:function(c){return c=c.replace(/^.+?#/g,"").replace(/^#?\/?|\/?$/g,"")},getState:function(){return a.History.state},setState:function(c){var e=a.History;c=e.format(c);e.state=c;return e.state},getHash:function(){var c=parent&&!a.browser.msie?parent.window.location.hash:window.location.hash||location.hash;return c=a.History.format(c)},
setHash:function(c){c=a.History.format(c);c=c.replace(/^\/?|\/?(\?)|\/?$/g,"/$1");"undefined"===typeof window.location.hash&&(location.hash=c);a.browser.msie&&8>parseInt(a.browser.version,10)&&(a.History.$iframe.contentWindow.document.open(),a.History.$iframe.contentWindow.document.close())},go:function(c){var e=a.History;c=e.format(c);e.getHash()!==c?e.setHash(c):(e.setState(c),e.trigger());return!0},hashchange:function(c){var e=a.History;e.options.debug&&console.debug("History.hashchange",this,
arguments);var f=e.getHash(),h=e.getState();if(!e.$iframe&&h===f||e.$iframe&&e.hash===e.$iframe.contentWindow.document.location.hash||h===f)return!1;e.setState(f);e.trigger();return!0},bind:function(c,e){var f=a.History;e?("undefined"===typeof f.handlers.specific[c]&&(f.handlers.specific[c]=[]),f.handlers.specific[c].push(e)):f.handlers.generic.push(c);return!0},trigger:function(c){var e=a.History;"undefined"===typeof c&&(c=e.getState());var f;if("undefined"!==typeof e.handlers.specific[c]){var h=
e.handlers.specific[c];var b=0;for(f=h.length;b<f;++b){var d=h[b];d(c)}}h=e.handlers.generic;b=0;for(f=h.length;b<f;++b)d=h[b],d(c);return!0},construct:function(){var c=a.History;a(document).ready(function(){c.domReady()});return!0},configure:function(c){var e=a.History;e.options=a.extend(e.options,c);return!0},domReadied:!1,domReady:function(){var c=a.History;if(!c.domRedied)return c.domRedied=!0,c.$window=a(window),c.$window.bind("hashchange",this.hashchange),setTimeout(c.hashchangeLoader,200),
!0},hashchangeLoader:function(){var c=a.History;if(a.browser.msie&&8<=parseInt(a.browser.version))(e=c.getHash())&&c.$window.trigger("hashchange");else{if(a.browser.msie){c.$iframe=a('<iframe id="jquery-history-iframe" style="display: none;"></$iframe>').prependTo(document.body)[0];c.$iframe.contentWindow.document.open();c.$iframe.contentWindow.document.close();var e=c.getHash();e&&(c.$iframe.contentWindow.document.location.hash=e);e=function(){var f=c.format(c.$iframe.contentWindow.document.location.hash);
c.getState()!==f&&c.setHash(c.$iframe.contentWindow.document.location.hash);f=c.getHash();c.getState()!==f&&c.go(f)}}else e=function(){var f=c.getHash();c.getState()!==f&&c.go(f)};a.browser.msie&&8>parseInt(a.browser.version)?setInterval(e,1500):setInterval(e,200)}return!0}};a.History.construct()})(jQuery);jQuery.JSON={useHasOwn:{}.hasOwnProperty?!0:!1,pad:function(a){return 10>a?"0"+a:a},m:{"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},encodeString:function(a){return/["\\\x00-\x1f]/.test(a)?'"'+a.replace(/([\x00-\x1f\\"])/g,function(c,e){if(c=jQuery.JSON.m[e])return c;c=e.charCodeAt();return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16)})+'"':'"'+a+'"'},encodeArray:function(a){var c=["["],e,f=a.length;for(e=0;e<f;e+=1){var h=a[e];switch(typeof h){case "undefined":case "function":case "unknown":break;
default:b&&c.push(",");c.push(null===h?"null":this.encode(h));var b=!0}}c.push("]");return c.join("")},encodeDate:function(a){return'"'+a.getFullYear()+"-"+pad(a.getMonth()+1)+"-"+pad(a.getDate())+"T"+pad(a.getHours())+":"+pad(a.getMinutes())+":"+pad(a.getSeconds())+'"'},encode:function(a){if("undefined"==typeof a||null===a)return"null";if(a instanceof Array)return this.encodeArray(a);if(a instanceof Date)return this.encodeDate(a);if("string"==typeof a)return this.encodeString(a);if("number"==typeof a)return isFinite(a)?
String(a):"null";if("boolean"==typeof a)return String(a);var c=["{"],e;for(e in a)if(!this.useHasOwn||a.hasOwnProperty(e)){var f=a[e];switch(typeof f){case "undefined":case "function":case "unknown":break;default:h&&c.push(",");c.push(this.encode(e),":",null===f?"null":this.encode(f));var h=!0}}c.push("}");return c.join("")},decode:function(a){return eval("("+a+")")}};(function(a,c){a.store=function(e,f){var h=this;if("string"==typeof e)if(a.store.drivers[e])this.driver=a.store.drivers[e];else throw Error("Unknown driver "+e);else if("object"==typeof e){if(!(a.isFunction(e.init)&&a.isFunction(e.get)&&a.isFunction(e.set)&&a.isFunction(e.del)&&a.isFunction(e.flush)))throw Error("The specified driver does not fulfill the API requirements");this.driver=e}else a.each(a.store.drivers,function(){if(!a.isFunction(this.available)||!this.available())return!0;h.driver=this;
return!1===h.driver.init()?(h.driver=null,!0):!1});f||(f=a.store.serializers);this.serializers={};a.each(f,function(b,d){if(!a.isFunction(this.init))return!0;h.serializers[b]=this;h.serializers[b].init(h.encoders,h.decoders)})};a.extend(a.store.prototype,{get:function(e){e=this.driver.get(e);return this.driver.encodes?e:this.unserialize(e)},set:function(e,f){this.driver.set(e,this.driver.encodes?f:this.serialize(f))},del:function(e){this.driver.del(e)},flush:function(){this.driver.flush()},driver:c,
encoders:[],decoders:[],serialize:function(e){var f=this;a.each(this.encoders,function(){var h=f.serializers[this+""];if(!h||!h.encode)return!0;try{e=h.encode(e)}catch(b){}});return e},unserialize:function(e){var f=this;if(!e)return e;a.each(this.decoders,function(){var h=f.serializers[this+""];if(!h||!h.decode)return!0;e=h.decode(e)});return e}});a.store.drivers={localStorage:{ident:"$.store.drivers.localStorage",scope:"browser",available:function(){try{return!!window.localStorage}catch(e){return!1}},
init:a.noop,get:function(e){return window.localStorage.getItem(e)},set:function(e,f){window.localStorage.setItem(e,f)},del:function(e){window.localStorage.removeItem(e)},flush:function(){window.localStorage.clear()}},userData:{ident:"$.store.drivers.userData",element:null,nodeName:"userdatadriver",scope:"browser",initialized:!1,available:function(){try{return!(!document.documentElement||!document.documentElement.addBehavior)}catch(e){return!1}},init:function(){if(!this.initialized)try{this.element=
document.createElement(this.nodeName),document.documentElement.insertBefore(this.element,document.getElementsByTagName("title")[0]),this.element.addBehavior("#default#userData"),this.initialized=!0}catch(e){return!1}},get:function(e){this.element.load(this.nodeName);return this.element.getAttribute(e)},set:function(e,f){this.element.setAttribute(e,f);this.element.save(this.nodeName)},del:function(e){this.element.removeAttribute(e);this.element.save(this.nodeName)},flush:function(){this.element.expires=
(new Date).toUTCString();this.element.save(this.nodeName)}},windowName:{ident:"$.store.drivers.windowName",scope:"window",cache:{},encodes:!0,available:function(){return!0},init:function(){this.load()},save:function(){window.name=a.store.serializers.json.encode(this.cache)},load:function(){try{this.cache=a.store.serializers.json.decode(window.name+""),"object"!=typeof this.cache&&(this.cache={})}catch(e){this.cache={},window.name="{}"}},get:function(e){return this.cache[e]},set:function(e,f){this.cache[e]=
f;this.save()},del:function(e){try{delete this.cache[e]}catch(f){this.cache[e]=c}this.save()},flush:function(){window.name="{}"}}};a.store.serializers={json:{ident:"$.store.serializers.json",init:function(e,f){e.push("json");f.push("json")},encode:"object"==typeof JSON?JSON.stringify:a.JSON.stringify,decode:"object"==typeof JSON?JSON.parse:a.JSON.parse},xml:{ident:"$.store.serializers.xml",init:function(e,f){e.unshift("xml");f.push("xml")},isXML:function(e){return(e=(e?e.ownerDocument||e:0).documentElement)?
"html"!==e.nodeName.toLowerCase():!1},encode:function(e){if(!e||e._serialized||!this.isXML(e))return e;var f={_serialized:this.ident,value:e};try{return f.value=(new XMLSerializer).serializeToString(e),f}catch(h){try{return f.value=e.xml,f}catch(b){}}return e},decode:function(e){if(!e||!e._serialized||e._serialized!=this.ident)return e;var f="DOMParser"in window&&(new DOMParser).parseFromString;!f&&window.ActiveXObject&&(f=function(h){var b=new ActiveXObject("Microsoft.XMLDOM");b.async="false";b.loadXML(h);
return b});if(!f)return c;e.value=f.call("DOMParser"in window&&new DOMParser||window,e.value,"text/xml");return this.isXML(e.value)?e.value:c}}}})(jQuery);(function(a){function c(f,h){this.path=f;"undefined"!==typeof h&&null!==h?(this.at_2x_path=h,this.perform_check=!1):(this.at_2x_path=f.replace(/\.\w+$/,function(b){return"@2x"+b}),this.perform_check=!0)}function e(f){if(!/@2x\.\w+$/.test(a(f).attr("src"))){this.el=f;this.path=new c(a(f).attr("src"),a(f).attr("data-at2x"));var h=this;this.path.check_2x_variant(function(b){b&&h.swap()})}}a.fn.retina=function(f){if(a.Retina.isRetina())return a.Retina.opts=a.extend(a.Retina.opts,f),this.each(function(){a(this).is("img")&&
new e(this)})};a.Retina=function(){};a.Retina.opts={check_mime_type:!0,force_original_dimensions:!0};a.Retina.isRetina=function(){return 1<window.devicePixelRatio||window.matchMedia&&window.matchMedia("(-webkit-min-device-pixel-ratio: 1.5),(min--moz-device-pixel-ratio: 1.5),(-o-min-device-pixel-ratio: 3/2),(min-resolution: 1.5dppx)").matches?!0:!1};c.confirmed_paths=[];c.prototype.is_external=function(){return!(!this.path.match(/^(https?:|\/\/)/i)||this.path.match("//"+document.domain+"/"))};c.prototype.check_2x_variant=
function(f){var h=this;if(this.is_external()||!this.perform_check&&"undefined"!==typeof this.at_2x_path&&null!==this.at_2x_path||this.at_2x_path in c.confirmed_paths)return f(!0);var b=new XMLHttpRequest;b.open("HEAD",this.at_2x_path);b.onreadystatechange=function(){if(4==b.readyState&&200<=b.status&&399>=b.status){if(a.Retina.opts.check_mime_type){var d=b.getResponseHeader("Content-Type");if(null===d||!d.match(/^image/i))return f(!1)}c.confirmed_paths.push(h.at_2x_path);return f(!0)}return f(!1)};
b.send()};a.RetinaImage=e;e.prototype.swap=function(f){function h(){if(b.el.complete){a.Retina.opts.force_original_dimensions&&(b.el.setAttribute("width",b.el.offsetWidth),b.el.setAttribute("height",b.el.offsetHeight));var d=b.el.src;b.el.setAttribute("src",f);a(b.el).one("error",function(){b.el.setAttribute("src",d)})}else setTimeout(h,5)}"undefined"==typeof f&&(f=this.path.at_2x_path);var b=this;h()}})(jQuery);(function(a){var c=[],e=[];a.fn.doAutosize=function(f){var h=a(this).data("minwidth"),b=a(this).data("maxwidth"),d="",g=a(this),l=a("#"+a(this).data("tester_id"));d!==(d=g.val())&&(d=d.replace(/&/g,"&").replace(/\s/g," ").replace(/</g,"<").replace(/>/g,">"),l.html(d),l=l.width(),f=l+f.comfortZone>=h?l+f.comfortZone:h,l=g.width(),(f<l&&f>=h||f>h&&f<b)&&g.width(f))};a.fn.resetAutosize=function(f){var h=a(this).data("minwidth")||f.minInputWidth||a(this).width();f=a(this).data("maxwidth")||f.maxInputWidth||
a(this).closest(".tagsinput").width()-f.inputPadding;var b=a(this),d=a("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:b.css("fontSize"),fontFamily:b.css("fontFamily"),fontWeight:b.css("fontWeight"),letterSpacing:b.css("letterSpacing"),whiteSpace:"nowrap"}),g=a(this).attr("id")+"_autosize_tester";0< !a("#"+g).length&&(d.attr("id",g),d.appendTo("body"));b.data("minwidth",h);b.data("maxwidth",f);b.data("tester_id",g);b.css("width",h)};a.fn.addTag=function(f,h){h=jQuery.extend({focus:!1,
callback:!0},h);this.each(function(){var b=a(this).attr("id"),d=a(this).val().split(c[b]);""==d[0]&&(d=[]);f=jQuery.trim(f);if(h.unique){var g=a(d).tagExist(f);1==g&&a("#"+b+"_tag").addClass("not_valid")}else g=!1;if(""!=f&&1!=g&&(a("<span>").addClass("tag").append(a("<span>").text(f).append("\u00a0\u00a0"),a("<a>",{href:"#",title:"Removing tag",text:"x"}).click(function(){return a("#"+b).removeTag(escape(f))})).insertBefore("#"+b+"_addTag"),d.push(f),a("#"+b+"_tag").val(""),h.focus?a("#"+b+"_tag").focus():
a("#"+b+"_tag").blur(),a.fn.tagsInput.updateTagsField(this,d),h.callback&&e[b]&&e[b].onAddTag&&(g=e[b].onAddTag,g.call(this,f)),e[b]&&e[b].onChange)){var l=d.length;g=e[b].onChange;g.call(this,a(this),d[l-1])}});return!1};a.fn.removeTag=function(f){f=unescape(f);this.each(function(){var h=a(this).attr("id"),b=a(this).val().split(c[h]);a("#"+h+"_tagsinput .tag").remove();str="";for(var d=0;d<b.length;d++)b[d]!=f&&(str=str+c[h]+b[d]);a.fn.tagsInput.importTags(this,str);e[h]&&e[h].onRemoveTag&&e[h].onRemoveTag.call(this,
f)});return!1};a.fn.tagExist=function(f){return 0<=jQuery.inArray(f,a(this))};a.fn.importTags=function(f){id=a(this).attr("id");a("#"+id+"_tagsinput .tag").remove();a.fn.tagsInput.importTags(this,f)};a.fn.tagsInput=function(f){var h=jQuery.extend({interactive:!0,defaultText:"add a tag",minChars:0,width:"300px",height:"100px",autocomplete:{selectFirst:!1},hide:!0,delimiter:",",unique:!0,removeWithBackspace:!0,placeholderColor:"#666666",autosize:!0,comfortZone:20,inputPadding:12},f);this.each(function(){h.hide&&
a(this).hide();var b=a(this).attr("id"),d=jQuery.extend({pid:b,real_input:"#"+b,holder:"#"+b+"_tagsinput",input_wrapper:"#"+b+"_addTag",fake_input:"#"+b+"_tag"},h);c[b]=d.delimiter;if(h.onAddTag||h.onRemoveTag||h.onChange)e[b]=[],e[b].onAddTag=h.onAddTag,e[b].onRemoveTag=h.onRemoveTag,e[b].onChange=h.onChange;var g='<div id="'+b+'_tagsinput" class="tagsinput"><div id="'+b+'_addTag">';h.interactive&&(g=g+'<input id="'+b+'_tag" value="" data-default="'+h.defaultText+'" />');a(g+'</div><div class="tags_clear"></div></div>').insertAfter(this);
a(d.holder).css("width",h.width);a(d.holder).css("height",h.height);""!=a(d.real_input).val()&&a.fn.tagsInput.importTags(a(d.real_input),a(d.real_input).val());if(h.interactive){a(d.fake_input).val(a(d.fake_input).attr("data-default"));a(d.fake_input).css("color",h.placeholderColor);a(d.fake_input).resetAutosize(h);a(d.holder).bind("click",d,function(l){a(l.data.fake_input).focus()});a(d.fake_input).bind("focus",d,function(l){a(l.data.fake_input).val()==a(l.data.fake_input).attr("data-default")&&
a(l.data.fake_input).val("");a(l.data.fake_input).css("color","#000000")});if(void 0!=h.autocomplete_url){autocomplete_options={source:h.autocomplete_url};for(attrname in h.autocomplete)autocomplete_options[attrname]=h.autocomplete[attrname];void 0!==jQuery.Autocompleter?(a(d.fake_input).autocomplete(h.autocomplete_url,h.autocomplete),a(d.fake_input).bind("result",d,function(l,q,n){q&&a("#"+b).addTag(q[0]+"",{focus:!0,unique:h.unique})})):void 0!==jQuery.ui.autocomplete&&(a(d.fake_input).autocomplete(autocomplete_options),
a(d.fake_input).bind("autocompleteselect",d,function(l,q){a(l.data.real_input).addTag(q.item.value,{focus:!0,unique:h.unique});return!1}))}else a(d.fake_input).bind("blur",d,function(l){var q=a(this).attr("data-default");""!=a(l.data.fake_input).val()&&a(l.data.fake_input).val()!=q?l.data.minChars<=a(l.data.fake_input).val().length&&(!l.data.maxChars||l.data.maxChars>=a(l.data.fake_input).val().length)&&a(l.data.real_input).addTag(a(l.data.fake_input).val(),{focus:!0,unique:h.unique}):(a(l.data.fake_input).val(a(l.data.fake_input).attr("data-default")),
a(l.data.fake_input).css("color",h.placeholderColor));return!1});a(d.fake_input).bind("keypress",d,function(l){if(l.which==l.data.delimiter.charCodeAt(0)||13==l.which)return l.preventDefault(),l.data.minChars<=a(l.data.fake_input).val().length&&(!l.data.maxChars||l.data.maxChars>=a(l.data.fake_input).val().length)&&a(l.data.real_input).addTag(a(l.data.fake_input).val(),{focus:!0,unique:h.unique}),a(l.data.fake_input).resetAutosize(h),!1;l.data.autosize&&a(l.data.fake_input).doAutosize(h)});d.removeWithBackspace&&
a(d.fake_input).bind("keydown",function(l){if(8==l.keyCode&&""==a(this).val()){l.preventDefault();l=a(this).closest(".tagsinput").find(".tag:last").text();var q=a(this).attr("id").replace(/_tag$/,"");l=l.replace(/[\s]+x$/,"");a("#"+q).removeTag(escape(l));a(this).trigger("focus")}});a(d.fake_input).blur();d.unique&&a(d.fake_input).keydown(function(l){(8==l.keyCode||String.fromCharCode(l.which).match(/\w+|[\u00e1\u00e9\u00ed\u00f3\u00fa\u00c1\u00c9\u00cd\u00d3\u00da\u00f1\u00d1,\/]+/))&&a(this).removeClass("not_valid")})}return!1});
return this};a.fn.tagsInput.updateTagsField=function(f,h){var b=a(f).attr("id");a(f).val(h.join(c[b]))};a.fn.tagsInput.importTags=function(f,h){a(f).val("");var b=a(f).attr("id");h=h.split(c[b]);for(var d=0;d<h.length;d++)a(f).addTag(h[d],{focus:!1,callback:!1});e[b]&&e[b].onChange&&e[b].onChange.call(f,f,h[d])}})(jQuery);(function(a){a.fn.extend({autocomplete:function(c,e){var f="string"==typeof c;e=a.extend({},a.Autocompleter.defaults,{url:f?c:null,data:f?null:c,delay:f?a.Autocompleter.defaults.delay:10,max:e&&!e.scroll?10:150},e);e.highlight=e.highlight||function(h){return h};e.formatMatch=e.formatMatch||e.formatItem;return this.each(function(){new a.Autocompleter(this,e)})},result:function(c){return this.bind("result",c)},search:function(c){return this.trigger("search",[c])},flushCache:function(){return this.trigger("flushCache")},
setOptions:function(c){return this.trigger("setOptions",[c])},unautocomplete:function(){return this.trigger("unautocomplete")}});a.Autocompleter=function(c,e){function f(){var C=J.selected();if(!C)return!1;var H=C.result;y=H;if(e.multiple){var T=b(r.val());if(1<T.length){var X=e.multipleSeparator.length,ma=a(c).selection().start,Y,da=0;a.each(T,function(pa,qa){da+=qa.length;if(ma<=da)return Y=pa,!1;da+=X});T[Y]=H;H=T.join(e.multipleSeparator)}H+=e.multipleSeparator}r.val(H);g();r.trigger("result",
[C.data,C.value]);return!0}function h(C,H){if(A==n.DEL)J.hide();else if(C=r.val(),H||C!=y)y=C,C=d(C),C.length>=e.minChars?(r.addClass(e.loadingClass),e.matchCase||(C=C.toLowerCase()),q(C,l,g)):(r.removeClass(e.loadingClass),J.hide())}function b(C){return C?e.multiple?a.map(C.split(e.multipleSeparator),function(H){return a.trim(C).length?a.trim(H):null}):[a.trim(C)]:[""]}function d(C){if(!e.multiple)return C;var H=b(C);if(1==H.length)return H[0];H=a(c).selection().start;H=H==C.length?b(C):b(C.replace(C.substring(H),
""));return H[H.length-1]}function g(){J.visible();J.hide();clearTimeout(v);r.removeClass(e.loadingClass);e.mustMatch&&r.search(function(C){C||(e.multiple?(C=b(r.val()).slice(0,-1),r.val(C.join(e.multipleSeparator)+(C.length?e.multipleSeparator:""))):(r.val(""),r.trigger("result",null)))})}function l(C,H){H&&H.length&&w?(r.removeClass(e.loadingClass),J.display(H,C),H=H[0].value,e.autoFill&&d(r.val()).toLowerCase()==C.toLowerCase()&&A!=n.BACKSPACE&&(r.val(r.val()+H.substring(d(y).length)),a(c).selection(y.length,
y.length+H.length)),J.show()):g()}function q(C,H,T){e.matchCase||(C=C.toLowerCase());var X=x.load(C);if(X&&X.length)H(C,X);else if("string"==typeof e.url&&0<e.url.length){var ma={timestamp:+new Date};a.each(e.extraParams,function(Y,da){ma[Y]="function"==typeof da?da():da});a.ajax({mode:"abort",port:"autocomplete"+c.name,dataType:e.dataType,url:e.url,data:a.extend({q:d(C),limit:e.max},ma),success:function(Y){var da;if(!(da=e.parse&&e.parse(Y))){da=[];Y=Y.split("\n");for(var pa=0;pa<Y.length;pa++){var qa=
a.trim(Y[pa]);qa&&(qa=qa.split("|"),da[da.length]={data:qa,value:qa[0],result:e.formatResult&&e.formatResult(qa,qa[0])||qa[0]})}}x.add(C,da);H(C,da)}})}else J.emptyList(),T(C)}var n={UP:38,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8},r=a(c).attr("autocomplete","off").addClass(e.inputClass),v,y="",x=a.Autocompleter.Cache(e),w=0,A,D={mouseDownOnSelect:!1},J=a.Autocompleter.Select(e,c,f,D),L;a.browser.opera&&a(c.form).bind("submit.autocomplete",function(){if(L)return L=
!1});r.bind((a.browser.opera?"keypress":"keydown")+".autocomplete",function(C){w=1;A=C.keyCode;switch(C.keyCode){case n.UP:C.preventDefault();J.visible()?J.prev():h(0,!0);break;case n.DOWN:C.preventDefault();J.visible()?J.next():h(0,!0);break;case n.PAGEUP:C.preventDefault();J.visible()?J.pageUp():h(0,!0);break;case n.PAGEDOWN:C.preventDefault();J.visible()?J.pageDown():h(0,!0);break;case e.multiple&&","==a.trim(e.multipleSeparator)&&n.COMMA:case n.TAB:case n.RETURN:if(f())return C.preventDefault(),
L=!0,!1;break;case n.ESC:J.hide();break;default:clearTimeout(v),v=setTimeout(h,e.delay)}}).focus(function(){w++}).blur(function(){w=0;D.mouseDownOnSelect||(clearTimeout(v),v=setTimeout(g,200))}).click(function(){1<w++&&!J.visible()&&h(0,!0)}).bind("search",function(){function C(T,X){if(X&&X.length)for(var ma=0;ma<X.length;ma++)if(X[ma].result.toLowerCase()==T.toLowerCase()){var Y=X[ma];break}"function"==typeof H?H(Y):r.trigger("result",Y&&[Y.data,Y.value])}var H=1<arguments.length?arguments[1]:null;
a.each(b(r.val()),function(T,X){q(X,C,C)})}).bind("flushCache",function(){x.flush()}).bind("setOptions",function(C,H){a.extend(e,H);"data"in H&&x.populate()}).bind("unautocomplete",function(){J.unbind();r.unbind();a(c.form).unbind(".autocomplete")})};a.Autocompleter.defaults={inputClass:"ac_input",resultsClass:"ac_results",loadingClass:"ac_loading",minChars:1,delay:400,matchCase:!1,matchSubset:!0,matchContains:!1,cacheLength:10,max:100,mustMatch:!1,extraParams:{},selectFirst:!0,formatItem:function(c){return c[0]},
formatMatch:null,autoFill:!1,width:0,multiple:!1,multipleSeparator:", ",highlight:function(c,e){return c.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+e.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>")},scroll:!0,scrollHeight:180};a.Autocompleter.Cache=function(c){function e(l,q){c.matchCase||(l=l.toLowerCase());var n=l.indexOf(q);"word"==c.matchContains&&(n=l.toLowerCase().search("\\b"+q.toLowerCase()));return-1==n?!1:0==n||c.matchContains}
function f(l,q){g>c.cacheLength&&b();d[l]||g++;d[l]=q}function h(){if(!c.data)return!1;var l={},q=0;c.url||(c.cacheLength=1);l[""]=[];for(var n=0,r=c.data.length;n<r;n++){var v=c.data[n];v="string"==typeof v?[v]:v;var y=c.formatMatch(v,n+1,c.data.length);if(!1!==y){var x=y.charAt(0).toLowerCase();l[x]||(l[x]=[]);v={value:y,data:v,result:c.formatResult&&c.formatResult(v)||y};l[x].push(v);q++<c.max&&l[""].push(v)}}a.each(l,function(w,A){c.cacheLength++;f(w,A)})}function b(){d={};g=0}var d={},g=0;setTimeout(h,
25);return{flush:b,add:f,populate:h,load:function(l){if(!c.cacheLength||!g)return null;if(!c.url&&c.matchContains){var q=[],n;for(n in d)if(0<n.length){var r=d[n];a.each(r,function(v,y){e(y.value,l)&&q.push(y)})}return q}if(d[l])return d[l];if(c.matchSubset)for(n=l.length-1;n>=c.minChars;n--)if(r=d[l.substr(0,n)])return q=[],a.each(r,function(v,y){e(y.value,l)&&(q[q.length]=y)}),q;return null}}};a.Autocompleter.Select=function(c,e,f,h){function b(){y&&(x=a("<div/>").hide().addClass(c.resultsClass).css("position",
"absolute").appendTo(document.body),w=a("<ul/>").appendTo(x).mouseover(function(A){d(A).nodeName&&"LI"==d(A).nodeName.toUpperCase()&&(n=a("li",w).removeClass(l.ACTIVE).index(d(A)),a(d(A)).addClass(l.ACTIVE))}).click(function(A){a(d(A)).addClass(l.ACTIVE);f();e.focus();return!1}).mousedown(function(){h.mouseDownOnSelect=!0}).mouseup(function(){h.mouseDownOnSelect=!1}),0<c.width&&x.css("width",c.width),y=!1)}function d(A){for(A=A.target;A&&"LI"!=A.tagName;)A=A.parentNode;return A?A:[]}function g(A){q.slice(n,
n+1).removeClass(l.ACTIVE);n+=A;0>n?n=q.size()-1:n>=q.size()&&(n=0);A=q.slice(n,n+1).addClass(l.ACTIVE);if(c.scroll){var D=0;q.slice(0,n).each(function(){D+=this.offsetHeight});D+A[0].offsetHeight-w.scrollTop()>w[0].clientHeight?w.scrollTop(D+A[0].offsetHeight-w.innerHeight()):D<w.scrollTop()&&w.scrollTop(D)}}var l={ACTIVE:"ac_over"},q,n=-1,r,v="",y=!0,x,w;return{display:function(A,D){b();r=A;v=D;w.empty();A=r.length;A=c.max&&c.max<A?c.max:A;for(D=0;D<A;D++)if(r[D]){var J=c.formatItem(r[D].data,D+
1,A,r[D].value,v);!1!==J&&(J=a("<li/>").html(c.highlight(J,v)).addClass(0==D%2?"ac_even":"ac_odd").appendTo(w)[0],a.data(J,"ac_data",r[D]))}q=w.find("li");c.selectFirst&&(q.slice(0,1).addClass(l.ACTIVE),n=0);a.fn.bgiframe&&w.bgiframe()},next:function(){g(1)},prev:function(){g(-1)},pageUp:function(){0!=n&&0>n-8?g(-n):g(-8)},pageDown:function(){n!=q.size()-1&&n+8>q.size()?g(q.size()-1-n):g(8)},hide:function(){x&&x.hide();q&&q.removeClass(l.ACTIVE);n=-1},visible:function(){return x&&x.is(":visible")},
current:function(){return this.visible()&&(q.filter("."+l.ACTIVE)[0]||c.selectFirst&&q[0])},show:function(){var A=a(e).offset();x.css({width:"string"==typeof c.width||0<c.width?c.width:a(e).width(),top:A.top+e.offsetHeight,left:A.left}).show();if(c.scroll&&(w.scrollTop(0),w.css({maxHeight:c.scrollHeight,overflow:"auto"}),a.browser.msie&&"undefined"===typeof document.body.style.maxHeight)){var D=0;q.each(function(){D+=this.offsetHeight});A=D>c.scrollHeight;w.css("height",A?c.scrollHeight:D);A||q.width(w.width()-
parseInt(q.css("padding-left"))-parseInt(q.css("padding-right")))}},selected:function(){var A=q&&q.filter("."+l.ACTIVE).removeClass(l.ACTIVE);return A&&A.length&&a.data(A[0],"ac_data")},emptyList:function(){w&&w.empty()},unbind:function(){x&&x.remove()}}};a.fn.selection=function(c,e){if(void 0!==c)return this.each(function(){if(this.createTextRange){var g=this.createTextRange();void 0===e||c==e?g.move("character",c):(g.collapse(!0),g.moveStart("character",c),g.moveEnd("character",e));g.select()}else this.setSelectionRange?
this.setSelectionRange(c,e):this.selectionStart&&(this.selectionStart=c,this.selectionEnd=e)});var f=this[0];if(f.createTextRange){var h=document.selection.createRange(),b=f.value,d=h.text.length;h.text="<->";h=f.value.indexOf("<->");f.value=b;this.selection(h,h+d);return{start:h,end:h+d}}if(void 0!==f.selectionStart)return{start:f.selectionStart,end:f.selectionEnd}}})(jQuery);/*
 Sortable 1.13.0 - MIT | git://github.com/SortableJS/Sortable.git */
!function(a,c){"object"==typeof exports&&"undefined"!=typeof module?module.exports=c():"function"==typeof define&&define.amd?define(c):(a=a||self).Sortable=c()}(this,function(){function a(k){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(m){return typeof m}:function(m){return m&&"function"==typeof Symbol&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m})(k)}function c(){return(c=Object.assign||function(k){for(var m=1;m<arguments.length;m++){var p=arguments[m],
t;for(t in p)Object.prototype.hasOwnProperty.call(p,t)&&(k[t]=p[t])}return k}).apply(this,arguments)}function e(k){for(var m=1;m<arguments.length;m++){var p=null!=arguments[m]?arguments[m]:{},t=Object.keys(p);"function"==typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(p).filter(function(u){return Object.getOwnPropertyDescriptor(p,u).enumerable})));t.forEach(function(u){var z=p[u];u in k?Object.defineProperty(k,u,{value:z,enumerable:!0,configurable:!0,writable:!0}):k[u]=
z})}return k}function f(k,m){if(null==k)return{};var p;if(null==k)var t={};else{t={};var u=Object.keys(k);for(p=0;p<u.length;p++){var z=u[p];0<=m.indexOf(z)||(t[z]=k[z])}}if(Object.getOwnPropertySymbols)for(u=Object.getOwnPropertySymbols(k),p=0;p<u.length;p++)z=u[p],0<=m.indexOf(z)||Object.prototype.propertyIsEnumerable.call(k,z)&&(t[z]=k[z]);return t}function h(k){if(!(k=function(m){if(Array.isArray(m)){for(var p=0,t=Array(m.length);p<m.length;p++)t[p]=m[p];return t}}(k)||function(m){if(Symbol.iterator in
Object(m)||"[object Arguments]"===Object.prototype.toString.call(m))return Array.from(m)}(k)))throw new TypeError("Invalid attempt to spread non-iterable instance");return k}function b(k){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(k)}function d(k,m,p){k.addEventListener(m,p,!Ca&&Kb)}function g(k,m,p){k.removeEventListener(m,p,!Ca&&Kb)}function l(k,m){if(m){if(">"===m[0]&&(m=m.substring(1)),k)try{if(k.matches)return k.matches(m);if(k.msMatchesSelector)return k.msMatchesSelector(m);
if(k.webkitMatchesSelector)return k.webkitMatchesSelector(m)}catch(p){}return!1}}function q(k,m,p,t){if(k){p=p||document;do{if(null!=m&&(">"===m[0]?k.parentNode===p&&l(k,m):l(k,m))||t&&k===p)return k;if(k===p)break}while(k=(u=k).host&&u!==document&&u.host.nodeType?u.host:u.parentNode)}var u;return null}function n(k,m,p){if(k&&m)if(k.classList)k.classList[p?"add":"remove"](m);else{var t=(" "+k.className+" ").replace(Lb," ").replace(" "+m+" "," ");k.className=(t+(p?" "+m:"")).replace(Lb," ")}}function r(k,
m,p){var t=k&&k.style;if(t){if(void 0===p)return document.defaultView&&document.defaultView.getComputedStyle?p=document.defaultView.getComputedStyle(k,""):k.currentStyle&&(p=k.currentStyle),void 0===m?p:p[m];m in t||-1!==m.indexOf("webkit")||(m="-webkit-"+m);t[m]=p+("string"==typeof p?"":"px")}}function v(k,m){var p="";if("string"==typeof k)p=k;else{do{var t=r(k,"transform");t&&"none"!==t&&(p=t+" "+p)}while(!m&&(k=k.parentNode))}return(k=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||
window.MSCSSMatrix)&&new k(p)}function y(k,m,p){if(k){k=k.getElementsByTagName(m);m=0;var t=k.length;if(p)for(;m<t;m++)p(k[m],m);return k}return[]}function x(){return document.scrollingElement||document.documentElement}function w(k,m,p,t,u){if(k.getBoundingClientRect||k===window){var z,B,E,F,K,G,N;if(N=k!==window&&k.parentNode&&k!==x()?(B=(z=k.getBoundingClientRect()).top,E=z.left,F=z.bottom,K=z.right,G=z.height,z.width):(E=B=0,F=window.innerHeight,K=window.innerWidth,G=window.innerHeight,window.innerWidth),
(m||p)&&k!==window&&(u=u||k.parentNode,!Ca)){do if(u&&u.getBoundingClientRect&&("none"!==r(u,"transform")||p&&"static"!==r(u,"position"))){F=u.getBoundingClientRect();B-=F.top+parseInt(r(u,"border-top-width"));E-=F.left+parseInt(r(u,"border-left-width"));F=B+z.height;K=E+z.width;break}while(u=u.parentNode)}t&&k!==window&&(t=(k=v(u||k))&&k.a,u=k&&k.d,k&&(F=(B/=u)+(G/=u),K=(E/=t)+(N/=t)));return{top:B,left:E,bottom:F,right:K,width:N,height:G}}}function A(k,m,p){var t=H(k,!0);for(k=w(k)[m];t;){m=w(t)[p];
if(!("top"===p||"left"===p?m<=k:k<=m))return t;if(t===x())break;t=H(t,!1)}return!1}function D(k,m,p){for(var t=0,u=0,z=k.children;u<z.length;){if("none"!==z[u].style.display&&z[u]!==M.ghost&&z[u]!==M.dragged&&q(z[u],p.draggable,k,!1)){if(t===m)return z[u];t++}u++}return null}function J(k,m){for(k=k.lastElementChild;k&&(k===M.ghost||"none"===r(k,"display")||m&&!l(k,m));)k=k.previousElementSibling;return k||null}function L(k,m){var p=0;if(!k||!k.parentNode)return-1;for(;k=k.previousElementSibling;)"TEMPLATE"===
k.nodeName.toUpperCase()||k===M.clone||m&&!l(k,m)||p++;return p}function C(k){var m=0,p=0,t=x();if(k){do{var u=v(k),z=u.d;m+=k.scrollLeft*u.a;p+=k.scrollTop*z}while(k!==t&&(k=k.parentNode))}return[m,p]}function H(k,m){if(!k||!k.getBoundingClientRect)return x();var p=!1;do if(k.clientWidth<k.scrollWidth||k.clientHeight<k.scrollHeight){var t=r(k);if(k.clientWidth<k.scrollWidth&&("auto"==t.overflowX||"scroll"==t.overflowX)||k.clientHeight<k.scrollHeight&&("auto"==t.overflowY||"scroll"==t.overflowY)){if(!k.getBoundingClientRect||
k===document.body)break;if(p||m)return k;p=!0}}while(k=k.parentNode);return x()}function T(k,m){return Math.round(k.top)===Math.round(m.top)&&Math.round(k.left)===Math.round(m.left)&&Math.round(k.height)===Math.round(m.height)&&Math.round(k.width)===Math.round(m.width)}function X(k,m){return function(){if(!Ta){var p=arguments;1===p.length?k.call(this,p[0]):k.apply(this,p);Ta=setTimeout(function(){Ta=void 0},m)}}}function ma(k,m,p){k.scrollLeft+=m;k.scrollTop+=p}function Y(k){var m=window.Polymer,
p=window.jQuery||window.Zepto;return m&&m.dom?m.dom(k).cloneNode(!0):p?p(k).clone(!0)[0]:k.cloneNode(!0)}function da(k,m){r(k,"position","absolute");r(k,"top",m.top);r(k,"left",m.left);r(k,"width",m.width);r(k,"height",m.height)}function pa(k){r(k,"position","");r(k,"top","");r(k,"left","");r(k,"width","");r(k,"height","")}function qa(){var k,m=[];return{captureAnimationState:function(){m=[];this.options.animation&&[].slice.call(this.el.children).forEach(function(p){if("none"!==r(p,"display")&&p!==
M.ghost){m.push({target:p,rect:w(p)});var t=e({},m[m.length-1].rect);if(p.thisAnimationDuration){var u=v(p,!0);u&&(t.top-=u.f,t.left-=u.e)}p.fromRect=t}})},addAnimationState:function(p){m.push(p)},removeAnimationState:function(p){var t=m,u=t.splice;a:{var z=m;p={target:p};for(var B in z)if(z.hasOwnProperty(B))for(var E in p)if(p.hasOwnProperty(E)&&p[E]===z[B][E]){z=Number(B);break a}z=-1}u.call(t,z,1)},animateAll:function(p){var t=this;if(!this.options.animation)return clearTimeout(k),void("function"==
typeof p&&p());var u=!1,z=0;m.forEach(function(B){var E=0,F=B.target,K=F.fromRect,G=w(F),N=F.prevFromRect,S=F.prevToRect;B=B.rect;var V=v(F,!0);V&&(G.top-=V.f,G.left-=V.e);F.toRect=G;F.thisAnimationDuration&&T(N,G)&&!T(K,G)&&(B.top-G.top)/(B.left-G.left)==(K.top-G.top)/(K.left-G.left)&&(E=Math.sqrt(Math.pow(N.top-B.top,2)+Math.pow(N.left-B.left,2))/Math.sqrt(Math.pow(N.top-S.top,2)+Math.pow(N.left-S.left,2))*t.options.animation);T(G,K)||(F.prevFromRect=K,F.prevToRect=G,E||(E=t.options.animation),
t.animate(F,B,G,E));E&&(u=!0,z=Math.max(z,E),clearTimeout(F.animationResetTimer),F.animationResetTimer=setTimeout(function(){F.animationTime=0;F.prevFromRect=null;F.fromRect=null;F.prevToRect=null;F.thisAnimationDuration=null},E),F.thisAnimationDuration=E)});clearTimeout(k);u?k=setTimeout(function(){"function"==typeof p&&p()},z):"function"==typeof p&&p();m=[]},animate:function(p,t,u,z){if(z){r(p,"transition","");r(p,"transform","");var B=v(this.el),E=(t.left-u.left)/(B&&B.a||1);t=(t.top-u.top)/(B&&
B.d||1);p.animatingX=!!E;p.animatingY=!!t;r(p,"transform","translate3d("+E+"px,"+t+"px,0)");this.forRepaintDummy=p.offsetWidth;r(p,"transition","transform "+z+"ms"+(this.options.easing?" "+this.options.easing:""));r(p,"transform","translate3d(0,0,0)");"number"==typeof p.animated&&clearTimeout(p.animated);p.animated=setTimeout(function(){r(p,"transition","");r(p,"transform","");p.animated=!1;p.animatingX=!1;p.animatingY=!1},z)}}}}function Ua(k){var m=k.sortable,p=k.rootEl,t=k.name,u=k.targetEl,z=k.cloneEl,
B=k.toEl,E=k.fromEl,F=k.oldIndex,K=k.newIndex,G=k.oldDraggableIndex,N=k.newDraggableIndex,S=k.originalEvent,V=k.putSortable,ra=k.extraEventProperties;if(m=m||p&&p[ka]){var W;k=m.options;var ea="on"+t.charAt(0).toUpperCase()+t.substr(1);!window.CustomEvent||Ca||Va?(W=document.createEvent("Event")).initEvent(t,!0,!0):W=new CustomEvent(t,{bubbles:!0,cancelable:!0});W.to=B||p;W.from=E||p;W.item=u||p;W.clone=z;W.oldIndex=F;W.newIndex=K;W.oldDraggableIndex=G;W.newDraggableIndex=N;W.originalEvent=S;W.pullMode=
V?V.lastPutMode:void 0;t=e({},ra,Wa.getEventProperties(t,m));for(var Q in t)W[Q]=t[Q];p&&p.dispatchEvent(W);k[ea]&&k[ea].call(m,W)}}function sa(k,m,p){var t=2<arguments.length&&void 0!==p?p:{},u=t.evt;t=f(t,["evt"]);Wa.pluginEvent.bind(M)(k,m,e({dragEl:I,parentEl:fa,ghostEl:P,rootEl:aa,nextEl:Ha,lastDownEl:hb,cloneEl:ba,cloneHidden:Da,dragStarted:Xa,putSortable:ia,activeSortable:M.active,originalEvent:u,oldIndex:Na,oldDraggableIndex:Ya,newIndex:ua,newDraggableIndex:Ea,hideGhostForTarget:Mb,unhideGhostForTarget:Nb,
cloneNowHidden:function(){Da=!0},cloneNowShown:function(){Da=!1},dispatchSortableEvent:function(z){na({sortable:m,name:z,originalEvent:u})}},t))}function na(k){Ua(e({putSortable:ia,cloneEl:ba,targetEl:I,rootEl:aa,oldIndex:Na,oldDraggableIndex:Ya,newIndex:ua,newDraggableIndex:Ea},k))}function Ia(k){if(I){var m=function(u,z){var B;return ib.some(function(E){if(!J(E)){var F=w(E),K=E[ka].options.emptyInsertThreshold,G=u>=F.left-K&&u<=F.right+K;F=z>=F.top-K&&z<=F.bottom+K;return K&&G&&F?B=E:void 0}}),
B}((k=k.touches?k.touches[0]:k).clientX,k.clientY);if(m){var p={},t;for(t in k)k.hasOwnProperty(t)&&(p[t]=k[t]);p.target=p.rootEl=m;p.preventDefault=void 0;p.stopPropagation=void 0;m[ka]._onDragOver(p)}}}function Xb(k){I&&I.parentNode[ka]._isOutsideThisEl(k.target)}function M(k,m){if(!k||!k.nodeType||1!==k.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(k));this.el=k;this.options=m=c({},m);k[ka]=this;var p={group:null,sort:!0,disabled:!1,store:null,handle:null,
draggable:/^[uo]l$/i.test(k.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Ob(k,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(z,B){z.setData("Text",B.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?
Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==M.supportPointer&&"PointerEvent"in window&&!Za,emptyInsertThreshold:5},t;for(t in Wa.initializePlugins(this,k,p),p)t in m||(m[t]=p[t]);for(var u in Pb(m),this)"_"===u.charAt(0)&&"function"==typeof this[u]&&(this[u]=this[u].bind(this));(this.nativeDraggable=!m.forceFallback&&Yb)&&(this.options.touchStartThreshold=
1);m.supportPointer?d(k,"pointerdown",this._onTapStart):(d(k,"mousedown",this._onTapStart),d(k,"touchstart",this._onTapStart));this.nativeDraggable&&(d(k,"dragover",this),d(k,"dragenter",this));ib.push(this.el);m.store&&m.store.get&&this.sort(m.store.get(this)||[]);c(this,qa())}function wb(k,m,p,t,u,z,B,E){var F,K,G=k[ka],N=G.options.onMove;return!window.CustomEvent||Ca||Va?(F=document.createEvent("Event")).initEvent("move",!0,!0):F=new CustomEvent("move",{bubbles:!0,cancelable:!0}),F.to=m,F.from=
k,F.dragged=p,F.draggedRect=t,F.related=u||m,F.relatedRect=z||w(m),F.willInsertAfter=E,F.originalEvent=B,k.dispatchEvent(F),N&&(K=N.call(G,F,B)),K}function xb(k){k.draggable=!1}function Zb(){yb=!1}function jb(k){return setTimeout(k,0)}function kb(){ha.forEach(function(k){clearInterval(k.pid)});ha=[]}function Qb(k){var m=k.originalEvent,p=k.putSortable,t=k.dragEl,u=k.activeSortable,z=k.dispatchSortableEvent,B=k.hideGhostForTarget;k=k.unhideGhostForTarget;m&&(u=p||u,B(),m=m.changedTouches&&m.changedTouches.length?
m.changedTouches[0]:m,m=document.elementFromPoint(m.clientX,m.clientY),k(),u&&!u.el.contains(m)&&(z("spill"),this.onSpill({dragEl:t,putSortable:p})))}function zb(){}function Ab(){}function Rb(k,m){va.forEach(function(p,t){(t=m.children[p.sortableIndex+(k?Number(t):0)])?m.insertBefore(p,t):m.appendChild(p)})}function lb(){O.forEach(function(k){k!==Z&&k.parentNode&&k.parentNode.removeChild(k)})}var Ca=b(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Va=b(/Edge/i),Sb=b(/firefox/i),Za=b(/safari/i)&&
!b(/chrome/i)&&!b(/android/i),$a=b(/iP(ad|od|hone)/i),$b=b(/chrome/i)&&b(/android/i),Kb={capture:!1,passive:!1},Ta,Lb=/\s+/g,ka="Sortable"+(new Date).getTime(),Oa=[],Bb={initializeByDefault:!0},Wa={mount:function(k){for(var m in Bb)!Bb.hasOwnProperty(m)||m in k||(k[m]=Bb[m]);Oa.forEach(function(p){if(p.pluginName===k.pluginName)throw"Sortable: Cannot mount plugin ".concat(k.pluginName," more than once");});Oa.push(k)},pluginEvent:function(k,m,p){var t=this;this.eventCanceled=!1;p.cancel=function(){t.eventCanceled=
!0};var u=k+"Global";Oa.forEach(function(z){m[z.pluginName]&&(m[z.pluginName][u]&&m[z.pluginName][u](e({sortable:m},p)),m.options[z.pluginName]&&m[z.pluginName][k]&&m[z.pluginName][k](e({sortable:m},p)))})},initializePlugins:function(k,m,p,t){for(var u in Oa.forEach(function(z){var B=z.pluginName;if(k.options[B]||z.initializeByDefault)z=new z(k,m,k.options),z.sortable=k,z.options=k.options,k[B]=z,c(p,z.defaults)}),k.options)k.options.hasOwnProperty(u)&&(t=this.modifyOption(k,u,k.options[u]),void 0!==
t&&(k.options[u]=t))},getEventProperties:function(k,m){var p={};return Oa.forEach(function(t){"function"==typeof t.eventProperties&&c(p,t.eventProperties.call(m[t.pluginName],k))}),p},modifyOption:function(k,m,p){var t;return Oa.forEach(function(u){k[u.pluginName]&&u.optionListeners&&"function"==typeof u.optionListeners[m]&&(t=u.optionListeners[m].call(k[u.pluginName],p))}),t}},I,fa,P,aa,Ha,hb,ba,Da,Na,ua,Ya,Ea,mb,ia,Ja,ya,Cb,Db,Tb,Ub,Xa,Pa,ab,nb,la,Qa=!1,ob=!1,ib=[],bb=!1,pb=!1,Eb=[],yb=!1,qb=[],
rb="undefined"!=typeof document,Vb=Va||Ca?"cssFloat":"float",Yb=rb&&!$b&&!$a&&"draggable"in document.createElement("div"),Wb=function(){if(rb){if(Ca)return!1;var k=document.createElement("x");return k.style.cssText="pointer-events:auto","auto"===k.style.pointerEvents}}(),Ob=function(k,m){var p=r(k),t=parseInt(p.width)-parseInt(p.paddingLeft)-parseInt(p.paddingRight)-parseInt(p.borderLeftWidth)-parseInt(p.borderRightWidth),u=D(k,0,m);k=D(k,1,m);var z=u&&r(u);m=k&&r(k);var B=z&&parseInt(z.marginLeft)+
parseInt(z.marginRight)+w(u).width,E=m&&parseInt(m.marginLeft)+parseInt(m.marginRight)+w(k).width;return"flex"===p.display?"column"===p.flexDirection||"column-reverse"===p.flexDirection?"vertical":"horizontal":"grid"===p.display?1>=p.gridTemplateColumns.split(" ").length?"vertical":"horizontal":u&&z.float&&"none"!==z.float?(p="left"===z.float?"left":"right",!k||"both"!==m.clear&&m.clear!==p?"horizontal":"vertical"):u&&("block"===z.display||"flex"===z.display||"table"===z.display||"grid"===z.display||
t<=B&&"none"===p[Vb]||k&&"none"===p[Vb]&&t<B+E)?"vertical":"horizontal"},Pb=function(k){function m(u,z){return function(B,E,F,K){var G=B.options.group.name&&E.options.group.name&&B.options.group.name===E.options.group.name;if(null==u&&(z||G))return!0;if(null==u||!1===u)return!1;if(z&&"clone"===u)return u;if("function"==typeof u)return m(u(B,E,F,K),z)(B,E,F,K);B=(z?B:E).options.group.name;return!0===u||"string"==typeof u&&u===B||u.join&&-1<u.indexOf(B)}}var p={},t=k.group;t&&"object"==a(t)||(t={name:t});
p.name=t.name;p.checkPull=m(t.pull,!0);p.checkPut=m(t.put);p.revertClone=t.revertClone;k.group=p},Mb=function(){!Wb&&P&&r(P,"display","none")},Nb=function(){!Wb&&P&&r(P,"display","")};rb&&document.addEventListener("click",function(k){if(ob)return k.preventDefault(),k.stopPropagation&&k.stopPropagation(),k.stopImmediatePropagation&&k.stopImmediatePropagation(),ob=!1},!0);M.prototype={constructor:M,_isOutsideThisEl:function(k){this.el.contains(k)||k===this.el||(Pa=null)},_getDirection:function(k,m){return"function"==
typeof this.options.direction?this.options.direction.call(this,k,m,I):this.options.direction},_onTapStart:function(k){if(k.cancelable){var m=this,p=this.el,t=this.options,u=t.preventOnFilter,z=k.type,B=k.touches&&k.touches[0]||k.pointerType&&"touch"===k.pointerType&&k,E=(B||k).target,F=k.target.shadowRoot&&(k.path&&k.path[0]||k.composedPath&&k.composedPath()[0])||E,K=t.filter;if(function(G){qb.length=0;G=G.getElementsByTagName("input");for(var N=G.length;N--;){var S=G[N];S.checked&&qb.push(S)}}(p),
!(I||/mousedown|pointerdown/.test(z)&&0!==k.button||t.disabled||F.isContentEditable||!this.nativeDraggable&&Za&&E&&"SELECT"===E.tagName.toUpperCase()||(E=q(E,t.draggable,p,!1))&&E.animated||hb===E)){if(Na=L(E),Ya=L(E,t.draggable),"function"==typeof K){if(K.call(this,k,E,this))return na({sortable:m,rootEl:F,name:"filter",targetEl:E,toEl:p,fromEl:p}),sa("filter",m,{evt:k}),void(u&&k.cancelable&&k.preventDefault())}else if(K&&(K=K.split(",").some(function(G){if(G=q(F,G.trim(),p,!1))return na({sortable:m,
rootEl:G,name:"filter",targetEl:E,fromEl:p,toEl:p}),sa("filter",m,{evt:k}),!0})))return void(u&&k.cancelable&&k.preventDefault());t.handle&&!q(F,t.handle,p,!1)||this._prepareDragStart(k,B,E)}}},_prepareDragStart:function(k,m,p){var t=this,u=t.el,z=t.options,B=u.ownerDocument;if(p&&!I&&p.parentNode===u){var E=w(p);if(aa=u,fa=(I=p).parentNode,Ha=I.nextSibling,hb=p,mb=z.group,Ja={target:M.dragged=I,clientX:(m||k).clientX,clientY:(m||k).clientY},Tb=Ja.clientX-E.left,Ub=Ja.clientY-E.top,this._lastX=(m||
k).clientX,this._lastY=(m||k).clientY,I.style["will-change"]="all",p=function(){sa("delayEnded",t,{evt:k});M.eventCanceled?t._onDrop():(t._disableDelayedDragEvents(),!Sb&&t.nativeDraggable&&(I.draggable=!0),t._triggerDragStart(k,m),na({sortable:t,name:"choose",originalEvent:k}),n(I,z.chosenClass,!0))},z.ignore.split(",").forEach(function(F){y(I,F.trim(),xb)}),d(B,"dragover",Ia),d(B,"mousemove",Ia),d(B,"touchmove",Ia),d(B,"mouseup",t._onDrop),d(B,"touchend",t._onDrop),d(B,"touchcancel",t._onDrop),
Sb&&this.nativeDraggable&&(this.options.touchStartThreshold=4,I.draggable=!0),sa("delayStart",this,{evt:k}),!z.delay||z.delayOnTouchOnly&&!m||this.nativeDraggable&&(Va||Ca))p();else{if(M.eventCanceled)return void this._onDrop();d(B,"mouseup",t._disableDelayedDrag);d(B,"touchend",t._disableDelayedDrag);d(B,"touchcancel",t._disableDelayedDrag);d(B,"mousemove",t._delayedDragTouchMoveHandler);d(B,"touchmove",t._delayedDragTouchMoveHandler);z.supportPointer&&d(B,"pointermove",t._delayedDragTouchMoveHandler);
t._dragStartTimer=setTimeout(p,z.delay)}}},_delayedDragTouchMoveHandler:function(k){k=k.touches?k.touches[0]:k;Math.max(Math.abs(k.clientX-this._lastX),Math.abs(k.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){I&&xb(I);clearTimeout(this._dragStartTimer);this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var k=this.el.ownerDocument;g(k,"mouseup",this._disableDelayedDrag);
g(k,"touchend",this._disableDelayedDrag);g(k,"touchcancel",this._disableDelayedDrag);g(k,"mousemove",this._delayedDragTouchMoveHandler);g(k,"touchmove",this._delayedDragTouchMoveHandler);g(k,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(k,m){m=m||"touch"==k.pointerType&&k;!this.nativeDraggable||m?this.options.supportPointer?d(document,"pointermove",this._onTouchMove):d(document,m?"touchmove":"mousemove",this._onTouchMove):(d(I,"dragend",this),d(aa,"dragstart",this._onDragStart));
try{document.selection?jb(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch(p){}},_dragStarted:function(k,m){if(Qa=!1,aa&&I){sa("dragStarted",this,{evt:m});this.nativeDraggable&&d(document,"dragover",Xb);var p=this.options;k||n(I,p.dragClass,!1);n(I,p.ghostClass,!0);M.active=this;k&&this._appendGhost();na({sortable:this,name:"start",originalEvent:m})}else this._nulling()},_emulateDragOver:function(){if(ya){this._lastX=ya.clientX;this._lastY=ya.clientY;Mb();for(var k=
document.elementFromPoint(ya.clientX,ya.clientY),m=k;k&&k.shadowRoot&&(k=k.shadowRoot.elementFromPoint(ya.clientX,ya.clientY))!==m;)m=k;if(I.parentNode[ka]._isOutsideThisEl(k),m){do{if(m[ka]&&m[ka]._onDragOver({clientX:ya.clientX,clientY:ya.clientY,target:k,rootEl:m})&&!this.options.dragoverBubble)break;k=m}while(m=m.parentNode)}Nb()}},_onTouchMove:function(k){if(Ja){var m=this.options,p=m.fallbackTolerance,t=m.fallbackOffset;m=k.touches?k.touches[0]:k;var u=P&&v(P,!0),z=P&&u&&u.a,B=P&&u&&u.d,E=$a&&
la&&C(la);z=(m.clientX-Ja.clientX+t.x)/(z||1)+(E?E[0]-Eb[0]:0)/(z||1);t=(m.clientY-Ja.clientY+t.y)/(B||1)+(E?E[1]-Eb[1]:0)/(B||1);if(!M.active&&!Qa){if(p&&Math.max(Math.abs(m.clientX-this._lastX),Math.abs(m.clientY-this._lastY))<p)return;this._onDragStart(k,!0)}P&&(u?(u.e+=z-(Cb||0),u.f+=t-(Db||0)):u={a:1,b:0,c:0,d:1,e:z,f:t},p="matrix(".concat(u.a,",").concat(u.b,",").concat(u.c,",").concat(u.d,",").concat(u.e,",").concat(u.f,")"),r(P,"webkitTransform",p),r(P,"mozTransform",p),r(P,"msTransform",
p),r(P,"transform",p),Cb=z,Db=t,ya=m);k.cancelable&&k.preventDefault()}},_appendGhost:function(){if(!P){var k=this.options.fallbackOnBody?document.body:aa,m=w(I,!0,$a,!0,k),p=this.options;if($a){for(la=k;"static"===r(la,"position")&&"none"===r(la,"transform")&&la!==document;)la=la.parentNode;la!==document.body&&la!==document.documentElement?(la===document&&(la=x()),m.top+=la.scrollTop,m.left+=la.scrollLeft):la=x();Eb=C(la)}n(P=I.cloneNode(!0),p.ghostClass,!1);n(P,p.fallbackClass,!0);n(P,p.dragClass,
!0);r(P,"transition","");r(P,"transform","");r(P,"box-sizing","border-box");r(P,"margin",0);r(P,"top",m.top);r(P,"left",m.left);r(P,"width",m.width);r(P,"height",m.height);r(P,"opacity","0.8");r(P,"position",$a?"absolute":"fixed");r(P,"zIndex","100000");r(P,"pointerEvents","none");M.ghost=P;k.appendChild(P);r(P,"transform-origin",Tb/parseInt(P.style.width)*100+"% "+Ub/parseInt(P.style.height)*100+"%")}},_onDragStart:function(k,m){var p=this,t=k.dataTransfer,u=p.options;sa("dragStart",this,{evt:k});
M.eventCanceled?this._onDrop():(sa("setupClone",this),M.eventCanceled||((ba=Y(I)).draggable=!1,ba.style["will-change"]="",this._hideClone(),n(ba,this.options.chosenClass,!1),M.clone=ba),p.cloneId=jb(function(){sa("clone",p);M.eventCanceled||(p.options.removeCloneOnHide||aa.insertBefore(ba,I),p._hideClone(),na({sortable:p,name:"clone"}))}),m||n(I,u.dragClass,!0),m?(ob=!0,p._loopId=setInterval(p._emulateDragOver,50)):(g(document,"mouseup",p._onDrop),g(document,"touchend",p._onDrop),g(document,"touchcancel",
p._onDrop),t&&(t.effectAllowed="move",u.setData&&u.setData.call(p,t,I)),d(document,"drop",p),r(I,"transform","translateZ(0)")),Qa=!0,p._dragStartId=jb(p._dragStarted.bind(p,m,k)),d(document,"selectstart",p),Xa=!0,Za&&r(document.body,"user-select","none"))},_onDragOver:function(k){function m(R,ja){sa(R,Q,e({evt:k,isOwner:ra,axis:F?"vertical":"horizontal",revert:E,dragRect:z,targetRect:B,canSort:W,fromSortable:ea,target:G,completed:t,onMove:function(U,xa){return wb(aa,K,I,z,U,w(U),k,xa)},changed:u},
ja))}function p(){m("dragOverAnimationCapture");Q.captureAnimationState();Q!==ea&&ea.captureAnimationState()}function t(R){return m("dragOverCompleted",{insertion:R}),R&&(ra?V._hideClone():V._showClone(Q),Q!==ea&&(n(I,ia?ia.options.ghostClass:V.options.ghostClass,!1),n(I,N.ghostClass,!0)),ia!==Q&&Q!==M.active?ia=Q:Q===M.active&&ia&&(ia=null),ea===Q&&(Q._ignoreWhileAnimating=G),Q.animateAll(function(){m("dragOverAnimationComplete");Q._ignoreWhileAnimating=null}),Q!==ea&&(ea.animateAll(),ea._ignoreWhileAnimating=
null)),(G===I&&!I.animated||G===K&&!G.animated)&&(Pa=null),N.dragoverBubble||k.rootEl||G===document||(I.parentNode[ka]._isOutsideThisEl(k.target),R||Ia(k)),!N.dragoverBubble&&k.stopPropagation&&k.stopPropagation(),Ba=!0}function u(){ua=L(I);Ea=L(I,N.draggable);na({sortable:Q,name:"change",toEl:K,newIndex:ua,newDraggableIndex:Ea,originalEvent:k})}var z,B,E,F,K=this.el,G=k.target,N=this.options,S=N.group,V=M.active,ra=mb===S,W=N.sort,ea=ia||V,Q=this,Ba=!1;if(!yb){if(void 0!==k.preventDefault&&k.cancelable&&
k.preventDefault(),G=q(G,N.draggable,K,!0),m("dragOver"),M.eventCanceled)return Ba;if(I.contains(k.target)||G.animated&&G.animatingX&&G.animatingY||Q._ignoreWhileAnimating===G)return t(!1);if(ob=!1,V&&!N.disabled&&(ra?W||(E=!aa.contains(I)):ia===this||(this.lastPutMode=mb.checkPull(this,V,I,k))&&S.checkPut(this,V,I,k))){if(F="vertical"===this._getDirection(k,G),z=w(I),m("dragOverValid"),M.eventCanceled)return Ba;if(E)return fa=aa,p(),this._hideClone(),m("revert"),M.eventCanceled||(Ha?aa.insertBefore(I,
Ha):aa.appendChild(I)),t(!0);S=J(K,N.draggable);if(!S||function(R,ja,U){U=w(J(U.el,U.options.draggable));return ja?R.clientX>U.right+10||R.clientX<=U.right&&R.clientY>U.bottom&&R.clientX>=U.left:R.clientX>U.right&&R.clientY>U.top||R.clientX<=U.right&&R.clientY>U.bottom+10}(k,F,this)&&!S.animated){if(S===I)return t(!1);if(S&&K===k.target&&(G=S),G&&(B=w(G)),!1!==wb(aa,K,I,z,G,B,k,!!G))return p(),K.appendChild(I),fa=K,u(),t(!0)}else if(G.parentNode===K){B=w(G);var Ka,ca;var oa=I.parentNode!==K;var ta=
!function(R,ja,U){var xa=U?R.left:R.top,cb=U?R.right:R.bottom;R=U?R.width:R.height;var La=U?ja.left:ja.top,sb=U?ja.right:ja.bottom;ja=U?ja.width:ja.height;return xa===La||cb===sb||xa+R/2===La+ja/2}(I.animated&&I.toRect||z,G.animated&&G.toRect||B,F);S=F?"top":"left";var Fa=A(G,"top","top")||A(I,"top","top"),tb=Fa?Fa.scrollTop:void 0;if(Pa!==G&&(Ka=B[S],bb=!1,pb=!ta&&N.invertSwap||oa),0!==(oa=function(R,ja,U,xa,cb,La,sb,ac){R=xa?R.clientY:R.clientX;var Ga=xa?U.height:U.width,db=xa?U.top:U.left;U=xa?
U.bottom:U.right;xa=!1;if(!sb)if(ac&&nb<Ga*cb)if(!bb&&(1===ab?db+Ga*La/2<R:R<U-Ga*La/2)&&(bb=!0),bb)xa=!0;else{if(1===ab?R<db+nb:U-nb<R)return-ab}else if(db+Ga*(1-cb)/2<R&&R<U-Ga*(1-cb)/2)return L(I)<L(ja)?1:-1;return(xa||sb)&&(R<db+Ga*La/2||U-Ga*La/2<R)?db+Ga/2<R?1:-1:0}(k,G,B,F,ta?1:N.swapThreshold,null==N.invertedSwapThreshold?N.swapThreshold:N.invertedSwapThreshold,pb,Pa===G)))for(ta=L(I);ta-=oa,(ca=fa.children[ta])&&("none"===r(ca,"display")||ca===P););if(0===oa||ca===G)return t(!1);ab=oa;ca=
(Pa=G).nextElementSibling;ta=!1;oa=wb(aa,K,I,z,G,B,k,ta=1===oa);if(!1!==oa)return 1!==oa&&-1!==oa||(ta=1===oa),yb=!0,setTimeout(Zb,30),p(),ta&&!ca?K.appendChild(I):G.parentNode.insertBefore(I,ta?ca:G),Fa&&ma(Fa,0,tb-Fa.scrollTop),fa=I.parentNode,void 0===Ka||pb||(nb=Math.abs(Ka-w(G)[S])),u(),t(!0)}if(K.contains(I))return t(!1)}return!1}},_ignoreWhileAnimating:null,_offMoveEvents:function(){g(document,"mousemove",this._onTouchMove);g(document,"touchmove",this._onTouchMove);g(document,"pointermove",
this._onTouchMove);g(document,"dragover",Ia);g(document,"mousemove",Ia);g(document,"touchmove",Ia)},_offUpEvents:function(){var k=this.el.ownerDocument;g(k,"mouseup",this._onDrop);g(k,"touchend",this._onDrop);g(k,"pointerup",this._onDrop);g(k,"touchcancel",this._onDrop);g(document,"selectstart",this)},_onDrop:function(k){var m=this.el,p=this.options;ua=L(I);Ea=L(I,p.draggable);sa("drop",this,{evt:k});fa=I&&I.parentNode;ua=L(I);Ea=L(I,p.draggable);M.eventCanceled||(bb=pb=Qa=!1,clearInterval(this._loopId),
clearTimeout(this._dragStartTimer),clearTimeout(this.cloneId),clearTimeout(this._dragStartId),this.nativeDraggable&&(g(document,"drop",this),g(m,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Za&&r(document.body,"user-select",""),r(I,"transform",""),k&&(Xa&&(k.cancelable&&k.preventDefault(),p.dropBubble||k.stopPropagation()),P&&P.parentNode&&P.parentNode.removeChild(P),(aa===fa||ia&&"clone"!==ia.lastPutMode)&&ba&&ba.parentNode&&ba.parentNode.removeChild(ba),I&&(this.nativeDraggable&&
g(I,"dragend",this),xb(I),I.style["will-change"]="",Xa&&!Qa&&n(I,ia?ia.options.ghostClass:this.options.ghostClass,!1),n(I,this.options.chosenClass,!1),na({sortable:this,name:"unchoose",toEl:fa,newIndex:null,newDraggableIndex:null,originalEvent:k}),aa!==fa?(0<=ua&&(na({rootEl:fa,name:"add",toEl:fa,fromEl:aa,originalEvent:k}),na({sortable:this,name:"remove",toEl:fa,originalEvent:k}),na({rootEl:fa,name:"sort",toEl:fa,fromEl:aa,originalEvent:k}),na({sortable:this,name:"sort",toEl:fa,originalEvent:k})),
ia&&ia.save()):ua!==Na&&0<=ua&&(na({sortable:this,name:"update",toEl:fa,originalEvent:k}),na({sortable:this,name:"sort",toEl:fa,originalEvent:k})),M.active&&(null!=ua&&-1!==ua||(ua=Na,Ea=Ya),na({sortable:this,name:"end",toEl:fa,originalEvent:k}),this.save()))));this._nulling()},_nulling:function(){sa("nulling",this);aa=I=fa=P=Ha=ba=hb=Da=Ja=ya=Xa=ua=Ea=Na=Ya=Pa=ab=ia=mb=M.dragged=M.ghost=M.clone=M.active=null;qb.forEach(function(k){k.checked=!0});qb.length=Cb=Db=0},handleEvent:function(k){switch(k.type){case "drop":case "dragend":this._onDrop(k);
break;case "dragenter":case "dragover":I&&(this._onDragOver(k),k.dataTransfer&&(k.dataTransfer.dropEffect="move"),k.cancelable&&k.preventDefault());break;case "selectstart":k.preventDefault()}},toArray:function(){for(var k,m=[],p=this.el.children,t=0,u=p.length,z=this.options;t<u;t++)if(q(k=p[t],z.draggable,this.el,!1)){var B=m,E=B.push,F;if(!(F=k.getAttribute(z.dataIdAttr))){k=k.tagName+k.className+k.src+k.href+k.textContent;F=k.length;for(var K=0;F--;)K+=k.charCodeAt(F);F=K.toString(36)}E.call(B,
F)}return m},sort:function(k,m){var p={},t=this.el;this.toArray().forEach(function(u,z){z=t.children[z];q(z,this.options.draggable,t,!1)&&(p[u]=z)},this);m&&this.captureAnimationState();k.forEach(function(u){p[u]&&(t.removeChild(p[u]),t.appendChild(p[u]))});m&&this.animateAll()},save:function(){var k=this.options.store;k&&k.set&&k.set(this)},closest:function(k,m){return q(k,m||this.options.draggable,this.el,!1)},option:function(k,m){var p=this.options;if(void 0===m)return p[k];var t=Wa.modifyOption(this,
k,m);p[k]=void 0!==t?t:m;"group"===k&&Pb(p)},destroy:function(){sa("destroy",this);var k=this.el;k[ka]=null;g(k,"mousedown",this._onTapStart);g(k,"touchstart",this._onTapStart);g(k,"pointerdown",this._onTapStart);this.nativeDraggable&&(g(k,"dragover",this),g(k,"dragenter",this));Array.prototype.forEach.call(k.querySelectorAll("[draggable]"),function(m){m.removeAttribute("draggable")});this._onDrop();this._disableDelayedDragEvents();ib.splice(ib.indexOf(this.el),1);this.el=k=null},_hideClone:function(){Da||
(sa("hideClone",this),M.eventCanceled)||(r(ba,"display","none"),this.options.removeCloneOnHide&&ba.parentNode&&ba.parentNode.removeChild(ba),Da=!0)},_showClone:function(k){"clone"===k.lastPutMode?Da&&(sa("showClone",this),!M.eventCanceled)&&(I.parentNode!=aa||this.options.group.revertClone?Ha?aa.insertBefore(ba,Ha):aa.appendChild(ba):aa.insertBefore(ba,I),this.options.group.revertClone&&this.animate(I,ba),r(ba,"display",""),Da=!1):this._hideClone()}};rb&&d(document,"touchmove",function(k){(M.active||
Qa)&&k.cancelable&&k.preventDefault()});M.utils={on:d,off:g,css:r,find:y,is:function(k,m){return!!q(k,m,k,!1)},extend:function(k,m){if(k&&m)for(var p in m)m.hasOwnProperty(p)&&(k[p]=m[p]);return k},throttle:X,closest:q,toggleClass:n,clone:Y,index:L,nextTick:jb,cancelNextTick:function(k){return clearTimeout(k)},detectDirection:Ob,getChild:D};M.get=function(k){return k[ka]};M.mount=function(){for(var k=arguments.length,m=Array(k),p=0;p<k;p++)m[p]=arguments[p];m[0].constructor===Array&&(m=m[0]);m.forEach(function(t){if(!t.prototype||
!t.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(t));t.utils&&(M.utils=e({},M.utils,t.utils));Wa.mount(t)})};M.create=function(k,m){return new M(k,m)};var eb,Fb,Gb,Hb,ub,Ra,ha=[],Ib=!(M.version="1.13.0"),za,Jb=X(function(k,m,p,t){if(m.scroll){var u,z=(k.touches?k.touches[0]:k).clientX,B=(k.touches?k.touches[0]:k).clientY,E=m.scrollSensitivity,F=m.scrollSpeed,K=x(),G=!1;Fb!==p&&(Fb=p,kb(),eb=m.scroll,u=m.scrollFn,!0===eb&&(eb=H(p,
!0)));p=0;var N=eb;do{var S=N,V=w(S),ra=V.top,W=V.bottom,ea=V.left,Q=V.right,Ba=V.width;V=V.height;var Ka=void 0,ca=void 0,oa=S.scrollWidth,ta=S.scrollHeight;ca=r(S);var Fa=S.scrollLeft,tb=S.scrollTop;ca=S===K?(Ka=Ba<oa&&("auto"===ca.overflowX||"scroll"===ca.overflowX||"visible"===ca.overflowX),V<ta&&("auto"===ca.overflowY||"scroll"===ca.overflowY||"visible"===ca.overflowY)):(Ka=Ba<oa&&("auto"===ca.overflowX||"scroll"===ca.overflowX),V<ta&&("auto"===ca.overflowY||"scroll"===ca.overflowY));ea=Ka&&
(Math.abs(Q-z)<=E&&Fa+Ba<oa)-(Math.abs(ea-z)<=E&&!!Fa);ra=ca&&(Math.abs(W-B)<=E&&tb+V<ta)-(Math.abs(ra-B)<=E&&!!tb);if(!ha[p])for(W=0;W<=p;W++)ha[W]||(ha[W]={});ha[p].vx==ea&&ha[p].vy==ra&&ha[p].el===S||(ha[p].el=S,ha[p].vx=ea,ha[p].vy=ra,clearInterval(ha[p].pid),0==ea&&0==ra||(G=!0,ha[p].pid=setInterval(function(){t&&0===this.layer&&M.active._onTouchMove(ub);var R=ha[this.layer].vy?ha[this.layer].vy*F:0,ja=ha[this.layer].vx?ha[this.layer].vx*F:0;"function"==typeof u&&"continue"!==u.call(M.dragged.parentNode[ka],
ja,R,k,ub,ha[this.layer].el)||ma(ha[this.layer].el,ja,R)}.bind({layer:p}),24)));p++}while(m.bubbleScroll&&N!==K&&(N=H(N,!1)));Ib=G}},30);zb.prototype={startIndex:null,dragStart:function(k){this.startIndex=k.oldDraggableIndex},onSpill:function(k){var m=k.dragEl;k=k.putSortable;this.sortable.captureAnimationState();k&&k.captureAnimationState();var p=D(this.sortable.el,this.startIndex,this.options);p?this.sortable.el.insertBefore(m,p):this.sortable.el.appendChild(m);this.sortable.animateAll();k&&k.animateAll()},
drop:Qb};c(zb,{pluginName:"revertOnSpill"});Ab.prototype={onSpill:function(k){var m=k.dragEl;k=k.putSortable||this.sortable;k.captureAnimationState();m.parentNode&&m.parentNode.removeChild(m);k.animateAll()},drop:Qb};c(Ab,{pluginName:"removeOnSpill"});var fb,Aa,Z,Ma,vb,O=[],va=[],gb=!1,wa=!1,Sa=!1;return M.mount(new function(){function k(){for(var m in this.defaults={scroll:!0,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0},this)"_"===m.charAt(0)&&"function"==typeof this[m]&&(this[m]=this[m].bind(this))}
return k.prototype={dragStarted:function(m){m=m.originalEvent;this.sortable.nativeDraggable?d(document,"dragover",this._handleAutoScroll):this.options.supportPointer?d(document,"pointermove",this._handleFallbackAutoScroll):m.touches?d(document,"touchmove",this._handleFallbackAutoScroll):d(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(m){m=m.originalEvent;this.options.dragOverBubble||m.rootEl||this._handleAutoScroll(m)},drop:function(){this.sortable.nativeDraggable?
g(document,"dragover",this._handleAutoScroll):(g(document,"pointermove",this._handleFallbackAutoScroll),g(document,"touchmove",this._handleFallbackAutoScroll),g(document,"mousemove",this._handleFallbackAutoScroll));clearInterval(Ra);kb();clearTimeout(Ta);Ta=void 0},nulling:function(){ub=Fb=eb=Ib=Ra=Gb=Hb=null;ha.length=0},_handleFallbackAutoScroll:function(m){this._handleAutoScroll(m,!0)},_handleAutoScroll:function(m,p){var t=this,u=(m.touches?m.touches[0]:m).clientX,z=(m.touches?m.touches[0]:m).clientY,
B=document.elementFromPoint(u,z);if(ub=m,p||Va||Ca||Za){Jb(m,this.options,B,p);var E=H(B,!0);!Ib||Ra&&u===Gb&&z===Hb||(Ra&&clearInterval(Ra),Ra=setInterval(function(){var F=H(document.elementFromPoint(u,z),!0);F!==E&&(E=F,kb());Jb(m,t.options,F,p)},10),Gb=u,Hb=z)}else{if(!this.options.bubbleScroll||H(B,!0)===x())return void kb();Jb(m,this.options,H(B,!1),!1)}}},c(k,{pluginName:"scroll",initializeByDefault:!0})}),M.mount(Ab,zb),M.mount(new function(){function k(){this.defaults={swapClass:"sortable-swap-highlight"}}
return k.prototype={dragStart:function(m){za=m.dragEl},dragOverValid:function(m){var p=m.completed,t=m.target,u=m.onMove,z=m.changed,B=m.cancel;if(m.activeSortable.options.swap){var E=this.sortable.el;m=this.options;t&&t!==E&&(E=za,za=!1!==u(t)?(n(t,m.swapClass,!0),t):null,E&&E!==za&&n(E,m.swapClass,!1));z();p(!0);B()}},drop:function(m){var p=m.activeSortable,t=m.putSortable;m=m.dragEl;var u=t||this.sortable,z=this.options;za&&n(za,z.swapClass,!1);if(za&&(z.swap||t&&t.options.swap)&&m!==za){u.captureAnimationState();
u!==p&&p.captureAnimationState();t=za;var B=m.parentNode,E=t.parentNode;if(B&&E&&!B.isEqualNode(t)&&!E.isEqualNode(m)){z=L(m);var F=L(t);B.isEqualNode(E)&&z<F&&F++;B.insertBefore(t,B.children[z]);E.insertBefore(m,E.children[F])}u.animateAll();u!==p&&p.animateAll()}},nulling:function(){za=null}},c(k,{pluginName:"swap",eventProperties:function(){return{swapItem:za}}})}),M.mount(new function(){function k(m){for(var p in this)"_"===p.charAt(0)&&"function"==typeof this[p]&&(this[p]=this[p].bind(this));
m.options.supportPointer?d(document,"pointerup",this._deselectMultiDrag):(d(document,"mouseup",this._deselectMultiDrag),d(document,"touchend",this._deselectMultiDrag));d(document,"keydown",this._checkKeyDown);d(document,"keyup",this._checkKeyUp);this.defaults={selectedClass:"sortable-selected",multiDragKey:null,setData:function(t,u){var z="";O.length&&Aa===m?O.forEach(function(B,E){z+=(E?", ":"")+B.textContent}):z=u.textContent;t.setData("Text",z)}}}return k.prototype={multiDragKeyDown:!1,isMultiDrag:!1,
delayStartGlobal:function(m){Z=m.dragEl},delayEnded:function(){this.isMultiDrag=~O.indexOf(Z)},setupClone:function(m){var p=m.sortable;m=m.cancel;if(this.isMultiDrag){for(var t=0;t<O.length;t++)va.push(Y(O[t])),va[t].sortableIndex=O[t].sortableIndex,va[t].draggable=!1,va[t].style["will-change"]="",n(va[t],this.options.selectedClass,!1),O[t]===Z&&n(va[t],this.options.chosenClass,!1);p._hideClone();m()}},clone:function(m){var p=m.sortable,t=m.rootEl,u=m.dispatchSortableEvent;m=m.cancel;this.isMultiDrag&&
(this.options.removeCloneOnHide||O.length&&Aa===p&&(Rb(!0,t),u("clone"),m()))},showClone:function(m){var p=m.cloneNowShown,t=m.rootEl;m=m.cancel;this.isMultiDrag&&(Rb(!1,t),va.forEach(function(u){r(u,"display","")}),p(),vb=!1,m())},hideClone:function(m){var p=this,t=(m.sortable,m.cloneNowHidden);m=m.cancel;this.isMultiDrag&&(va.forEach(function(u){r(u,"display","none");p.options.removeCloneOnHide&&u.parentNode&&u.parentNode.removeChild(u)}),t(),vb=!0,m())},dragStartGlobal:function(m){m.sortable;!this.isMultiDrag&&
Aa&&Aa.multiDrag._deselectMultiDrag();O.forEach(function(p){p.sortableIndex=L(p)});O=O.sort(function(p,t){return p.sortableIndex-t.sortableIndex});Sa=!0},dragStarted:function(m){var p=this;m=m.sortable;if(this.isMultiDrag){if(this.options.sort&&(m.captureAnimationState(),this.options.animation)){O.forEach(function(u){u!==Z&&r(u,"position","absolute")});var t=w(Z,!1,!0,!0);O.forEach(function(u){u!==Z&&da(u,t)});gb=wa=!0}m.animateAll(function(){gb=wa=!1;p.options.animation&&O.forEach(function(u){pa(u)});
p.options.sort&&lb()})}},dragOver:function(m){var p=m.target,t=m.completed;m=m.cancel;wa&&~O.indexOf(p)&&(t(!1),m())},revert:function(m){var p=m.fromSortable,t=m.rootEl,u=m.sortable,z=m.dragRect;1<O.length&&(O.forEach(function(B){u.addAnimationState({target:B,rect:wa?w(B):z});pa(B);B.fromRect=z;p.removeAnimationState(B)}),wa=!1,function(B,E){O.forEach(function(F,K){(K=E.children[F.sortableIndex+(B?Number(K):0)])?E.insertBefore(F,K):E.appendChild(F)})}(!this.options.removeCloneOnHide,t))},dragOverCompleted:function(m){var p=
m.sortable,t=m.isOwner,u=m.activeSortable,z=m.parentEl,B=m.putSortable,E=this.options;if(m.insertion){if(t&&u._hideClone(),gb=!1,E.animation&&1<O.length&&(wa||!t&&!u.options.sort&&!B)){var F=w(Z,!1,!0,!0);O.forEach(function(K){K!==Z&&(da(K,F),z.appendChild(K))});wa=!0}t||((wa||lb(),1<O.length)?(m=vb,u._showClone(p),u.options.animation&&!vb&&m&&va.forEach(function(K){u.addAnimationState({target:K,rect:Ma});K.fromRect=Ma;K.thisAnimationDuration=null})):u._showClone(p))}},dragOverAnimationCapture:function(m){var p=
m.dragRect,t=m.isOwner;m=m.activeSortable;if(O.forEach(function(u){u.thisAnimationDuration=null}),m.options.animation&&!t&&m.multiDrag.isMultiDrag)Ma=c({},p),p=v(Z,!0),Ma.top-=p.f,Ma.left-=p.e},dragOverAnimationComplete:function(){wa&&(wa=!1,lb())},drop:function(m){var p=m.originalEvent,t=m.rootEl,u=m.parentEl,z=m.sortable,B=m.dispatchSortableEvent,E=m.oldIndex,F=(m=m.putSortable)||this.sortable;if(p){var K=this.options,G=u.children;if(!Sa)if(K.multiDragKey&&!this.multiDragKeyDown&&this._deselectMultiDrag(),
n(Z,K.selectedClass,!~O.indexOf(Z)),~O.indexOf(Z))O.splice(O.indexOf(Z),1),fb=null,Ua({sortable:z,rootEl:t,name:"deselect",targetEl:Z,originalEvt:p});else{if(O.push(Z),Ua({sortable:z,rootEl:t,name:"select",targetEl:Z,originalEvt:p}),p.shiftKey&&fb&&z.el.contains(fb)){var N;var S=L(fb);var V=L(Z);if(~S&&~V&&S!==V)for(S=S<V?(N=S,V):(N=V,S+1);N<S;N++)~O.indexOf(G[N])||(n(G[N],K.selectedClass,!0),O.push(G[N]),Ua({sortable:z,rootEl:t,name:"select",targetEl:G[N],originalEvt:p}))}else fb=Z;Aa=F}if(Sa&&this.isMultiDrag){if((u[ka].options.sort||
u!==t)&&1<O.length){var ra=w(Z),W=L(Z,":not(."+this.options.selectedClass+")");if(!gb&&K.animation&&(Z.thisAnimationDuration=null),F.captureAnimationState(),!gb&&(K.animation&&(Z.fromRect=ra,O.forEach(function(Q){if(Q.thisAnimationDuration=null,Q!==Z){var Ba=wa?w(Q):ra;Q.fromRect=Ba;F.addAnimationState({target:Q,rect:Ba})}})),lb(),O.forEach(function(Q){G[W]?u.insertBefore(Q,G[W]):u.appendChild(Q);W++}),E===L(Z))){var ea=!1;O.forEach(function(Q){Q.sortableIndex===L(Q)||(ea=!0)});ea&&B("update")}O.forEach(function(Q){pa(Q)});
F.animateAll()}Aa=F}(t===u||m&&"clone"!==m.lastPutMode)&&va.forEach(function(Q){Q.parentNode&&Q.parentNode.removeChild(Q)})}},nullingGlobal:function(){this.isMultiDrag=Sa=!1;va.length=0},destroyGlobal:function(){this._deselectMultiDrag();g(document,"pointerup",this._deselectMultiDrag);g(document,"mouseup",this._deselectMultiDrag);g(document,"touchend",this._deselectMultiDrag);g(document,"keydown",this._checkKeyDown);g(document,"keyup",this._checkKeyUp)},_deselectMultiDrag:function(m){if(!(void 0!==
Sa&&Sa||Aa!==this.sortable||m&&q(m.target,this.options.draggable,this.sortable.el,!1)||m&&0!==m.button))for(;O.length;){var p=O[0];n(p,this.options.selectedClass,!1);O.shift();Ua({sortable:this.sortable,rootEl:this.sortable.el,name:"deselect",targetEl:p,originalEvt:m})}},_checkKeyDown:function(m){m.key===this.options.multiDragKey&&(this.multiDragKeyDown=!0)},_checkKeyUp:function(m){m.key===this.options.multiDragKey&&(this.multiDragKeyDown=!1)}},c(k,{pluginName:"multiDrag",utils:{select:function(m){var p=
m.parentNode[ka];p&&p.options.multiDrag&&!~O.indexOf(m)&&(Aa&&Aa!==p&&(Aa.multiDrag._deselectMultiDrag(),Aa=p),n(m,p.options.selectedClass,!0),O.push(m))},deselect:function(m){var p=m.parentNode[ka],t=O.indexOf(m);p&&p.options.multiDrag&&~t&&(n(m,p.options.selectedClass,!1),O.splice(t,1))}},eventProperties:function(){var m=this,p=[],t=[];return O.forEach(function(u){p.push({multiDragElement:u,index:u.sortableIndex});var z=wa&&u!==Z?-1:wa?L(u,":not(."+m.options.selectedClass+")"):L(u);t.push({multiDragElement:u,
index:z})}),{items:h(O),clones:[].concat(va),oldIndicies:p,newIndicies:t}},optionListeners:{multiDragKey:function(m){return"ctrl"===(m=m.toLowerCase())?m="Control":1<m.length&&(m=m.charAt(0).toUpperCase()+m.substr(1)),m}}})}),M});!function(a){function c(){if(!f)throw Error("jQuery is required for jquery-sortablejs");if(!e)throw Error("SortableJS is required for jquery-sortablejs (https://github.com/SortableJS/Sortable)");}if("function"==typeof define&&define.amd)try{define(["sortablejs","jquery"],function(h,b){e=h;f=b;c();a(h,b)})}catch(h){c()}else{if("object"==typeof exports)try{var e=require("sortablejs");var f=require("jquery")}catch(h){}"function"!=typeof jQuery&&"function"!=typeof $||(f=jQuery||$);"undefined"!=typeof Sortable&&
(e=Sortable);c();a(e,f)}}(function(a,c){c.fn.sortable=function(e){var f,h=arguments;return this.each(function(){var b=c(this),d=b.data("sortable");d||!(e instanceof Object)&&e?d&&("destroy"===e?(d.destroy(),b.removeData("sortable")):"widget"===e?f=d:"function"==typeof d[e]?f=d[e].apply(d,[].slice.call(h,1)):e in d.options&&(f=d.option.apply(d,h))):(d=new a(this,e),b.data("sortable",d))}),void 0===f?this:f}});(function(a){a.photos_sidebar={width:200,options:{},init:function(c){var e=this;this.options=c||{};c.width&&(this.width=c.width);e.wa2=c.wa2||!1;e.wa2?(e.$wrapper=c.$wrapper,this.initCollapsibleWa2(),this.initHandlers()):(this.initCollapsible(),this.initHandlers(),this.initView(),setTimeout(function(){e.initFixedSidebar()},1E3))},initFixedSidebar:function(){var c=a(window),e=a("#wa-app"),f=e.find(".p-sidebar-wrapper"),h=e.find(".p-sidebar-block"),b=c.height(),d=h.offset().top,g=!1,l=!1,q=!1,n=0;c.on("scroll",
function(){var r=c.scrollTop(),v=h.outerHeight(),y=e.height(),x=h.offset().top,w=n>r?1:-1,A=r-d,D=h.width(),J=v+parseInt(f.css("padding-top"))+parseInt(f.css("padding-bottom"))>=y;if(y>b&&!J)if(v<b)0<A?((g||!l||q)&&h.removeAttr("style").width(D).addClass("fixed-to-top"),q=!0):h.removeAttr("style").removeClass("fixed-to-bottom").removeClass("fixed-to-top");else if(r<=d){if(g||l||q)h.removeAttr("style").removeClass("fixed-to-bottom").removeClass("fixed-to-top"),g=l=q=!1}else if(r<=x&&x>=d)if(0<w){if(g||
!q||l)h.removeAttr("style").width(D).removeClass("fixed-to-bottom").addClass("fixed-to-top"),g=l=!1,q=!0}else{if(!g||q||l)h.css("top",x-d).removeClass("fixed-to-top").removeClass("fixed-to-bottom"),g=!0,q=l=!1}else if(r+b>=x+v)if(0<w){if(!g||q||l)h.css("top",x-d).removeClass("fixed-to-top").removeClass("fixed-to-bottom"),g=!0,q=l=!1}else{if(g||q||!l)h.removeAttr("style").width(D).removeClass("fixed-to-top").addClass("fixed-to-bottom"),g=q=!1,l=!0}else{if(!g||q||l)h.css("top",x-d).removeClass("fixed-to-top").removeClass("fixed-to-bottom"),
g=!0,q=l=!1}else if(g||q||l)h.removeAttr("style").removeClass("fixed-to-bottom").removeClass("fixed-to-top"),g=q=l=!1;n=r})},initView:function(){var c=a("#p-sidebar"),e=a("#p-sidebar-width-control");e.find("a.arrow").unbind("click").bind("click",function(){var f=c.attr("class"),h=0,b=f.match(/left([\d]{2,3})px/);if(b&&b[1]&&(h=parseInt(b[1]))&&(b=h+(a(this).is(".right")?50:-50),b=Math.max(Math.min(b,400),200),b!=h)){e.css({width:b.toString()+"px"});h=["left"+h+"px","left"+b+"px"];c.attr("class",f.replace(h[0],
h[1]));c.css("width","");var d=a("#p-content");d.length&&(f=d.attr("class"),d.attr("class",f.replace(h[0],h[1])),d.css("margin-left",""));a.photos_sidebar.width=b;a.post("?action=sidebarSaveWidth",{width:b},"json")}return!1})},initCollapsible:function(){a("#p-sidebar").off("click",".collapse-handler").on("click",".collapse-handler",function(){a.photos_sidebar._collapseSidebarSection(this,"toggle")});a("#p-sidebar .collapse-handler").each(function(){a.photos_sidebar._collapseSidebarSection(this,"restore")});
a("#album-list-container").off("uncollapse_section").on("uncollapse_section",function(c,e){e=a(e);c=a(this).find(">.collapse-handler");var f=e.find(">i.collapse-handler");a.photos_sidebar._collapseSidebarSection(f,"uncollapse");for(e=e.parent().parent();e.length&&e.get(0)!=this;){f=e.find(">i.collapse-handler");if(!f.length)break;a.photos_sidebar._collapseSidebarSection(f,"uncollapse");e=e.parent().parent()}a.photos_sidebar._collapseSidebarSection(c,"uncollapse")})},initCollapsibleWa2:function(){function c(b,
d){var g="photos/sidebar/collapsed_albums";"section"===d&&(g="photos/sidebar/collapsed_sections");return!!f(g)[b]}function e(b,d){var g=b.data("id"),l=b.hasClass("is-collapsed"),q="photos/sidebar/collapsed_albums";"section"===d&&(q="photos/sidebar/collapsed_sections");d=f(q);g&&(l?delete d[g]:d[g]=!0);localStorage.setItem(q,JSON.stringify(d));b.toggleClass("is-collapsed")}function f(b){return(b=localStorage.getItem(b))?JSON.parse(b):{}}var h=this.$wrapper.find(".p-sidebar-section");this.$wrapper.find(".js-album-list li").each(function(){var b=
a(this),d=b.data("id"),g=b.find(".caret");g.length&&(g.on("click",function(l){l.preventDefault();b.trigger("collapse_a")}),b.on("collapse_a",function(l){l.preventDefault();e(b,"album")}),d&&c(d,"album")&&b.trigger("collapse_a"))});h.each(function(){var b=a(this),d=b.data("id"),g=b.find(".heading .caret");g.length&&(g.on("click",function(l){l.preventDefault();b.trigger("collapse_s")}),b.on("collapse_s",function(l){l.preventDefault();e(b,"section")}),d&&c(d,"section")&&b.trigger("collapse_s"))})},initHandlers:function(){a("#p-upload-link").on("click",
function(c){c.preventDefault();a.photos.uploadDialog()});a("#album-list-container").off("click",".p-new-album").on("click",".p-new-album",function(){var c=a(this),e=0;c.is("#p-new-album")||(e=parseInt(c.parents("li:first").attr("rel"),10)||0);c=a("#album-create-dialog-acceptor");c.length||(c=a("<div id='album-create-dialog-acceptor'></div>"),a("body").append(c));c.load("?module=dialog&action=createAlbum&parent_id="+e,function(){a.waDialog({$wrapper:a("#album-create-dialog"),onOpen:function(f,h){f.find("input[type=text]").val("");
var b=f.find("form");b.find(".js-privacy-settings-link").on("click",function(){a(window).resize()});b.on("submit",function(d){d.preventDefault();a.post(b.attr("action"),b.serialize(),function(g){"ok"==g.status&&(a.photos.onCreateAlbum(g.data,e),h.close(),g.data.id&&a.photos.goToHash("/album/"+g.data.id))},"json")})}})});return!1})},countSubtree:function(c){var e=c.find(">.count:not(.subtree)"),f=c.find(">.subtree");f.length||(f=e.clone().addClass("subtree").hide(),e.after(f));var h=parseInt(e.text(),
10)||0;c.find("li.static>.count:not(.subtree)").each(function(){var b=parseInt(a(this).text(),10)||0;h+=b});f.hasClass("never-recount")||f.text(h);f.show();e.hide();return h},countItem:function(c){var e=c.find(">.count:not(.subtree)").show();c.find(">.subtree").hide();return parseInt(e.text(),10)||0},_collapseSidebarSection:function(c,e){e||(e="coollapse");c=a(c);if(c.length){var f=c.hasClass("darr")||c.hasClass("rarr")?c:c.find(".darr, .rarr");if(f.length){var h=c.parent(),b=h.find(".hierarchical:first");
b.length||(b=h.find(".collapsible-content:first"));b.length||(b=h.find("ul:first"));var d;c=c.attr("id")||c.parent().attr("id");var g=f.hasClass("darr")?"shown":"hidden",l=function(){b.hide();f.removeClass("darr").addClass("rarr");a.photos_sidebar.countSubtree(h);d="hidden"},q=function(){b.show();f.removeClass("rarr").addClass("darr");a.photos_sidebar.countItem(h);d="shown"};switch(e){case "toggle":"shown"==g?l():q();break;case "restore":c&&("hidden"==a.storage.get("photos/collapsible/"+c)?l():q());
break;case "uncollapse":q();break;default:l()}c&&d&&a.storage.set("photos/collapsible/"+c,d)}}}}})(jQuery);(function(a){function c(){var f=a.photos.getAlbum();return f&&f.type===Album.TYPE_STATIC&&!1!==f.edit_rights?!0:!1}function e(){a("#hint-menu-block").hide().children().hide()}a.photos_dragndrop={helper_shift:20,init:function(){var f={forceFallback:!0,ghostClass:"p-sortable-ghost",chosenClass:"p-sortable-chosen",dragClass:"p-sortable-drag",fallbackClass:"p-sortable-fallback",waHighlightClass:"bg-light-gray",group:"nested",draggable:">*:not(a)",animation:150,fallbackOnBody:!1,swapThreshold:.45,dragoverBubble:!0,
onAdd:function(b){(b=b.to.closest("li"))&&!b.querySelector(".caret")&&b.querySelector("a").insertAdjacentHTML("afterbegin",'<span class="caret"><i class="fas fa-caret-down"></i></span>')},onRemove:function(b){b=b.from;b.classList.contains("js-root-menu")||0!==b.childElementCount||(b=b.closest("li").querySelector(".caret"))&&b.remove()},onMove:function(b){var d,g,l=null!=(g=null==(d=this.options)?void 0:d.waHighlightClass)?g:"bg-light-gray",q;h.forEach(function(n){return null==(q=n.closest("li"))?
void 0:q.classList.remove(l)});b=b.related.parentElement;b.classList.toggle(l,"LI"===b.tagName)},onUpdate:function(b){},onEnd:function(b){var d,g,l=null!=(g=null==(d=this.options)?void 0:d.waHighlightClass)?g:"bg-light-gray",q;h.forEach(function(n){return null==(q=n.closest("li"))?void 0:q.classList.remove(l)});g=a(b.item);d=g.parent("ul").parent("li");b=g.data("id");g=g.next().data("id")||null;d=d.length?d.data("id"):0;a.post("?module=album&action=move",{id:b,before_id:g,parent_id:d},function(n){var r=
a.photos.getAlbum(),v=n.data.album,y=n.data.counters;0>=v.status&&a.photos_dragndrop.privateDescendants(v.id)&&a.photos.dispatch("album/"+v.id+"/");r&&r.id==v.id&&((n=n.data.frontend_link)&&a("#photo-list-frontend-link").attr("href",n).text(n),v.type==Album.TYPE_DYNAMIC&&a.photos.load("?module=album&action=photos&id="+v.id,a.photos.onLoadPhotoList));if(!a.isEmptyObject(y))for(var x in y)y.hasOwnProperty(x)&&album_list.find("li[rel="+x+"]").find(".count:first").text(y[x])},"json")}},h=Array.from(document.querySelector("#album-list").querySelectorAll("ul"));
h.forEach(function(b){return new Sortable(b,f)})},_initDragPhotos:function(){var f={opacity:.75,zIndex:9999,distance:5,appendTo:"body",cursor:"move",refreshPositions:!0,start:function(d,g){document.ondragstart=function(){return!1};g.helper.data("scrollTop",a(document).scrollTop());a(document).bind("scroll",a.photos_dragndrop._scrolHelper);a("#album-list-container").addClass("p-drag-active")},stop:function(d,g){document.ondragstart=null;a(document).unbind("scroll",a.photos_dragndrop._scrolHelper);
a("#album-list-container").removeClass("p-drag-active");e()},drag:function(d,g){d=d.originalEvent;g.position.left=d.pageX-a.photos_dragndrop.helper_shift;g.position.top=d.pageY}},h=f.start,b=f.stop;void 0!=a.support.touch&&1!=a.support.touch&&a("img",a("#photo-list")).liveDraggable(a.extend({},f,{containment:[0,0,a(window).width(),{toString:function(){return a(document).height()}}],helper:function(d){d=a(this).parents("li:first");var g=a("#photo-list li.selected"),l=g.length?g.length:1,q=[d.attr("data-photo-id")],
n=!1,r=d.get(0);g.each(function(){this!=r?q.push(a(this).attr("data-photo-id")):n=!0});!n&&g.length&&(d.addClass("selected").find("input:first").trigger("select",!0),++l);d.data("photo_ids",q);return'<div id="helper"><span class="indicator red">'+l+'</span><i class="icon10 no-bw" style="display:none;"></i></div>'},handle:".p-image",start:function(d,g){h.apply(this,[d,g]);d=a(this).parents("li:first");1==d.data("photo_ids").length&&d.addClass("selected")},stop:function(d,g){b.apply(this,[d,g]);d=a(this).parents("li:first");
1==d.data("photo_ids").length&&d.removeClass("selected")}}));a("#photo").liveDraggable(a.extend({},f,{containment:"body",start:function(d,g){if(!a(d.target).hasClass("ui-draggable"))return!1},helper:function(){return'<div id="helper"><span class="indicator red">1</span><i class="icon10 no-bw" style="display:none;"></i></div>'}}))},_initDropPhotos:function(){a("li",a("#photo-list")).liveDroppable({disabled:!1,greedy:!0,tolerance:"pointer",over:function(f,h){if(h.draggable.hasClass("dr"))return!1;if(c())e();
else if(f=a.photos.getOption("sort_method"))h=a("#hint-menu-block").show(),h.children().hide(),h.find("."+f).show();a.photos_dragndrop._activatePhotoListItem.call(this)},out:function(f,h){a.photos_dragndrop._unactivatePhotoListItem.call(this)},drop:function(f,h){f=c();var b=a.photos.getAlbum();h=h.draggable.parents("li:first");var d=a(this);if(h.get(0)==this||d.hasClass("selected"))return a.photos_dragndrop._unactivatePhotoListItem.call(this),!1;var g=a("#photo-list li.selected");g.length||(g=h);
a.photos_dragndrop._unactivatePhotoListItem.call(this);a.photos_dragndrop._unactivatePhotoListItem.call(h);if(!f)return!1;var l=parseInt(d.attr("data-photo-id"));d.hasClass("last")?(l=null,d.after(g),d.removeClass("last"),a("#photo-list li:last").addClass("last")):(d.before(g),h.hasClass("last")&&(h.removeClass("last"),a("#photo-list li:last").addClass("last")));g.trigger("select",!1);var q=[];g.each(function(){q.push(parseInt(a(this).attr("data-photo-id")))});a.post("?module=album&action=photoMove",
{photo_id:q,album_id:b.id,before_id:l},function(n){"ok"==n.status&&a.photos.photo_stream_cache.move(q,l)},"json")}})},_initDragAlbums:function(){var f=a("#js-app-sidebar"),h=f.position(),b=f.width();f=f.height();a("#album-list").find("li.dr").liveDraggable({containment:[h.left,h.top,h.left+b+.25*b,h.top+f],refreshPositions:!0,revert:"invalid",helper:function(){var d=a(this).clone().addClass("ui-draggable").css({position:"absolute"}).prependTo("#album-list > ul");d.find("a:first").append('<i class="fas fa-times" style="margin-left: 0; margin-right: 0; display:none;"></i>');
return d},cursor:"move",cursorAt:{left:5},opacity:.75,zIndex:9999,distance:5,start:function(d,g){document.ondragstart=function(){return!1}},stop:function(){document.ondragstart=null}})},_initDropAlbums:function(){this._initDropBetweenAlbums();this._initDropInsideAlbums()},_initDropBetweenAlbums:function(){a("#album-list").find("li.drag-newposition").liveDroppable({accept:"li.dr",greedy:!0,tolerance:"pointer",over:function(f,h){if("IMG"==h.draggable.get(0).tagName)return!1;a(this).addClass("active").parent().parent().addClass("drag-active")},
out:function(f,h){a(this).removeClass("active").parent().parent().removeClass("drag-active")},deactivate:function(f,h){var b=a(this);(b.is(":animated")||b.hasClass("dragging"))&&b.stop().animate({height:"0px"},300,null,function(){b.removeClass("dragging")});a(this).removeClass("active").parent().parent().removeClass("drag-active")},drop:function(f,h){if("IMG"==h.draggable.get(0).tagName)return!1;var b=a(this).parent("ul");h=a(h.draggable);f=h.attr("rel");var d=a(this).prev("li");if(d.length&&d.attr("rel")==
f&&!d.hasClass("ui-draggable")||this==h.next().get(0))return!1;b=b.parent("li").length?b.parent("li").attr("rel"):0;d=a(this).next();var g=null;d.length&&(g=d.attr("rel"));a.post("?module=album&action=move",{id:f,before_id:g,parent_id:b},function(l){var q=a.photos.getAlbum(),n=l.data.album,r=l.data.counters;0>=n.status&&a.photos_dragndrop.privateDescendants(n.id)&&a.photos.dispatch("album/"+n.id+"/");q&&q.id==n.id&&((l=l.data.frontend_link)&&a("#photo-list-frontend-link").attr("href",l).text(l),n.type==
Album.TYPE_DYNAMIC&&a.photos.load("?module=album&action=photos&id="+n.id,a.photos.onLoadPhotoList));if(!a.isEmptyObject(r))for(var v in r)r.hasOwnProperty(v)&&album_list.find("li[rel="+v+"]").find(".count:first").text(r[v])},"json");b=h.parent("ul");f=b.children("li.dr[rel!="+f+"]").length;h.next().insertAfter(a(this));h.insertAfter(a(this));f||(b.parent("li").children("i").remove(),b.remove())}})},privateDescendants:function(f,h){h="boolean"===typeof h?h:!0;f=a("#album-list").find("li[rel="+f+"]");
h=h?f:a();changed=!1;h.add(f.find("li.dr")).each(function(){var b=a(this).find(">a");if(!b.find("i.lock-bw").length){var d=b.find(".pictures").next();d.length?(changed=!0,d.before('<i class="fas fa-lock"></i>')):b.append('<i class="fas fa-lock"></i>')}});return changed},_initDropInsideAlbums:function(){a("li.dr a",a("#album-list")).liveDroppable({accept:function(f){return f.is("li.dr, img#photo")||f.closest("li[data-photo-id]").length?!0:!1},tolerance:"custom",greedy:!0,out:function(f,h){a(this).parent().removeClass("drag-newparent");
h.helper.find("span").show().end().find("i").hide()},over:function(f,h){f=a(this).parent();var b=!1;h.draggable=a.photos_dragndrop._fixUiDraggable(h.draggable);if(h.draggable.parents("#photo-list").length||h.draggable.is("#photo"))f.hasClass("static")?h.helper.find("span").show().end().find("i").hide():h.helper.find("span").hide().end().find("i").show(),b=!0;f.addClass("drag-newparent");if(b)return!1;if(h.draggable.hasClass("static")&&!f.hasClass("static"))return h.helper.find("i.no-bw").show(),!1;
h.helper.find("i.no-bw").hide();var d='.dr[rel!="'+a(h.draggable).attr("rel")+'"]',g=a(),l=function(n,r){if(0>=r.length)return n;n=n.add(r.nextUntil(d).filter("li.drag-newposition"));return 0<r.nextAll(d).length?n:l(n,r.parent().closest("li"))};h=f.prevAll(d).first();0<h.length?(b=h.find(d),g=0<b.length?l(g,b.last()):l(g,h)):g=g.add(f.prevUntil(d).filter("li.drag-newposition"));g=0<f.children("ul").children(d).length?g.add(f.children("ul").children("li.drag-newposition:first")):l(g,f);var q=a(".drag-newposition:animated, .drag-newposition.dragging").not(g);
q.stop().animate({height:"0px"},300,null,function(){q.removeClass("dragging")});g.stop().animate({height:"10px"},300,null,function(){g.addClass("dragging")})},drop:function(f,h){f=a(this).parent().removeClass("drag-newparent");h.draggable=a.photos_dragndrop._fixUiDraggable(h.draggable);if(h.draggable.parents("#photo-list").length||h.draggable.is("#photo")){var b=this.href.match(/.*#\/album\/([\d]+)/);if(null===b||!parseInt(b[1],10)){console&&console.log("Link: "+this.href+" is not correct");return}b=
parseInt(b[1],10);var d=null;f.hasClass("static")&&(d=h.draggable.is("#photo")?[a.photos.photo_stream_cache.getCurrent().id]:h.draggable.data("photo_ids"));d&&(a.photos.addToAlbums({photo_id:d,album_id:b}),a("#photo-list li.selected").trigger("select",!1));return!1}if(h.draggable.hasClass("static")&&!f.hasClass("static"))return!1;b=a(h.draggable);if(f.attr("rel")==b.attr("rel"))return!1;f.hasClass("drag-newposition")?h=f.parent("ul"):f.children("ul").length?h=f.children("ul"):(h=a('<ul class="menu dr"><li class="drag-newposition"></li></ul>').appendTo(f),
h.find(".drag-newposition").mouseover(),a('<i class="icon16 darr overhanging"></i>').insertBefore(f.children("a")));d=b.attr("rel");f=f.attr("rel");if(f==b.parent("ul").parent("li.dr").attr("rel"))return!1;a.post("?module=album&action=move",{id:d,parent_id:f},function(l){var q=a.photos.getAlbum(),n=l.data.album,r=l.data.counters;0>=n.status&&a.photos_dragndrop.privateDescendants(n.id)&&a.photos.dispatch("album/"+n.id+"/");q&&q.id==n.id&&((l=l.data.frontend_link)&&a("#photo-list-frontend-link").attr("href",
l).text(l),n.type==Album.TYPE_DYNAMIC&&a.photos.load("?module=album&action=photos&id="+n.id,a.photos.onLoadPhotoList));n=a("#album-list");if(!a.isEmptyObject(r))for(var v in r)r.hasOwnProperty(v)&&n.find("li[rel="+v+"]").find(".count:first").text(r[v])},"json");f=b.parent("ul");d=f.children("li.dr[rel!="+d+"]").length;var g=b.next();b.appendTo(h);g.appendTo(h);d||(f.parent("li").children("i").remove(),f.remove())}})},_scrolHelper:function(f){f=a("#helper");var h=f.data("scrollTop"),b=a(document).scrollTop();
h=h?b-h:50;f.css("top",f.position().top+h+"px");f.data("scrollTop",b)},_dropAnimation:function(f,h){var b=[];f.each(function(){var d=a(this),g=d.offset(),l=d.clone().css({"z-index":10,position:"absolute",top:g.top,left:g.left}).insertAfter(d);d.css({opacity:0});b.push(d.hide(300).promise());b.push(l.animate({top:g.top,left:g.left},300).promise().done(function(){a(this).remove()}))});a.when.apply(a,b).done(function(){"function"===typeof h&&h()})},_shiftToLeft:function(f){if("left"!==f.data("shifted")){var h=
f.find(".p-wrapper");if(!h.length){var b=f.children();h=a("<div class='p-wrapper' style='position:relative;'></div>").appendTo(f);h.append(b)}h.stop().animate({left:-15},200);f.data("shifted","left")}},_shiftToRight:function(f){if("right"!==f.data("shifted")){var h=f.find(".p-wrapper");if(!h.length){var b=f.children();h=a("<div class='p-wrapper' style='position:relative;'></div>").appendTo(f);h.append(b)}h.stop().animate({left:15},200);f.data("shifted","right")}},_shiftAtPlace:function(f){if(f.data("shifted")){var h=
f.find(".p-wrapper");if(h.length){var b=h.children();h.stop().css({left:0});f.append(b);h.remove()}f.data("shifted","")}},_bindExtDragActivate:function(f,h){a(document).bind("mousemove.ext_drag_activate",function(b){a.photos_dragndrop._extDragActivate(b,f,h)})},_unbindExtDragActivate:function(){a(document).unbind("mousemove.ext_drag_activate")},_activatePhotoListItem:function(){var f=a(this),h=c(),b=h?"drag-active":"drag-active-disabled";h&&a.photos_dragndrop._shiftToRight(f);f.hasClass("last")?a.photos_dragndrop._bindExtDragActivate(f,
b):f.addClass(b)},_unactivatePhotoListItem:function(f){f=a(this);var h=c(),b=h?"drag-active":"drag-active-disabled",d=b+"-last";f.hasClass("last")&&a.photos_dragndrop._unbindExtDragActivate();f.removeClass(b+" "+d);h&&a.photos_dragndrop._shiftAtPlace(f)},_extDragActivate:function(f,h,b){var d=b+"-last";if(h.hasClass("last")){var g=f.pageX;f=f.pageY;var l=h.width(),q=h.height(),n=h.position();"template-photo-thumbs"==a.photos.list_template?g>n.left+.5*l&&g<=n.left+l?(h.removeClass(b).addClass(d),a.photos_dragndrop._shiftToLeft(h)):
g>n.left&&g<=n.left+.5*l?(h.removeClass(d).addClass(b),a.photos_dragndrop._shiftToRight(h)):a.photos_dragndrop._shiftAtPlace(h):"template-photo-descriptions"==a.photos.list_template&&(f>n.top+.5*q?h.removeClass(b).addClass(d):f>n.top&&h.removeClass(d).addClass(b));(f<n.top||f>n.top+q||g<n.left||g>n.left+l)&&h.removeClass(b).removeClass(d)}else h.addClass(b)},_fixUiDraggable:function(f){if(f.is("#photo"))return f;"IMG"==f.get(0).tagName&&(f=f.parents("li:first"));return f},_extendJqueryUIDragAndDrop:function(){a.fn.liveDraggable=
function(h){this.each(function(d,g){d=a(this);d.data("init_draggable")&&d.off("mouseover",d.data("init_draggable"))});var b;this.on("mouseover",b=function(){var d=a(this);d.data("init_draggable")||d.data("init_draggable",b).draggable(h)})};a.fn.liveDroppable=function(h){this.each(function(d,g){d=a(this);d.data("init_droppable")&&d.off("mouseover",d.data("init_droppable"))});var b=function(){var d=a(this);d.data("init_droppable")||(d.data("init_droppable",b).droppable(h),d.mouseover())};b.call(this);
this.off("mouseover",b).on("mouseover",b);this.on("mouseover",b)};var f=a.ui.intersect;a.ui.intersect=function(h,b,d){a(h.element).is("#photo")||"custom"!=d||(d="pointer");if("custom"!=d)return f.call(a.ui,h,b,d);d=b.offset.left;var g=b.offset.top;h=h.helper.position();return a.ui.isOver(h.top,h.left+a.photos_dragndrop.helper_shift,g,d,b.proportions.height,b.proportions.width)}}}})(jQuery);(function(a){var c=function(e,f){var h=/[^\w\-\.:]/.test(e)?new Function(c.arg+",tmpl","var _e=tmpl.encode"+c.helper+",_s='"+e.replace(c.regexp,c.func)+"';return _s;"):c.cache[e]=c.cache[e]||c(c.load(e));return f?h(f,c):function(b){return h(b,c)}};c.cache={};c.load=function(e){var f=document.getElementById(e),h=/<\\\/(\w+)/g;!f&&console&&console.log("template with id="+e+" not found");return f?("textarea"==f.tagName.toLowerCase()?f.value:document.getElementById(e).innerHTML).replace(h,"</$1"):null};
c.regexp=/([\s'\\])(?![^%]*%\})|(?:\{%(=|#)([\s\S]+?)%\})|(\{%)|(%\})/g;c.func=function(e,f,h,b,d,g){if(f)return{"\n":"\\n","\r":"\\r","\t":"\\t"," ":" "}[e]||"\\"+e;if(h)return"="===h?"'+_e("+b+")+'":"'+("+b+"||'')+'";if(d)return"';";if(g)return"_s+='"};c.encReg=/[<>&"'\x00]/g;c.encMap={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;"};c.encode=function(e){return String(e||"").replace(c.encReg,function(f){return c.encMap[f]||""})};c.arg="o";c.helper=",print=function(s,e){_s+=e&&(s||'')||_e(s);},include=function(s,d){_s+=tmpl(s,d);}";
"function"===typeof define&&define.amd?define(function(){return c}):a.tmpl=c})(this);(function(a){a.fn.inlineEditable=function(c,e){function f(){l(a(this))||a(this).addClass(n.placeholderClass).text(n.placeholder)}function h(){v="edit";this.id=this.id||(""+Math.random()).slice(2);var x=this.id+"-input",w=a("#"+x);if(!w.length){var A=r,D=A.after;a:switch(n.inputType){case "textarea":var J='<textarea id="'+x+'" style="display:none;"></textarea>';break a;default:J='<input type="text" id="'+x+'" style="display:none;">'}D.call(A,J);w=a("#"+x)}d(w,r);n.placeholder&&l(a(this))==n.placeholder&&
l(a(r))==n.placeholder&&a(r).text("").removeClass(n.placeholderClass);n.beforeMakeEditable.call(this,w);y=n.truncate?r.data("real_text"):l(r);w.val(y).show().focus();r.hide();a(n.editLink).hide();if(!q){x=[];var L=[];A=0;for(D=n.makeReadableBy.length;A<D;++A)J=n.makeReadableBy[A],"blur"==J&&w.blur(function(){"read"!=v&&b.call(this)}),"enter"==J&&x.push(13),"esc"==J&&x.push(27);A=0;for(D=n.updateBy.length;A<D;++A)J=n.updateBy[A],"alt+enter"==J&&L.push({ctrl:!1,alt:!0,shift:!1,key:13}),"ctrl+enter"==
J&&L.push({ctrl:!0,alt:!1,shift:!1,key:13}),"ctrl+s"==J&&L.push({ctrl:!0,alt:!1,shift:!1,key:17});x.length&&function(C){w.keydown(function(H){!~C.indexOf(H.keyCode)||H.ctrlKey||H.altKey||H.shiftKey||"read"!=v&&b.call(this,27==H.keyCode?y:null);if(L.length)for(var T in L){var X=L[T];if(H.keyCode==X.key&&H.ctrlKey==X.ctrl&&H.altKey==X.alt&&H.shiftKey==X.shift){r.trigger("readable");break}}})}(x);r.bind("readable",function(C,H){"read"!=v&&(C=a("#"+(this.id+"-input")),b.call(C,C.val(),H))});q=!0}}function b(x,
w){w="undefined"===typeof w?!1:!0;void 0!=x&&null!=x?a(this).val(x):x=a(this).val();if(!1!==w||!1!==n.beforeBackReadable.call(r.get(0),this,{changed:x!=y,old_text:y,new_text:x})){v="read";var A;(A=!n.placeholder)||(a(this).val()?A=!1:(a(r).text(n.placeholder).addClass(n.placeholderClass),A=!0),A=!A);if(A&&(n.allowEmpty||x)){if(n.truncate)r.data("real_text",x),r.text(x.length<n.truncate-3?x:x.substr(0,n.truncate-3)+"...");else{A=r;var D=x;n.html?A.html(D):A.text(D)}x||f.call(this)}r.show();a(this).hide();
a(n.editLink).show();!1===w&&n.afterBackReadable.call(r.get(0),this,{changed:x!=y,old_text:y})}}function d(x,w){var A=n.size.height||w.height();w=n.size.width||1.5*w.width();A=n.minSize.height&&A<n.minSize.height?n.minSize.height:A;w=n.minSize.width&&w<n.minSize.width?n.minSize.width:w;A=n.maxSize.height&&A>n.maxSize.height?n.maxSize.height:A;w=n.maxSize.width&&w>n.maxSize.width?n.maxSize.width:w;x.height(A);x.width(w)}function g(x){return function(){return x}}function l(x){return n.html?x.html():
x.text()}var q=!1;if("string"==typeof c){if("setOption"==c){var n=this.data("inlineEditableSettings")||{};a.extend(!0,n,e);"undefined"!==typeof e.hold&&"function"!==typeof e.hold&&(n.hold=g(n.hold));this.data("inlineEditableSettings",n)}return this}e=this.data("inlineEditableSettings");this.data("inlineEditableSettings",a.extend({inputType:"text",size:{height:null,width:null},minSize:{height:null,width:null},maxSize:{height:null,width:null},editLink:null,editOnItself:!0,placeholder:null,makeReadableBy:["blur",
"enter","esc"],updateBy:["ctrl+enter","alt+enter"],beforeBackReadable:function(){},afterBackReadable:function(){},beforeMakeEditable:function(){},placeholderClass:"hint",truncate:!1,hold:!1,html:!1,allowEmpty:!1},e,c||{}));n=this.data("inlineEditableSettings");var r=this,v="read",y="";"function"!==typeof n.hold&&(n.hold=g(n.hold));(function(){if(!this.data("inited")){n.truncate&&"boolean"==typeof n.truncate&&(n.truncate=255);if(n.truncate){var x=n.placeholder&&n.placeholder===this.text()?"":this.text();
this.data("real_text",x);this.text(x.length<n.truncate-3?x:x.substr(0,n.truncate-3)+"...")}n.placeholder&&f.call(this);n.editLink&&a(n.editLink).click(function(){n.hold.call(r)||"edit"!=v&&h.call(r.get(0))});n.editOnItself&&this.click(function(){n.hold.call(r)||"edit"!=v&&h.call(this)});this.bind("editable",function(){n.hold.call(r)||"edit"!=v&&h.call(this)});this.bind("placeholder",function(w,A){A&&n.placeholder&&f.call(this);A||a(this).removeClass(n.placeholderClass)});this.data("inited",!0)}}).call(this);
return this}})(jQuery);(function(a){a.fn.activeMenu=function(c,e,f){if("string"==typeof c){if("disable"==c||"enable"==c)return a.isArray(e)||(e=[e]),this.find("li").each(function(){var d=a(this);~e.indexOf(d.attr("data-action"))&&("disable"==c?d.hide():d.show())}),this;if("setOption"==c){var h=this.data("activeMenuSettings");if(!h)return;if("string"===typeof e){var b={};b[e]=f;e=b}a.extend(h,e);return this}}if("string"==typeof c&&"fire"==c){h=this.data("activeMenuSettings");if(!h)return;h["on"+c.substr(0,1).toUpperCase()+
c.substr(1)].call(this);return this}this.data("activeMenuSettings",a.extend({beforeAnyAction:function(){},defaultAction:function(){},onInit:function(){},onFire:function(){}},c||{}));if(h=this.data("activeMenuSettings"))return function(){var d=this;d.data("inited")||(d.bind("click.photos-active-menu",function(g){for(var l=g.target,q=d.get(0);"LI"!=l.tagName;){if(l==q)return;l=a(l).parent().get(0)}l=a(l);q=l.attr("data-action")||"default";q=q.split("-");for(var n=1;n<q.length;n++)q[n]=q[n][0].toUpperCase()+
q[n].slice(1);q=q.join("");q+="Action";h[q]&&"function"==typeof h[q]||(q="defaultAction");if(!1!==h.beforeAnyAction(l.attr("data-action")))h[q](l,g);g.preventDefault()}),h.onInit(d),d.data("inited",!0))}.call(this),this}})(jQuery);(function(a){a.fn.rateWidget=function(c,e,f){function h(l){var q=0;this.find("svg").removeClass("fa-star-half-alt").attr("data-prefix","far").each(function(){if(q==l)return!1;q++;q>l?.5==q-l&&a(this).attr("data-prefix","fas").addClass("fa-star-half-alt"):a(this).attr("data-prefix","fas")});this.attr("data-rate",l)}function b(l){return function(){return l}}if("string"==typeof c){if("getOption"==c&&"rate"==e)return parseInt(this.attr("data-rate"));"setOption"==c&&("rate"==e&&(e=parseFloat(f)||0,h.call(this,
Math.round(2*e)/2),e={rate:f}),"object"===typeof e&&e&&(f=this.data("rateWidgetSettings")||{},a.extend(f,e),"undefined"!==typeof e.hold&&"function"!==typeof e.hold&&(f.hold=b(f.hold))));return this}this.data("rateWidgetSettings",a.extend({onUpdate:function(){},rate:null,hold:!1,withClearAction:!0,alwaysUpdate:!1},c||{}));var d=this.data("rateWidgetSettings"),g=this;"function"!==typeof d.hold&&(d.hold=b(d.hold));(function(){if(!g.data("inited")){null!=d.rate&&g.attr("data-rate",d.rate);g.find("svg:lt("+
g.attr("data-rate")+")").attr("data-prefix","fas");g.mouseover(function(r){d.hold.call(g)||(r=r.target,"svg"===r.tagName&&(r=a(r),r.prevAll().addBack().removeClass("fa-star-half-alt").attr("data-prefix","fas"),r.nextAll().removeClass("fa-star-half-alt").attr("data-prefix","far")))}).mouseleave(function(){d.hold.call(g)||h.call(g,g.attr("data-rate"))});g.on("click",function(r){if(!d.hold.call(g)){r=r.target;"path"===r.tagName&&(r=r.ownerSVGElement);var v=g.attr("data-rate"),y=a(r).attr("data-rate-value");
v!=y&&g.find("svg").removeClass("fa-star-half-alt").attr("data-prefix","far").each(function(){a(this).attr("data-prefix","fas");if(a(this).attr("data-rate-value")==y){if(d.alwaysUpdate||v!=y)g.attr("data-rate",y),d.onUpdate(y);return!1}})}});if(d.withClearAction){var l="clear-"+a(this).attr("id"),q=a("#"+l);q.length||(g.after('<a href="javascript:void(0);" class="p-rate-clear" id="'+l+'" style="display:none;">'+$_("clear")+"</a>"),q=a("#"+l));q.on("click",function(r){r.preventDefault();if(!d.hold.call(g)&&
(r=g.attr("data-rate"),h.call(g,0),0!=r))d.onUpdate(0)});var n;g.parent().mousemove(function(){d.hold.call(g)||(n&&clearTimeout(n),q.show(0))}).mouseleave(function(){n=setTimeout(function(){d.hold.call(g)||q.hide(0)},150)})}this.data("inited",!0)}}).call(this);return this}})(jQuery);var PhotoStream=function(){var a=function(c){this._options=c||{};this._onClear=this._options.onClear||function(){};this._photo_stream=[]};$.extend(a.prototype,{getById:function(c){for(var e=0,f=this._photo_stream[0],h=this._photo_stream.length;e<h;f=this._photo_stream[++e])if(f&&f.id==c)return f;return null},updateById:function(c,e,f){if(c=this.getById(c))return $.extend(c,e),c;f&&this._photo_stream.push(e);return e},deleteById:function(c){$.isArray(c)||(c=[c]);var e=c,f=0,h=e.length;for(c=e[0];f<
h;c=e[++f])(c=this.getById(c))&&c.index&&delete this._photo_stream[c.index];e=[];var b=0;f=0;h=this._photo_stream.length;for(c=this._photo_stream[0];f<h;c=this._photo_stream[++f])c&&(c.index=b++,e.push(c));this._photo_stream=e;return this},replace:function(c,e){c=c.index;this._photo_stream[c]=e;e.index=c;return this},push:function(c){this._photo_stream.push(c);c.index=this._photo_stream.length-1;return this},getNext:function(c){c=c||this.current;"object"!=typeof c&&(c=this.getById(c));if(!c)return null;
c=c.index+1;return this._photo_stream[c]?this._photo_stream[c]:null},getPrev:function(c){c=c||this.current;"object"!=typeof c&&(c=this.getById(c));if(!c)return null;c=c.index-1;return this._photo_stream[c]?this._photo_stream[c]:null},setCurrent:function(c){if(!c.index&&(c=this.getById(c.id),!c||"number"!==typeof c.index&&!c.index))throw Error("This photo is not in stream");this.current=c;return this},setCurrentById:function(c){c=this.getById(c);"object"===typeof c&&c&&this.setCurrent(c);return this},
getCurrent:function(){return this.current},getCurrentId:function(){return"object"===typeof this.current&&this.current?this.current.id:null},set:function(c){this._photo_stream=[];this.append(c);this.isEmpty()||this.setCurrent(this.getFirst());return this},append:function(c){for(var e=0,f=c[e],h=this._photo_stream.length,b=c.length;e<b;f=c[++e],++h)f.index=h,this._photo_stream.push(f);return this},prepend:function(c){var e=this._photo_stream||[];this._photo_stream=[];for(var f=0,h=c[f],b=c.length;f<
b;h=c[++f])h.index=f,this._photo_stream.push(h);this.append(e);return this},clear:function(){this._photo_stream=[];this._onClear();return this},length:function(){return this._photo_stream.length},getAll:function(){return this._photo_stream},getFirst:function(){return this._photo_stream[0]},getLast:function(){return this._photo_stream[this._photo_stream.length-1]},isFirst:function(c){return c&&0==c.index},isLast:function(c){return c&&c.index==this._photo_stream.length-1},isEmpty:function(){return!this._photo_stream.length},
getCurrentIndex:function(){return this.current.index},slice:function(c,e){return this._photo_stream.slice(c,e)},move:function(c,e){var f=[],h=this._photo_stream;if($.isArray(c))for(var b=0,d=c.length;b<d;++b){var g=this.getById(c[b]);delete h[g.index];f.push(g)}else g=this.getById(c),delete h[g.index],f.push(g);if(f.length)for(g="undefined"===typeof e||null===e?this._photo_stream.length:(g=this.getById(e))?g.index:0,Array.prototype.splice.apply(h,[g,0].concat(f)),this.clear(),b=f=0,d=h.length;b<d;++b)g=
h[b],"object"===typeof g&&g&&(g.index=f++,this._photo_stream.push(g))}});return a}();Date.parseISO=function(a){var c=Date.parse(a);if(!isNaN(c))return c;a=a.match(/([0-9]{4})-([0-9]{2})-([0-9]{2}) ([0-9]{2}):([0-9]{2}):([0-9]{2})/);c=new Date(a[1],0,1);a[2]&&c.setMonth(a[2]-1);a[3]&&c.setDate(a[3]);a[4]&&c.setHours(a[4]);a[5]&&c.setMinutes(a[5]);a[6]&&c.setSeconds(a[6]);return+c};
function replaceImg(a,c,e,f){f=f||a.attr("id")||(""+Math.random()).slice(2);replaceImg.loading_map=replaceImg.loading_map||{};replaceImg.loading_map[f]=c;a.unbind("load");null===e?a.attr("src",c):$("<img>").attr("src",c).load(function(){setTimeout(function(){replaceImg.loading_map[f]==c&&(a.attr("src",c),"function"==typeof e&&e.call(a));$(this).remove()},100)});return f}
String.prototype.truncate=function(a,c){var e="";if("undefined"===typeof c||c)e=this.replace(/<\/?[\s\S]+?\/?>/g,"");e.length>a-3&&3<a&&(e=e.substr(0,a-3)+"...");return e};function parseSize(a){var c="unknown";a=(""+a).split("x");var e=a[0]&&0!=a[0]?a[0]:null,f=a[1]&&0!=a[1]?a[1]:null;1==a.length?(c="max",f=e):e==f?c="crop":e&&f?c="rectangle":null===e?c="height":null===f&&(c="width");return{type:c,width:e,height:f}}
function getRealSizesOfThumb(a,c){var e=parseInt(a.width,10),f=parseInt(a.height,10),h=e/f,b=f/e;if(isNaN(h)||isNaN(b))return null;var d="object"!==typeof c?parseSize(c):c;var g=d.width;c=d.height;switch(d.type){case "max":e>f?(h=g,b*=h):(b=g,h*=b);break;case "crop":h=b=g;break;case "rectangle":h=g;b=c;break;case "width":h=g;b*=h;break;case "height":b=c;h*=b;break;default:h=b=null}h=Math.round(h);b=Math.round(b);return e<h&&f<b?{width:a.width,height:a.height}:{width:h,height:b}};(function(a){a.fn.photoStreamSlider=function(c){var e=a.extend({duration:200},c||{}),f=this;(function(){function h(w){function A(){h.execution=!1;var T="on"+D.charAt(0).toUpperCase()+D.slice(1);T=e[T];"function"==typeof T&&T.call(f);T=w.fn;"function"==typeof T&&T.call(f)}"string"==typeof w&&(w={direction:w,animate:!0});var D=w.direction||"forward",J=w.steps||d.length;if(!h.execution){h.execution=!0;var L=d.filter(":first").outerWidth()*J,C=d.length;if("forward"==D){var H=d.filter(":last").nextAll(":lt("+
J+")");J=H.length;H=H.filter(":last");J&&(d.removeClass("visible"),H.prevAll(":lt("+(C-1)+")").addClass("visible"),H.addClass("visible"))}else H=d.filter(":first").prevAll(":lt("+J+")"),J=H.length,H=H.filter(":last"),J&&(d.removeClass("visible"),H.nextAll(":lt("+(C-1)+")").addClass("visible").show(),H.addClass("visible"));d=a("li.visible",b);C=b.position().left;"forward"==D?(J=q-l-v,C-=L,C=C>-J?C:-J):(C+=L,C=C<v?C:v);w.animate?b.animate({left:C},e.duration,A):(b.css({left:C}),A())}}var b=f.find(e.photoStream),
d=a("li.visible",b),g=a("li",b),l=d.filter(":first").outerWidth()*d.length,q=g.filter(":first").outerWidth()*g.length,n=g.filter(":first").outerHeight();b.parent().css({overflow:"hidden",height:n,position:"relative",padding:"4px 0",margin:0,width:l});n=b.find("li:first");var r=d.filter(":first"),v=(r.outerWidth()-r.width())/2,y=0,x=n.outerWidth();for(r=r.get(0);n.length&&n.get(0)!=r;)y+=x,n=n.next();b.css({position:"absolute",left:-(y-v),width:q});a(e.forwardLink).click(function(){h("forward");return!1});
a(e.backwardLink).click(function(){h("backward");return!1});f.bind("append prepend",function(w,A){if("append"==w.type){for(var D=b.find("li:last"),J=a();D.hasClass("dummy");)J=J.add(D),D=D.prev("li");J.remove();b.append(A)}else{D=a("<div></div>").html(A);A=D.find("li");var L=A.length*x;D.remove();D=b.find("li:first");for(J=a();D.hasClass("dummy");)J=J.add(D),D=D.next("li");J.remove();b.prepend(A)}g=b.find("li");q=g.filter(":first").outerWidth()*g.length;b.css("width",q);"prepend"==w.type&&(b.is(":animated")&&
b.stop(!1,!0),b.css("left",parseInt(b.css("left"))-L));b.find("li.selected").hasClass("visible")&&f.trigger("home",[null,!1])});f.bind("forward backward",function(w,A){h({direction:w.type,steps:A.steps,animate:"undefined"!==typeof A.animate?A.animate:!0,fn:A.fn});A=b.find("li.selected");w="forward"==w.type?A.next("li:not(.dummy)"):A.prev("li:not(.dummy)");w.length&&(A.removeClass("selected"),w.addClass("selected"))});f.bind("home",function(w,A,D){w=parseInt(d.length/2);w=d.filter(":eq("+w+")");var J=
w.nextAll(".selected:first"),L=w.prevAll(".selected:first"),C=0,H="";"function"!==typeof A&&(D=A);D="undefined"!==typeof D?D:!0;J.length?(H="forward",w.nextAll().each(function(){++C;if(a(this).hasClass("selected"))return!1})):L.length&&(H="backward",w.prevAll().each(function(){++C;if(a(this).hasClass("selected"))return!1}));H&&C?h({direction:H,steps:C,fn:A,animate:D}):"function"==typeof A&&A();return!1})})()}})(jQuery);(function(a){a.storage=new a.store;a.photos={namespace:".photos",load_from_hash:0,hash:"",raw_hash:"",options:{},shift_next:!1,anchor:"",album:null,total_count:null,photos_per_page:null,list_template:"template-photo-thumbs",photo_list_string:{},init:function(c){"undefined"!=typeof a.History&&(a.History.bind(function(){a.photos.dispatch()}),a.History.unbind=function(e,f){f?a.History.handlers.specific[e]&&a.each(a.History.handlers.specific[e],function(h,b){if(b===f)return a.History.handlers.specific[e].splice(h,
1),!1}):(f=e,a.each(a.History.handlers.generic,function(h,b){if(b===f)return a.History.handlers.generic.splice(h,1),!1}))},a.History.one=function(e,f){f||(f=e,e=null);var h=function(){f.call(this);a.History.unbind.apply(a.History,e?[e,h]:[h])};a.History.bind.apply(a.History,e?[e,h]:[h])});a.wa.errorHandler=function(e){a.storage.del("photos/hash");return 403===e.status?(a("#content").html('<div class="content left'+a.photos_sidebar.width+'px"><div class="block double-padded">'+e.responseText+"</div></div>"),
!1):a.photos.load_from_hash?(a.wa.setHash("#/"),!1):!0};this.options=c;(c=window.location.hash||a.storage.get("photos/hash"))&&c!=window.location.hash?(this.load_from_hash=2,a.wa.setHash("#/"+c)):this.dispatch();a(document).on("close",function(e){a(e.target).hide()})},dispatch:function(c){if(a.photos.ignore_dispatch)a.photos.ignore_dispatch--;else if(a.photos.hash="",void 0==c&&(c=window.location.hash),c=c.replace(/^[^#]*#\/*/,""),a.photos.raw_hash=c)if(c=c.split("/"),c[0]){for(var e="",f=c.length,
h=0;h<c.length;h++){var b=c[h];if(2>h)if(0===h)e=b;else if("tag"==e||"search"==e||"plugins"==e||"pages"==e||"app"==e){f=h;break}else if(parseInt(b,10)!=b&&-1==b.indexOf("="))e+=b.substr(0,1).toUpperCase()+b.substr(1);else{f=h;break}else{f=h;break}}f=c.slice(f);a.photos.hash="/"+c.slice(0,2).join("/");~a.photos.hash.indexOf("photo")&&(a.photos.hash="");this.beforeAnyAction(e,f);this[e+"Action"]?(this.load_from_hash&&this.load_from_hash--,this[e+"Action"].apply(this,f),a.storage.set("photos/hash",a.photos.hash)):
(a.storage.del("photos/hash"),console&&console.log("Invalid action name:",e+"Action"));c.includes("photo")||(c=a("#p-toolbar.rendered"),c.length&&c.remove())}else this.beforeAnyAction(),this.defaultAction();else this.beforeAnyAction(),this.defaultAction()},ignore_dispatch:0,forceHash:function(c){c!=window.location.hash&&(a.photos.ignore_dispatch=1,window.location.hash=c)},menu:{stack:{list:[],photo:[]},extend_stack:{list:[],photo:[]},register:function(c,e,f){this.stack[c]&&this.stack[c].push(new ToolbarMenu(e,
f))},get:function(c,e){if(this.stack[c]&&a.isArray(this.stack[c]))for(var f=0;f<this.stack[c].length;f++)if(this.stack[c][f].is(e))return this.stack[c][f];return null},init:function(c){var e;if(this.stack[c]){for(;e=this.extend_stack[c].shift();)for(var f=0;f<this.stack[c].length;f++)if(this.stack[c][f].is(e.selector)){for(var h in e.actions)this.stack[c][f].setAction(h,e.actions[h]);break}for(f=0;f<this.stack[c].length;f++)this.stack[c][f].init()}},enable:function(c,e,f){e=e||"*";if(this.stack[c])for(var h=
0;h<this.stack[c].length;h++){var b=this.stack[c][h];e&&!b.is(e)||b.enable(f)}},disable:function(c,e,f){e=e||"*";if(this.stack[c])for(var h=0;h<this.stack[c].length;h++){var b=this.stack[c][h];e&&!b.is(e)||b.disable(f)}},extend:function(c,e,f){this.stack[c]&&this.extend_stack[c].push({selector:e,actions:f});return this}},setOption:function(c,e){this.options[c]=e},getOption:function(c){return this.options[c]},beforeAnyAction:function(){},initClearance:function(){a.photos.toggleFullScreen();a.photos.highlightSidebarItem();
a.photos.hotkey_manager.unset();a.photos.unsetLazyLoad();a.photos.photo_stream_cache.clear();a.photos.photo_stack_cache.clear();delete a.photos.photo_stream_cache.hash},defaultAction:function(){window.location.hash||!a("#album-list ul li.dr").length?(a.storage.set("photos/hash","photos/"),this.photosAction()):(a.storage.set("photos/hash","albums/"),this.albumsAction())},photosAction:function(){a.photos.loadDispatch(arguments,function(){a.photos.load("?module=photo&action=list",a.photos.onLoadPhotoList)})},
albumsAction:function(){a.photos.loadDispatch(arguments,function(){a.photos.load("?action=albums")})},albumAction:function(c){a.photos.loadDispatch(arguments,function(){a.photos.load("?module=album&action=photos&id="+c,a.photos.onLoadPhotoList)})},searchAction:function(c){a.photos.loadDispatch(arguments,function(){a.photos.load("?module=search&action=photos",{q:c},a.photos.onLoadPhotoList)})},tagAction:function(c){a.photos.loadDispatch(arguments,function(){a.photos.load("?module=tag&action=photos&tag="+
c,a.photos.onLoadPhotoList)})},appAction:function(c){a.photos.loadDispatch(arguments,function(){a.photos.load("?module=photo&action=list&app_id="+c,a.photos.onLoadPhotoList)})},settingsAction:function(){a.photos.initClearance();a.photos.load("?module=settings",a.photos.onLoadSettings)},pagesAction:function(c){a("#wa-page-container").length?waLoadPage(c):(a.photos.initClearance(),a.photos.load("?module=pages",a.photos.onLoadPages,""))},designAction:function(c){a.photos.initClearance();c?a("#wa-design-container").length?
(a.photos.setTitle($_("Themes")),a.photos.scrollTop(),waDesignLoad()):a.photos.load("?module=design",function(){waDesignLoad(c);a.photos.setTitle($_("Themes"));a.photos.scrollTop()}):a.photos.load("?module=design",function(){waDesignLoad("");a.photos.setTitle($_("Design"));a.photos.scrollTop()})},designThemesAction:function(c){a.photos.initClearance();a("#wa-design-container").length?(a.photos.setTitle($_("Themes")),a.photos.scrollTop(),waDesignLoad()):a.photos.load("?module=design",function(){waDesignLoad();
a.photos.setTitle($_("Themes"));a.photos.scrollTop()},"")},pluginsAction:function(c){a.photos.initClearance();a("#js-app-sidebar li.selected").removeClass("selected");a("#js-app-sidebar #sidebar-plugins").addClass("selected");a("#wa-plugins-container").length?a.plugins.dispatch("#/plugins/"+c):a.photos.load("?module=plugins")},photoAction:function(c){a.photos.loadPhoto(c)},loadDispatch:function(c,e){for(var f=Array.prototype.slice.call(c,1),h=0;h<f.length;h++)if("photo"==f[h]&&h<f.length-1){this.loadPhoto(f[h+
1]);return}"function"==typeof e&&e(c[0]);a.photos.initClearance()},onLoadSettings:function(){a.photos.setTitle($_("Settings"));a.photos.scrollTop()},onLoadPlugins:function f(e){a.photos.setTitle($_("Plugins"));a("#plugins-settings-form").submit(function(){a("#plugins-settings-form-status").fadeIn(400);a("#plugins-settings-iframe").one("load",function(){var h=a.parseJSON(a(this).contents().find("body").html());a("#plugins-settings-form-status").fadeOut(200,function(){"ok"==h.status?a.photos.loadPluginSettings(e,
f):(a("#plugins-settings-form-status").html(h.errors?h.errors:h).css("color","red"),a("#plugins-settings-form-status").fadeIn("slow"))})})});a.photos.scrollTop()},onLoadPages:function(){a.photos.setTitle($_("Pages"));a.photos.scrollTop()},renderPhotoList:function(){var e=a("#photo-list");e.empty();a.photos.renderPhotoListChunk(e,0);a.photos.photo_stream_cache.length()&&(!a.photos.total_count||a.photos.total_count>a.photos.photo_stream_cache.length())&&a.photos.setLazyLoad()},renderPhotoListChunk:function(e,
f,h,b){var d=a.photos.options.photo_list_render_chunk||10,g=a.photos.photo_stream_cache.length();h=h||{};h.hide_name||(h.hide_name=a.storage.get("photos/list/hide_name",!1));d=a.photos.photo_stream_cache.slice(f,f+=d);d={photos:d,hash:a.photos.hash,last_login_time:a.photos.options.last_login_time,options:h,selected:!!a("#selector-menu").find("[data-action=select-photos]").data("checked"),view:(a.photos.list_template||"").replace("template-photo-","")};e.append(tmpl(a.photos.list_template,d));a("#content").trigger("photos_list_chunk_render",
[d]);if(f<g)setTimeout(function(){a.photos.renderPhotoListChunk(e,f,h,b)},100);else if("function"==typeof b&&b(),d=h.string||a.photos.photo_list_string||!1)a(".lazyloading-wrapper").html(tmpl("template-photo-counter",{count:g,total_count:a.photos.total_count,string:d})),a.photos.photo_list_string=d},selectPhotoListView:function(e){e=e.replace(/-view$/,"");a.photos.list_template="template-photo-"+e;var f=a.photos.getAlbum();f&&("thumbs"==e?a.storage.del("photos/list/view/"+f.id):a.storage.set("photos/list/view/"+
f.id,e));a.photos.menu.enable("list","."+e+"-view-menu");a.photos.menu.disable("list",":not(."+e+"-view-menu)");f=a("#photo-list");f.removeClass(f.attr("class"));switch(e){case "thumbs":f.addClass("thumbs li300px");break;case "descriptions":f.addClass("p-descriptions")}a("#js-photos-view-toggle .selected").removeClass("selected");a('#js-photos-view-toggle [data-action="'+e+'-view"]').addClass("selected");a(".js-toolbar-dropdown").toggleClass("is-descriptions","descriptions"===e)},onLoadPhotoList:function(){var e=
a.photos.getAlbum(),f=null;if(e){f=a.storage.get("photos/list/view/"+e.id);"thumbs"!=f&&"descriptions"!=f&&(f="thumbs");var h=a("#album-list li[rel="+e.id+"]");h.find(".count:first").text(e.count);h.find(".count-new:first").text("");a("#album-list-container").trigger("uncollapse_section",h);if(e.edit_rights)a("#photo-list, .js-photo-list").on("click",".make-key-photo-link",function(){a("#photo-list .key-photo").removeClass("key-photo");var b=a(this).closest("li").addClass("key-photo");e.key_photo_id=
b.data("photo-id");a.post("?module=album&action=keyPhoto",{album_id:e.id,photo_id:e.key_photo_id})})}f||(f="thumbs");a("#template-photo-"+f).length?(a.photos.list_template="template-photo-"+f,a.photos.renderPhotoList(),a.photos.setTitle(a("#photo-list-name").text()),a.photos.menu.init("list"),a.photos.selectPhotoListView(f),a("#js-photos-view-toggle").waToggle({change:function(b,d,g){b=a(d).attr("data-action");b!==f&&(f=b.replace(/-view$/,""),a.photos.list_template="template-photo-"+f,a.photos.renderPhotoList(),
a.photos.selectPhotoListView(f))}}),a("#photo-list .js-description div, .js-description-editable").on("click",function(){a(this);a(this).height();var b=$_("add description");a(this).inlineEditable({inputType:"textarea",makeReadableBy:["esc"],updateBy:["ctrl+enter"],placeholder:b,placeholderClass:"gray",minSize:{height:40},html:!1,allowEmpty:!0,beforeMakeEditable:function(d){var g=a(this),l=g.parent().find(".full-description:first").html(),q=g.css("font-size"),n=g.css("line-height");d.css({"font-size":q,
"line-height":n,"max-width":"100%"});g.html(l);l=Math.max(g.parents("li:first").find("img").width(),g.width());d.width(l);l=this.id+"-button";q=a("#"+l);q.length||(d.after('<input class="button smallest" type="button" id="'+l+'" value="'+$_("Save")+'"> <em class="hint" id="'+this.id+'-hint">Ctrl+Enter</em>'),a("#"+l).on("click",function(){g.trigger("readable")}));a("#"+this.id+"-hint").show();q.show()},afterBackReadable:function(d,g){var l=a("#"+(this.id+"-button")),q=a(this);d=a(d).val();var n=q.parents("li:first").find(".p-image").attr("data-href");
n=/(\d+)[\/]*$/.exec(n);var r=null;l.hide();a("#"+this.id+"-hint").hide();d?(q.text(d.truncate(255)),q.parent().find(".js-full-description:first").text(d).html()):q.parent().find(".js-full-description:first").html("");n&&g.changed&&(r=n[1],a.photos.saveField({id:r,type:"photo",name:"description",value:d,fn:function(){}}))},hold:function(){return!this.hasClass("editable")}}).trigger("editable")}),h=a("#photo-list-name"),h.hasClass("editable")&&h.inlineEditable({minSize:{width:350},maxSize:{width:600},
size:{height:30},afterBackReadable:function(b,d){if(!d.changed)return!1;b=a(b).val();(d=a.photos.getAlbum())&&a.photos.saveField({id:d.id,type:"album",name:"name",value:b,fn:function(g){"ok"==g.status&&(g=g.data.album,a("#album-list li[rel="+g.id+"] > a > .album-name").html(g.name),a("#p-upload-step2 select[name=album_id] option[value="+g.id+"]").html(g.name),a.photos.setTitle(g.not_escaped_name))}})},hold:function(){return!this.hasClass("editable")}}),h=a("#photo-album-note"),h.hasClass("editable")&&
h.inlineEditable({placeholder:"("+$_("subtitle")+")",placeholderClass:"gray",minSize:{width:150},maxSize:{width:250},size:{height:22},afterBackReadable:function(b,d){if(!d.changed)return!1;b=a(b).val();(d=a.photos.getAlbum())&&a.photos.saveField({id:d.id,type:"album",name:"note",value:b})},hold:function(){return!this.hasClass("editable")}}),a(".js-toolbar-dropdown-button").on("recount",function(){var b=a("#photo-list li.selected").length,d=a(this).find(".js-count");0<b?d.text(b).show():d.hide()}),
a("#p-album-settings").click(function(){var b=a.photos.getAlbum(),d=b?b.id:0;b=a("#album-settings-dialog-acceptor");b.length||(b=a("<div id='album-settings-dialog-acceptor'></div>"),a("body").append(b));b.load("?module=dialog&action=albumSettings&id="+d,function(){a.waDialog({html:a("#album-settings-dialog"),onOpen:function(g,l){var q=g.find("form");q.find(".js-privacy-settings-link").on("click",function(){a(window).resize()});q.on("submit",function(n){n.preventDefault();g.trigger("change_loading_status",
!0);a.post(q.attr("action"),q.serializeArray(),function(r){if("ok"==r.status){var v=function(D){a.post("?module=album&action=savePhotosAccess",D,function(){D.offset+=A;D.offset<=y?v(D):(g.trigger("change_loading_status",!1),location.reload())})},y=r.data.total_count,x=r.data.status,w=r.data.groups,A=r.data.count;r=A;A<y?v({id:d,status:x,groups:w,count:A,offset:r}):(g.trigger("change_loading_status",!1),location.reload())}else if("fail"==r.status)for(x in g.trigger("change_loading_status",!1),r=r.errors,
r)r.hasOwnProperty(x)&&g.find("input[name="+x+"]").addClass("error").parent().find(".errormsg").text(r[x])},"json")})}})});return!1}),a("#photo-list").find(".p-description textarea, .p-photo-details textarea, .p-photo-details input").on("select",function(){return!1}),a.photos.hotkey_manager.set("rate"),a.photos.hash!=a.photos.photo_stream_cache.hash&&a.photos.scrollTop(),a("#content").trigger("photos_list_load")):(a("#content").empty(),a.wa.setHash("#/"))},loadPhoto:function(e){if(a.photos.photo_stream_cache.hash!=
a.photos.hash)a.photos.loadNewPhoto(e);else{var f=a.photos.photo_stream_cache.getById(e);f?(a.photos.setTitle(f.name_not_escaped),a.photos.loadPhotoCompletly(f)):(f=a.photos.photo_stack_cache.getById(e))?(a.photos.setTitle(f.name_not_escaped),a.photos.loadPhotoInStack(f)):a.photos.loadNewPhoto(e)}},loadPhotoInStack:function h(f){a.photos.abortPrevLoading();a.photos.hooks_manager.trigger("beforeLoadPhoto",f);a.photos.photo_stack_cache.setCurrent(f);var b=a.photos._chooseProperThumb(f);if("object"===
typeof b.size&&b.size){var d=document.querySelector(".p-one-photo").clientHeight;f.height>=d?a("#photo").height(d).attr("srcset",""+b.url+(f.edit_datetime?"?"+Date.parseISO(f.edit_datetime):"")+" 1x, "+b.url2x+(f.edit_datetime?"?"+Date.parseISO(f.edit_datetime):"")+" 2x"):a("#photo").attr("srcset",b.url+" 1x, "+b.url2x+" 2x")}replaceImg(a("#photo"),f.thumb.url+(f.edit_datetime?"?"+Date.parseISO(f.edit_datetime):""),null);a.photos.setNextPhotoLink();b=a.post("?module=photo&action=load",{id:f.id,in_stack:1},
function(g){g=g.data;var l=g.photo;l=a.photos.photo_stack_cache.updateById(l.id,l);g.photo=l;a.photos.updateViewChildPhoto(g);a.photos.hooks_manager.trigger("afterLoadPhoto",l);delete h.xhr},"json");h.xhr=b;a("#photo-name").html(f.name)},updateViewChildPhoto:function(f){var h=f.author,b=f.albums,d=f.exif,g=f.photo;a.photos.renderPhotoImg(g);a("#photo-author").html(tmpl("template-photo-author",{photo:g,author:h}));a.photos.updatePhotoOriginalBlock(g);a("#photo-exif").html(tmpl("template-photo-exif",
{exif:d}));a.photos.renderMap(d.GPSLatitude,d.GPSLongitude,g.name);a("#photo-albums").html(tmpl("template-photo-albums",{albums:b}));a.photos.initPhotoContentControlWidget({frontend_link_template:f.frontend_link_template,photo:g})},loadNewPhoto:function b(h){a.photos.initClearance();a.photos.widget.loupe.init();b.xhr_map=b.xhr_map||{};b.xhr_map[h]&&b.xhr_map[h].abort();b.xhr_map[h]=a.post("?module=photo&action=load",{id:h,hash:a.photos.hash},function(d){b.xhr_map[h]=null;d=d.data;var g=d.photo;a.photos.renderViewPhoto(d);
var l=a.photos.photo_stream_cache.getNext();l&&a.photos.preloadPhoto(l);d.album&&a.photos.setAlbum(d.album);a.photos.hooks_manager.trigger("afterLoadPhoto",g)},"json")},renderViewPhoto:function(h){var b=h.photo,d=h.author,g=h.exif,l=h.stack,q=h.albums,n=h.album,r=h.hooks,v=h.frontend_link_template,y=h.photo_stream;h=y.in_collection;a.photos.photo_stream_cache.set(y.photos);var x=!1;if(n&&!h){if(n.type==Album.TYPE_STATIC){a.photos.goToHash("album/"+n.id+"/");return}x=!0}a.photos.setTitle(b.name_not_escaped);
a("#content").html(tmpl("template-p-block"));a.photos.initPhotoToolbar({photo:b,author:d,exif:g,stack:l,hash:a.photos.hash});a.photos.renderPhotoBlock({photo:b,hash:a.photos.hash,albums:q,hooks:r,frontend_link_template:v});setTimeout(function(){a.photos.initPhotoWidgets({photo:b,stack:l,exif:g,photo_stream:y,hash:a.photos.hash})},0);a.photos.anchor?(a.photos.goToAnchor(a.photos.anchor),a.photos.anchor=""):a.photos.scrollTop();a("#p-warning-not-in-album").hide();x?(a("#p-warning-not-in-album").show(),
a.photos.setNextPhotoLink(a.photos.photo_stream_cache.getCurrent())):a.photos.setNextPhotoLink()},loadPhotoCompletly:function(h){a.photos.photo_stream_cache.setCurrent(h);a.photos.updatePhotoStreamWidget({shift:h.id,fn:function(){a.photos._loadPhotoCompletly(h)}})},_loadPhotoCompletly:function d(b){a.photos.abortPrevLoading();a.photos.hooks_manager.trigger("beforeLoadPhoto",b);a("#p-warning-not-in-album").hide();a.photos.setNextPhotoLink();a.photos.updatePhotoName(b.name);a.photos.updatePhotoDescription(b.description);
a.photos.updatePhotoRate(b.rate);a("#photo-frontend-url").html(b.url);a("#stack-stream").hide();a("#photo-hook-bottom").html("");var g=a.photos.isPhotoPreloaded(b);if(g)a.photos.renderPhotoImg(b);else{var l=a.photos._chooseProperThumb(b),q=a("#photo");q.css({opacity:0,display:"none"});var n=document.querySelector(".p-one-photo").clientHeight;b.height>=n&&q.height(n);replaceImg(q,l.url+(b.edit_datetime?"?"+Date.parseISO(b.edit_datetime):""),function(){"object"===typeof l.size&&l.size&&q.attr("srcset",
""+l.url+(b.edit_datetime?"?"+Date.parseISO(b.edit_datetime):"")+" 1x, "+l.url2x+(b.edit_datetime?"?"+Date.parseISO(b.edit_datetime):"")+" 2x");q.css({opacity:1,display:"block"})})}a.photos.updatePhotoTags(b.tags);(n=a.photos.photo_stream_cache.getNext())&&a.photos.preloadPhoto(n);n=a.post("?module=photo&action=load",{id:b.id},function(r){if("ok"==r.status){r=r.data;var v=r.album,y=r.photo,x=r.photo_stream.in_collection,w=!1;if(v&&!x){if(v.type==Album.TYPE_STATIC){a.photos.goToHash("album/"+v.id+
"/");return}w=!0}w?(a("#p-warning-not-in-album").show(),a.photos.setNextPhotoLink(a.photos.photo_stream_cache.getCurrent())):a.photos.setNextPhotoLink();y=a.photos.photo_stream_cache.updateById(y.id,y);r.photo=y;a.photos.updateViewPhoto(r,g);a.photos.hooks_manager.trigger("afterLoadPhoto",y);delete d.xhr}},"json");d.xhr=n},updateViewPhoto:function(b,d){var g=b.author,l=b.albums,q=b.exif,n=b.frontend_link_template,r=b.hooks,v=b.stack;b=b.photo;d||a.photos.renderPhotoImg(b);a.photos.updateViewPhotoMenu(0!=
b.parent_id||0<b.stack_count,b.edit_rights);a.photos.updatePhotoName(b.name,b.edit_rights);a.photos.updatePhotoDescription(b.description,b.edit_rights);a.photos.updatePhotoRate(b.rate,b.edit_rights);a.photos.updatePhotoTags(b.tags);a("#photo-author").html(tmpl("template-photo-author",{photo:b,author:g}));a.photos.updatePhotoOriginalBlock(b);a("#photo-exif").html(tmpl("template-photo-exif",{exif:q}));a.photos.renderMap(q.GPSLatitude,q.GPSLongitude,b.name);a("#photo-albums").html(tmpl("template-photo-albums",
{albums:l}));a.photos.initPhotoContentControlWidget({frontend_link_template:n,photo:b});v?(a("#stack-stream").html(tmpl("template-photo-stack",{stack:v,photo_id:b.id,hash:a.photos.hash})).show(),a.photos.photo_stack_cache.set(v),a.photos.initPhotoStackWidget()):a.photos.photo_stack_cache.clear();d="";for(var y in r.backend_photo)r.backend_photo[y].bottom&&(d+=r.backend_photo[y].bottom);a("#photo-hook-bottom").html(d);d="";for(y in r.backend_photo)r.backend_photo[y].after_rate&&(d+=r.backend_photo[y].after_rate);
d&&(a("#photo-rate").nextAll().remove(),a("#photo-rate").after(d));a.photos.anchor&&(a.photos.goToAnchor(a.photos.anchor),a.photos.anchor="")},renderPhotoImg:function(b){var d=a.photos._chooseProperThumb(b),g=a("#photo");g.css({opacity:0,display:"none"});var l=document.querySelector(".p-one-photo").clientHeight;b.height>=l&&g.height(l);replaceImg(g,d.url+(b.edit_datetime?"?"+Date.parseISO(b.edit_datetime):""),function(){"object"===typeof d.size&&d.size&&a(this).attr("srcset",""+d.url+(b.edit_datetime?
"?"+Date.parseISO(b.edit_datetime):"")+" 1x, "+d.url2x+(b.edit_datetime?"?"+Date.parseISO(b.edit_datetime):"")+" 2x");a.photos.hooks_manager.trigger("afterRenderImg",this,b,d);g.css({opacity:1,display:"block"})})},updateViewPhotoMenu:function(b,d){b?a.photos.menu.enable("photo","#photo-organize-menu","unstack"):a.photos.menu.disable("photo","#photo-organize-menu","unstack");d?(a.photos.menu.enable("photo","#photo-organize-menu"),a.photos.menu.enable("photo","#edit-menu"),a("#photo-tags").parent().show()):
(a.photos.menu.disable("photo","#photo-organize-menu"),a.photos.menu.disable("photo","#edit-menu"),a("#photo-tags").parent().hide())},preloadPhoto:function(b){var d=a("#preload-photo");d.attr("data-photo-id","");replaceImg(d,b.thumb_big.url,function(){d.attr("data-photo-id",b.id)})},isPhotoPreloaded:function(b){return a("#preload-photo").attr("data-photo-id")==b.id},abortPrevLoading:function(){"object"===typeof a.photos._loadPhotoCompletly.xhr&&"function"===typeof a.photos._loadPhotoCompletly.xhr.abort&&
(a.photos._loadPhotoCompletly.xhr.abort(),a.photos.hooks_manager.trigger("onAbortPrevLoading"));"object"===typeof a.photos.loadPhotoInStack.xhr&&"function"===typeof a.photos.loadPhotoInStack.xhr.abort&&(a.photos.loadPhotoInStack.xhr.abort(),a.photos.hooks_manager.trigger("onAbortPrevLoading"))},updateThumbRate:function(b,d){b=b.find(".p-details .p-rate");(d=Math.round(2*d)/2)?(b.find("svg").removeClass("fa-star-half-alt").attr("data-prefix","far").each(function(g){g+=1;g>d?.5==g-d&&a(this).addClass("fa-star-half-alt").attr("data-prefix",
"fas"):a(this).removeClass("fa-star-half-alt").attr("data-prefix","fas");a(this).attr("data-rate-value",g)}),b.show()):b.hide()},showManageAccessDialog:function(b,d){var g=a("#manage-access-dialog-acceptor"),l="?module=dialog&action=manageAccess";g.length||(g=a("<div id='manage-access-dialog-acceptor'></div>"),a("body").append(g));if(b)if(a.isArray(b))for(var q=0,n=b.length;q<n;++q){var r=b[q];l+="&"+r.name+"="+r.value}else l+="&"+b;g.load(l,function(){a.waDialog({$wrapper:a("#manage-access-dialog"),
onOpen:function(v,y){var x=v.find("form");x.find(".js-privacy-settings-link").on("click",function(){a(window).resize()});x.on("submit",function(w){w.preventDefault();d(v,y)})}})})},initPhotoNameWidget:function(b){b="undefined"===typeof b?!1:b;a("#photo-name").inlineEditable({placeholder:a("#photo-name").text()?null:$_("Edit title..."),placeholderClass:"gray",afterBackReadable:function(d,g){g.changed&&(d=a(d).val(),d.length&&a.photos.saveField({id:a.photos.getPhotoId(),type:"photo",name:"name",value:d,
fn:function(l){a("#photo-name").inlineEditable("setOption",{placeholder:null});"ok"==l.status&&a.photos.setTitle(l.data.value)}}))},minSize:{width:350},maxSize:{width:600},size:{height:30},hold:function(){return!this.hasClass("editable")}});a.photos.updatePhotoName(b)},initPhotoDescriptionWidget:function(b){b="undefined"===typeof b?!1:b;a("#photo-description").inlineEditable({placeholder:$_("add description"),placeholderClass:"gray",makeReadableBy:["esc"],updateBy:["ctrl+enter"],html:!0,allowEmpty:!0,
beforeMakeEditable:function(d){var g=a("#photo-description-save");if(!g.length){var l=a(this);d.after('<input type="button" id="photo-description-save" class="button smallest" value="'+$_("Save")+'"> <em class="hint" id="'+this.id+'-hint">Ctrl+Enter</em>');g=a("#photo-description-save");g.click(function(){l.trigger("readable")})}a("#"+this.id+"-hint").show();g.show().prev("br").show()},afterBackReadable:function(d,g){a("#photo-description-save").hide().prev("br").hide();a("#"+this.id+"-hint").hide();
if(!g.changed)return!1;a(d).val();a.photos.saveField({id:a.photos.photo_stream_cache.getCurrent().id,type:"photo",name:"description",value:a(d).val(),fn:function(){}})},minSize:{height:50,width:600},size:{width:a("#photo").width()},inputType:"textarea",editLink:"#photo-description-edit-link",hold:function(){return!this.hasClass("editable")}});a.photos.updatePhotoDescription(b)},initPhotoRateWidget:function(b){b="undefined"===typeof b?!1:b;a("#photo-rate").rateWidget({onUpdate:function(d){a.photos.saveField(a.photos.photo_stream_cache.getCurrent().id,
"rate",d,function(g){"ok"==g.status&&g.data.count&&a("#rated-count").text(0<g.data.count?g.data.count:"")})},hold:function(){return this.hasClass("hold")}});a.photos.updatePhotoRate(b)},initPhotoStackWidget:function(b){"object"===typeof b&&b&&a("#stack-stream").html(tmpl("template-photo-stack",b)).show();b=a("#stack-stream li.dr:first a").attr("href");(b=/(\d+)[\/]*$/.exec(b))&&(parent_id=b[1]);a("#stack-stream").data("parent_id",parent_id);a("#stack-stream").sortable({distance:5,helper:"clone",items:"li.dr",
opacity:.75,tolerance:"pointer",start:function(){document.ondragstart=function(){return!1}},stop:function(d,g){document.ondragstart=null;g=a(g.item);d=parseInt(g.attr("data-photo-id"));g=g.next();var l=null;g.length&&(l=parseInt(g.attr("data-photo-id")));a.post("?module=stack&action=photoMove",{id:d,before_id:l},function(q){if("ok"==q.status&&q.data.stack){var n=q.data.stack;q=a("#stack-stream").data("parent_id");n=n[0];var r=n.id;q!=r&&(q=a.photos.photo_stream_cache.getById(q),n.tags=q.tags,a.photos.photo_stream_cache.replace(q,
n),a("#stack-stream").data("parent_id",r),a.photos.updatePhotoStreamWidget({current_photo:n}))}},"json")}});if(a("#stack-stream").data("inited"))return!1;a("#stack-stream li.dr").on("click",function(){a("#stack-stream li.dr.selected").removeClass("selected");a(this).addClass("selected")});a("#stack-stream").data("inited",!0)},initPhotoTagsWidget:function(b){var d=a("#photo-tags"),g=$_("add a tag");"undefined"!==typeof b&&("object"===typeof b&&b&&(b=a.photos.joinObject(b,",")),d.importTags(b));d.data("current_value",
d.val());var l=function(){d.data("current_value")!==d.val()&&(d.data("current_value",d.val()),a("#photo-save-tags-status").html('<i style="vertical-align: middle" class="icon16 yes"></i>'+$_("Saving")).fadeIn("slow"),a.photos.assignTags({photo_id:a.photos.getPhotoId(),tags:a("#photo-tags").val(),fn:function(){a("#photo-save-tags-status").html('<i style="vertical-align: middle" class="icon16 yes"></i>'+$_("Saved")).fadeOut("slow")},onDeniedExist:function(){alert($_("You don't have sufficient access rights"))}}))};
try{d.tagsInput({autocomplete_url:"?module=tag&action=list",height:120,width:150,defaultText:g,onChange:function(){},onAddTag:function(){l()},onRemoveTag:function(){l()}})}catch(q){}},initPhotoContentControlWidget:function(b){"object"===typeof b&&b?(a("#photo-content-control").html(tmpl("template-photo-content-control",b)),edit_rights=b.photo.edit_rights):edit_rights=b;edit_rights="undefined"===typeof edit_rights?!1:edit_rights;var d=a("#photo-frontend-url"),g=d.parents("li:first").find("i.new-window"),
l=a("#photo-frontend-link").nextAll("span.slash:first");d.length&&d.inlineEditable({inputType:"input",editLink:"#photo-frontend-url-edit-link",editOnItself:!1,minSize:{width:100},beforeMakeEditable:function(q){var n=a(this),r=n.text().replace(/\/$/,"");n.text(r);l.show();g.hide();q.removeClass("error");a("#photo-content-control").find(".errormsg").text("").hide()},beforeBackReadable:function(q,n){function r(){v.text(y);l.hide();g.show();a(q).removeClass("error");a("#photo-content-control").find(".errormsg").text("").hide()}
var v=a(this),y=v.text()+"/",x=a.photos.getPhotoId(),w=a(q).val();if(n.changed)return a.photos.saveField(x,"url",w,function(A){"ok"==A.status?(A=a("#photo-frontend-link").text(),a("#photo-frontend-link").attr("href",A),r(),d.trigger("readable",!0)):"fail"==A.status&&(a(q).addClass("error"),a("#photo-content-control").find(".errormsg").text(A.errors.url).show())}),!1;r()},hold:function(){return this.hasClass("hold")}});a.photos.updatePhotoFrontendUrl(edit_rights)},renderMap:function(b,d,g){var l=this.options.map_options||
{},q=function(){};b&&d?(q="google"===l.type?function(){window.initPhotosGoogleMap=function(){if(window.google){a("#photo-map").show();var r=new google.maps.LatLng(b,d),v={zoom:11,center:r,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0,zoomControlOptions:{position:google.maps.ControlPosition.TOP_LEFT,style:google.maps.ZoomControlStyle.SMALL}};v=new google.maps.Map(a("#photo-map").get(0),v);new google.maps.Marker({position:r,map:v,title:g})}else a("#photo-map").hide()};if(window.google)initPhotosGoogleMap();
else{var n="https://maps.googleapis.com/maps/api/js?sensor=false&key=:KEY&lang=:LOCALE&callback=initPhotosGoogleMap".replace(":KEY",l.key||"").replace(":LOCALE",l.locale||"");a.getScript(n)}}:"yandex"===l.type?function(){var n=function(){window.ymaps?ymaps.ready(function(){a("#photo-map").show();var v=[b,d],y=new ymaps.Map("photo-map",{center:v,zoom:11,controls:["zoomControl","fullscreenControl"]});y.setCenter(v);y.geoObjects.add(new ymaps.Placemark(v,{balloonContent:""}))}):a("#photo-map").hide()};
if(window.ymaps)n();else{var r="https://api-maps.yandex.ru/2.1/?lang="+(l.locale||"ru_RU");l.key&&(r+="&apikey="+l.key);a.getScript(r,n)}}:function(){a("#photo-map").hide()},q()):a("#photo-map").hide()},joinObject:function(b,d){var g="",l=0;d=d||"";for(var q in b)b.hasOwnProperty(q)&&(0<l++&&(g+=d),g+=b[q]);return g},initPhotoStreamWidget:function(b){var d=b.photos;d=[null].concat(d,[null]);a("#photo-stream").html(tmpl("template-photo-stream",{photos:d,current_photo:b.current_photo||null,hash:a.photos.hash}));
var g=!1,l=!1;a("#photo-stream ul.photostream:first").photoStreamSlider({backwardLink:"#photo-stream .rewind",forwardLink:"#photo-stream .ff",photoStream:"ul",duration:400,onForward:function n(){if(!g){var r=this,v=r.find("ul").find("li:not(.dummy)"),y=v.filter(".visible");v=v.filter(":last");15>y.filter(":last").nextAll().length&&"object"!=typeof n.xhr&&(y=v.attr("data-photo-id"),n.xhr=a.post("?module=photo&action=loadList",{id:y,direction:1,hash:a.photos.hash},function(x){if("ok"==x.status){x=x.data.photos;
if(0<x.length)a.photos.photo_stream_cache.append(x);else{g=!0;return}x.push(null);r.trigger("append",tmpl("template-photo-stream-list",{photos:x}))}delete n.xhr},"json"))}},onBackward:function r(){if(!l){var v=this,y=v.find("ul").find("li:not(.dummy)"),x=y.filter(".visible");y=y.filter(":first");15>x.filter(":first").prevAll().length&&"object"!=typeof r.xhr&&(x=y.attr("data-photo-id"),r.xhr=a.post("?module=photo&action=loadList",{id:x,direction:-1,hash:a.photos.hash},function(w){if("ok"==w.status){w=
w.data.photos;if(0<w.length)a.photos.photo_stream_cache.prepend(w);else{l=!0;return}w.unshift(null);v.trigger("prepend",tmpl("template-photo-stream-list",{photos:w}))}delete r.xhr},"json"))}}})},updatePhotoStreamWidget:function(b){var d=a("#photo-stream ul.photostream:first");if(b.current_photo){var g=d.find("li.selected"),l=b.current_photo;g.attr("data-photo-id",l.id);g.find("a").attr("href","#/photo/"+l.id);g.find("img").attr("src",l.thumb_crop.url)}b.shift&&(d.find("li.selected").removeClass("selected"),
d.find("li[data-photo-id="+b.shift+"]").addClass("selected"),d.trigger("home",[b.fn||function(){},!a.photos.shift_next]),a.photos.shift_next=!1)},updatePhotoName:function(b,d){if("boolean"===typeof b||"undefined"===typeof b)d=b,b=null;var g=a("#photo-name");null!==b&&g.html(b);d?g.addClass("editable"):g.removeClass("editable")},updatePhotoDescription:function(b,d){if("boolean"===typeof b||"undefined"===typeof b)d=b,b=a("#photo-description").html();var g=a("#photo-description"),l=$_("add description");
d?(g.addClass("editable"),d=l,a("#photo-description-edit-link").show()):(d=null,b=b!==l?b:"",g.removeClass("editable"),a("#photo-description-edit-link").hide());g.inlineEditable("setOption",{placeholder:d}).html(b).trigger("placeholder",!!d)},updatePhotoRate:function(b,d){if("boolean"===typeof b||"undefined"===typeof b)d=b,b=null;var g=a("#photo-rate");null!==b&&g.rateWidget("setOption","rate",b);d?g.removeClass("hold").show():(g.addClass("hold"),(b=g.rateWidget("getOption","rate"))||g.hide())},updatePhotoTags:function(b){var d=
a("#photo-tags");d.data("current_value",d.val());"undefined"!==typeof b&&("object"===typeof b&&b&&(b=a.photos.joinObject(b,",")),d.importTags(b))},updatePhotoFrontendUrl:function(b){var d=a("#photo-frontend-url");b?(d.removeClass("hold"),a("#photo-frontend-url-edit-link").show()):(d.addClass("hold"),a("#photo-frontend-url-edit-link").hide())},updatePhotoOriginalBlock:function(b){a("#photo-original").html(tmpl("template-photo-original",{photo:b}))},initPhotoToolbar:function(b){setTimeout(function(){var d=
a("#p-toolbar");d.length&&(d.html(tmpl("template-photo-toolbar",b)).addClass("rendered"),a(document).on("keyup",function(g){a("#wa-header").find("#p-toolbar").length&&27===(g.which||g.keyCode||0)&&document.querySelector(".js-toolbar-close").click()}));a.photos.menu.init("photo");d=a("#photos-photo-popular-tags");d.data("inited")||d.off("click.photos","a").on("click.photos","a",function(){var g=a(this).text(),l=a("#photo-tags");l.removeTag(g);l.addTag(g)}).data("inited",!0);a.photos.updateViewPhotoMenu(a.isArray(b.stack)&&
b.stack.length,b.photo.edit_rights);a(".js-p-toolbar-dropdown").waDropdown({hover:!0,update_title:!1,items:".menu > li > a"})},0)},renderPhotoBlock:function(b){var d=b.photo,g=a.photos._chooseProperThumb(d),l=d.thumb.size;"object"===typeof g.size&&g.size&&(d.thumb.size={width:g.size.width,height:g.size.height});a("#p-block").html(tmpl("template-photo",b)).addClass("rendered");a("#p-info-area").html(tmpl("template-info-area",b)).addClass("rendered");a("#p-toolbar").prependTo(a("#wa-header-content-area"));
var q=a("#photo");q.css({opacity:0,display:"none"});setTimeout(function(){function n(y){y=y.getBoundingClientRect();return Math.floor(y.top+pageYOffset)}var r=document.querySelector(".p-one-photo"),v=window.innerHeight-n(r)-16;r.style.height=v+"px";d.height>=v&&q.height(v);window.addEventListener("resize",function(){v=window.innerHeight-n(r)-16;r.style.height=v+"px";d.height>=v&&q.height(v)})},0);"object"===typeof l&&l&&(d.thumb.size={width:l.width,height:l.height});replaceImg(q,g.url+(d.edit_datetime?
"?"+Date.parseISO(d.edit_datetime):""),function(){a(this).attr("srcset",""+g.url+(d.edit_datetime?"?"+Date.parseISO(d.edit_datetime):"")+" 1x, "+g.url2x+(d.edit_datetime?"?"+Date.parseISO(d.edit_datetime):"")+" 2x");a.photos.hooks_manager.trigger("afterRenderImg",this,d,g);q.css({opacity:1,display:"block"})})},initPhotoWidgets:function(b){var d=b.photo,g=b.exif,l=b.stack;b=b.photo_stream;var q=a.photos.hash;a.photos.initPhotoNameWidget(d.edit_rights);a.photos.initPhotoDescriptionWidget(d.edit_rights);
a.photos.initPhotoRateWidget(d.edit_rights);a.photos.initPhotoTagsWidget(d.tags);a.photos.initPhotoContentControlWidget(d.edit_rights);a.photos.hotkey_manager.set();a.photos.renderMap(g.GPSLatitude,g.GPSLongitude,d.name);a.isArray(l)&&l.length&&(a.photos.photo_stack_cache.set(l).setCurrentById(d.id),a.photos.initPhotoStackWidget({stack:l,photo_id:d.id,hash:a.photos.hash}));d=a.photos.photo_stream_cache;d.hash=q;d.set(b.photos).setCurrentById(b.current_photo_id);a.photos.initPhotoStreamWidget({photos:b.photos,
current_photo:d.getCurrent()});a("#p-block .p-one-photo > .p-image-nav").on("click",function(){if(this.classList.contains("p-rewind")){var n=a.photos.photo_stream_cache.getPrev();n&&(a.photos.goToHash(a.photos.getHashByPhotoId(n.id),!1),a.photos.shift_next=!0)}else if(n=a.photos.photo_stream_cache.getNext())a.photos.goToHash(a.photos.getHashByPhotoId(n.id),!1),a.photos.shift_next=!0})},_chooseProperThumb:function(b){var d=b.thumb_big;b=b.thumb_middle;var g=a("#p-block").width();var l=d;"object"===
typeof d.size&&d.size?(parseInt(d.size.height,10)>parseInt(b.bound.height,10)&&parseInt(d.size.height,10)>a(window).height()&&(l=b),parseInt(l.size.width,10)>g&&(l.size.height=Math.round(g/parseInt(l.size.width,10)*parseInt(l.size.height,10)),l.size.width=g)):l.size={width:g,height:""};"object"===typeof l.size&&l.size||(l.size={widht:g,height:""});return l},setNextPhotoLink:function(b){var d=a("#photo").parents("a:first");(b=b?b:a.photos.photo_stream_cache.getNext())?(d.attr("title",$_("Next \u2192")),
d.attr("href","#"+a.photos.hash+"/photo/"+b.id+"/")):(d.attr("title",""),d.attr("href","javascript:void(0);"))},setTitle:function(b){b&&(document.title=b+a.photos.options.title_suffix)},ignore_scrolltop:!1,scrollTop:function(){a.photos.ignore_scrolltop?a.photos.ignore_scrolltop=!1:a(document).scrollTop(0)},load:function(b,d,g,l){var q=a("#content");"function"==typeof d&&(l=g||null);l&&(q.empty().append(l),q=q.find(":last-child"));"function"==typeof d?q.load(b,d):q.load(b,d,g)},setCover:function(b){(void 0===
b?0:b)?a("#full-cover").show():a("#cover").show()},unsetCover:function(b){(void 0===b?0:b)?a("#full-cover").hide():a("#cover").hide()},saveField:function(b,d,g,l){var q="photo";1==arguments.length&&(q=a.extend({type:q,fn:function(){}},b),b=q.id,d=q.name,g=q.value,l=q.fn,q=q.type);if(!~["photo","album"].indexOf(q))throw"Unknown type";a.isArray(b)||(b=[{name:"id[]",value:parseInt(b)}]);var n=[].concat(b,{name:"name",value:d},{name:"value",value:g});a.post("?module="+q+"&action=saveField",n,function(r){if("ok"==
r.status){var v={};v[d]=g;r.data.parent_id&&(b=r.data.parent_id);a.photos._updateStreamCache(b,v);"function"==typeof l&&l(r)}else"fail"==r.status&&"function"==typeof l&&l(r)},"json")},saveFields:function(b,d,g){a.post("?module=photo&action=saveFields",{data:b},function(l){if("ok"==l.status)for(var q in l.data.update){var n=l.data.update[q].id;a.isArray(n)||(n=[n]);var r=l.data.update[q].data;q=0;for(var v=n.length;q<v;++q)a.photos.photo_stream_cache.updateById(n[q],r)}},"json")},_updateStreamCache:function(b,
d){a.isArray(b)||(b=[{value:b}]);for(var g=0,l=b.length;g<l;++g)a.photos.photo_stream_cache.updateById(b[g].value,d)},restoreOriginal:function(b){if("restore-original"===b.id&&confirm($_("This will reset all changes you applied to the image after upload, and will restore the image to its original. Are you sure?"))){a.photos.setCover(!0);var d=a.waLoading(),g=a("body");d.show();d.animate(1E4,95,!1);g.addClass("is-locked");a.post("?module=photo&action=restore",{id:a.photos.getPhotoId()},function(l){"ok"==
l.status&&(l=l.data.photo,l=0==l.parent_id?a.photos.photo_stream_cache.updateById(id,l):a.photos.photo_stack_cache.updateById(id,l),a.photos.updatePhotoOriginalBlock(l),a.photos.updatePhotoImgs(l,function(){a.photos.unsetCover(!0)}),d.done(),g.removeClass("is-locked"))},"json").error(function(l){a.photos.showServerError(l.responseText);d.abort();g.removeClass("is-locked")})}},rotate:function(b,d,g){g=g||function(){};var l=a.waLoading(),q=a("body");l.show();l.animate(1E4,95,!1);q.addClass("is-locked");
a.post("?module=photo&action=rotate",{id:b,direction:d},function(n){"ok"==n.status&&(n=n.data.photo,n=0==n.parent_id?a.photos.photo_stream_cache.updateById(b,n):a.photos.photo_stack_cache.updateById(b,n),a.photos.updatePhotoOriginalBlock(n),a.photos.updatePhotoImgs(n,g),l.done(),q.removeClass("is-locked"))},"json").error(function(n){a.photos.showServerError(n.responseText);"function"==typeof g&&g();l.abort();q.removeClass("is-locked")})},updatePhotoImgs:function(b,d){var g=a.photos._chooseProperThumb(b),
l=b.edit_datetime?"?"+Date.parseISO(b.edit_datetime):"",q=a("#photo");replaceImg(q,g.url+l,function(){var n=document.querySelector(".p-one-photo").clientHeight;b.height>=n?a(this).height(n).attr("srcset",""+g.url+l+" 1x, "+g.url2x+l+" 2x"):a(this).attr("srcset",""+g.url+l+" 1x, "+g.url2x+l+" 2x");a("#photo-stream .selected img, #stack-stream .selected img").each(function(){var r=a(this);r.hasClass("thumb")?r.attr("src",b.thumb.url+l):void 0!==b.thumb_crop&&r.attr("src",b.thumb_crop.url+l)});"function"==
typeof d&&d();a.photos.hooks_manager.trigger("afterRenderImg",this,b,g)})},deletePhotos:function(b,d){a.post("?module=photo&action=resolution",a.isArray(b)?b:{photo_id:b},function(g){if("ok"==g.status){var l=g.data.photo_id;g=[];for(var q=[],n=0,r=l.length;n<r;++n)g.push({name:"photo_id[]",value:l[n]});a.photos.massPost({photo_id:g,url:"?module=photo&action=delete",dataType:"json",data:{photos_length:a.isArray(b)?b.length:1},success:function(v,y){if("ok"==v.status){q=q.concat(v.data.denied_photo_id);
v=0;for(var x=q.length;v<x;++v)y.push({name:"denied_photo_id[]",value:q[v]})}},fullSuccess:function(v){if("ok"==v.status)if(a.isArray(b)){v.data.alert_msg&&alert(v.data.alert_msg);var y={};a.each(l,function(A,D){y[D]=D});v.data.denied_photo_id&&v.data.denied_photo_id.length&&a.each(v.data.denied_photo_id,function(A,D){delete y[D]});y=a.map(y,function(A,D){a.photos.photo_stream_cache.deleteById(l[A]);return D});a("#photo-list li.selected").trigger("select",!1);y.length?a.photos.makeDeleteAnimation(y,
function(){d&&d(v)}):d&&d(v)}else{q.length&&alert($_("You don't have sufficient access rights"));if(v.data.parent_id){var x=a.photos.getHashByPhotoId(v.data.parent_id);a.photos.photo_stack_cache.deleteById(l)}else{var w=a.photos.photo_stream_cache;x=(x=w.getNext(b))?a.photos.getHashByPhotoId(x.id):w.hash;w.deleteById(l)}a.wa.setHash(x);d&&d(v)}else d&&d(v)}})}},"json")},deleteAllAlbums:function(b,d,g){if(!b.length)return g&&g();var l=b.shift();a.photos.deleteAlbum(l,d,function(){a.photos.deleteAllAlbums(b,
d,g)})},deleteAlbum:function(b,d,g){d?a.photos._deleteAlbumWithPhotos(b,g):a.post("?module=album&action=delete",{album_id:b},function(l){"ok"==l.status&&(a.photos.onDeleteAlbum(b),a.photos.goToHash(""),"function"==typeof g&&g())},"json")},_deleteAlbumWithPhotos:function(b,d){a.post("?module=photo&action=resolution",{album_id:b},function(g){if("ok"==g.status){g=g.data.photo_id;for(var l=[],q=0,n=g.length;q<n;++q)l.push({name:"photo_id[]",value:g[q]});l.length?a.photos.massPost({url:"?module=photo&action=delete",
photo_id:l,dataType:"json",fullSuccess:function(r){"ok"==r.status?a.photos.deleteAlbum(b,0,d):console&&console.log("Error while delete album")}}):a.photos.deleteAlbum(b,0,d)}},"json")},serializeData:function(b,d){if("object"===typeof b&&!a.isArray(b)&&"undefined"===typeof d){var g=[];for(d in b)b.hasOwnProperty(d)&&g.push({name:d,value:b[d]});return g}a.isArray(b)||(b=[b]);g=0;for(var l=b.length,q=b[0];g<l;q=b[++g])"object"!=typeof q&&(q={name:d,value:q}),b[g]=q;return b},saveAccess:function(b){function d(r){for(var v=
[],y=[],x=[],w=0,A=r.length;w<A;++w)v.push({name:"photo_id[]",value:r[w]});a.photos.massPost({photo_id:v,url:"?module=photo&action=manageAccessSave",dataType:"json",data:l,success:function(D,J){if("ok"==D.status){y=y.concat(D.data.denied_photo_id);for(var L=0,C=y.length;L<C;++L)J.push({name:"denied_photo_id[]",value:y[L]});x=D.data.allowed_photo_id;D=0;for(L=x.length;D<L;++D)J.push({name:"allowed_photo_id[]",value:x[D]})}},fullSuccess:function(D){"ok"==D.status&&D.data.alert_msg&&n(D.data.alert_msg);
"function"===typeof q&&q(D,x)}})}var g=b.photo_id||[],l=b.data||[],q=b.fn,n=b.onDeniedExist||function(r){alert(r)};b="boolean"===typeof b.resolution?b.resolution:!0;"object"!==typeof l||a.isArray(l)||(l=a.photos.serializeData(l));l.push({name:"photos_length",value:g.length});b?a.post("?module=photo&action=resolution",a.isArray(g)?g:{photo_id:g},function(r){"ok"==r.status&&d(r.data.photo_id)},"json"):d(a.isArray(g)?g:[g])},addToAlbums:function(b){var d=b.photo_id||[],g=b.album_id||[],l=void 0==b.copy?
1:b.copy,q=b.fn,n=b.onDeniedExist||function(r){alert(r)};d=a.photos.serializeData(d,"photo_id[]");g=a.photos.serializeData(g,"album_id[]");b=d.concat(g);b.push({name:"copy",value:+l});a.post("?module=photo&action=addToAlbums",b,function(r){if("ok"==r.status){for(var v=[].concat(r.data.albums||[],r.data.old_albums||[]),y=0,x=v.length;y<x;++y){var w=v[y];a("#album-list li[rel="+w.id+"]").find(".count:first").text(w.count).end().find(".count-new:first").text(0<w.count_new?"+"+w.count_new:"")}r.data.alert_msg&&
n(r.data.alert_msg)}"function"==typeof q&&q(r)},"json")},assignTags:function(b){var d=b.photo_id||[],g=b.tags||[],l=b.delete_tags||[],q=b.fn,n=b.onDeniedExist||function(r){alert(r)};b=[];b=a.isArray(d)?d:b.concat([{name:"photo_id[]",value:d},{name:"one_photo",value:1}]);a.isArray(g)&&g.length?b=b.concat(g):(b.push({name:"tags",value:g}),l.length&&(b=b.concat(l)));a.post("?module=photo&action=assignTags",b,function(r){if("ok"==r.status){var v=r.data.cloud,y=a("#tag-cloud-block");a.isArray(v)&&!v.length||
!v?y.hide():(a("#tag-cloud").html(tmpl("template-tag-cloud",{cloud:v})),y.show());v=r.data.tags||{};for(var x in v)v.hasOwnProperty(x)&&(y=v[x],a.photos._updateStreamCache(x,{tags:y}));a("#album-create-dialog").remove();r.data.alert_msg&&n(r.data.alert_msg)}"function"==typeof q&&q(r)},"json")},makeStack:function(b,d){var g=b.shift();a.post("?module=photo&action=resolution",b,function(l){if("ok"==l.status){l=l.data.photo_id;for(var q=[],n=[],r=0,v=l.length;r<v;++r)l[r]!=g.value&&q.push({name:"photo_id[]",
value:l[r]});a.photos.massPost({photo_id:q,data:{parent_id:g.value,photos_length:b.length},url:"?module=stack&action=make",dataType:"json",success:function(y,x){if("ok"==y.status&&"ok"==y.status){n=n.concat(y.data.denied_photo_ids);y=0;for(var w=n.length;y<w;++y)x.push({name:"denied_photo_id[]",value:n[y]})}},fullSuccess:function(y){if("ok"==y.status){y.data.alert_msg&&alert(y.data.alert_msg);for(var x=0,w=b.length;x<w;++x)a.photos.photo_stream_cache.deleteById(b[x].value);a.photos.photo_stream_cache.updateById(y.data.parent_id,
y.data.photo);a("#photo-list li.selected").trigger("select",!1);a.photos.makeStackAnimation([g].concat(b))}}})}},"json")},makeStackAnimation:function(b,d){var g=b[0].value,l=a('li[data-photo-id="'+g+'"]'),q=l.offset(),n=a(window);(q.top<n.scrollTop()||q.top>n.scrollTop()+n.height())&&a("html, body").animate({scrollTop:q.top},300);n=[];for(var r=1;r<b.length;r++){var v=b[r].value,y=a('li[data-photo-id="'+v+'"]'),x=y.offset();x=y.clone().css({"z-index":10,position:"absolute",top:x.top,left:x.left}).insertAfter(y);
y.css({opacity:0});n.push(y.hide(300).promise());a.photos.photo_stream_cache.deleteById(v);n.push(x.animate({top:q.top,left:q.left},300).promise().done(function(){a(this).remove()}))}a.when.apply(a,n).done(function(){var w=l.hasClass("last");l.replaceWith(tmpl(a.photos.list_template,{photos:[a.photos.photo_stream_cache.getById(g)],hash:a.photos.hash,last_login_time:a.photos.options.last_login_time,options:{}}));w||a('li[data-photo-id="'+g+'"]').removeClass("last");a('li[data-photo-id="'+g+'"]').addClass("highlighted");
"function"===typeof d&&d()})},makeDeleteAnimation:function(b,d){var g={};a.each(b,function(q,n){g[n]=!0});var l=a("#photo-list").children().filter(function(){return!!g[a(this).data("photo-id")]}).animate({width:0},function(){l.remove();d&&d()})},highlightSidebarItem:function(){var b=decodeURIComponent(a.photos.hash);a("#js-app-sidebar li.selected").removeClass("selected");var d=a('#js-app-sidebar li a[href="#'+(b||"/")+'"]');d.length||(d=a('#js-app-sidebar li a[href^="#'+(b||"/")+'"]'));d.length&&
d.parents("li:first").addClass("selected")},toggleFullScreen:function(){a.storage.get("photos/maximize_photo")?a("#wa-app").addClass("p-full-screen"):a("#wa-app").removeClass("p-full-screen")},hotkey_manager:function(){function b(n){var r=n.target.type;n=n.keyCode;if(!(b.hold||"text"==r||"textarea"==r||37!=n&&39!=n)){if(39==n){if(r=a.photos.photo_stream_cache.getNext())a.photos.goToHash(a.photos.getHashByPhotoId(r.id),!1),a.photos.shift_next=!0;b.hold=!0}if(37==n){if(r=a.photos.photo_stream_cache.getPrev())a.photos.goToHash(a.photos.getHashByPhotoId(r.id),
!1),a.photos.shift_next=!0;b.hold=!0}}}function d(n){b.hold=!1}function g(n){switch(n){case 48:case 96:n=0;break;case 49:case 97:n=1;break;case 50:case 98:n=2;break;case 51:case 99:n=3;break;case 52:case 100:n=4;break;case 53:case 101:n=5;break;default:n=null}return n}function l(n){var r=n.target.type;if(!l.hold&&"text"!=r&&"textarea"!=r){var v=g(n.keyCode);"number"===typeof v&&(l.hold=!0,a("#photo").length?(n=a.photos.photo_stream_cache.getCurrent(),n.edit_rights&&a.photos.saveField(n.id,"rate",
v,function(y){"ok"==y.status&&y.data.count&&(a("#rated-count").text(0<y.data.count?y.data.count:""),a("#photo-rate").rateWidget("setOption","rate",v))})):(n=a("input[name^=photo_id]").map(function(){return this.checked?{name:"id[]",value:this.value}:null}).toArray(),n.length&&a.photos.saveField({id:n,name:"rate",value:v,fn:function(y){if("ok"==y.status){var x=y.data.allowed_photo_id&&!a.isArray(y.data.allowed_photo_id)?y.data.allowed_photo_id:{};a("#photo-list li.selected").each(function(){var w=
a(this);x[w.attr("data-photo-id")]&&a.photos.updateThumbRate(w,v)}).find("input:first").trigger("select",!1);y.data.count&&a("#rated-count").text(0<y.data.count?y.data.count:"");y.data.alert_msg&&alert(y.data.alert_msg)}}})))}}function q(){l.hold=!1}return{set:function(n){"undefined"===typeof n?a(document).bind("keydown",b).bind("keyup",d).bind("keydown",l).bind("keyup",q):"rate"===n&&a(document).bind("keydown",l).bind("keyup",q)},unset:function(){a(document).unbind("keydown",b).unbind("keyup",d).unbind("keyup",
l).unbind("keyup",q)}}}(),getHashByPhotoId:function(b){return a.photos.hash+"/photo/"+b},setLazyLoad:function(){var b=null;a(window).lazyLoad({container:"#photo-list",load:function(){b=b||a("#photo-list li").length;a(window).lazyLoad("sleep");a(".lazyloading-wrapper .lazyloading-progress").show();a(".lazyloading-wrapper .lazyloading-link").hide();a.post("?module=photo&action=loadList",{offset:b,hash:a.photos.hash},function(d){if(d.data.hash==a.photos.hash){var g=a("#photo-list");if(d.data.photos.length){var l=
a.photos.photo_stream_cache.length();a.photos.photo_stream_cache.append(d.data.photos);g.find("li.last").removeClass("last");a.photos.renderPhotoListChunk(g,l,{string:d.data.string},function(){!a.photos.total_count||a.photos.total_count>a.photos.photo_stream_cache.length()?a(window).lazyLoad("wake"):(a(".lazyloading-wrapper .lazyloading-progress").hide(),a(".lazyloading-wrapper .lazyloading-link").hide(),a(window).lazyLoad("stop"))});b+=d.data.photos.length}else a(".lazyloading-wrapper .lazyloading-progress").hide(),
a(".lazyloading-wrapper .lazyloading-link").hide(),a(window).lazyLoad("stop")}},"json")}});a(".lazyloading-wrapper a.lazyloading-link").off("click.lazyloading").on("click.lazyloading",function(){a(window).lazyLoad("force");return!1})},unsetLazyLoad:function(){a(window).lazyLoad&&a(window).lazyLoad("stop");a(".lazyloading-wrapper a.lazyloading-link").off("click.lazyloading")},getAlbum:function(){return this.album=this.album||null},setAlbum:function(b){this.album=b},unsetAlbum:function(){this.album=
null},getPhotoId:function(){var b=/photo\/(\d+)[\/]*$/.exec(location.href);return b?parseInt(b[1]):null},isCurrentPhotoStack:function(){var b=this.getPhotoId();return b?(b=this.photo_stream_cache.getById(b))&&0<b.stack_count:!1},goToHash:function(b,d){d="undefined"===typeof d?!0:d;b=b.replace(/^\/*/,"").replace(/\/*\s*$/,"");location.hash.replace(/^[^#]*#\/*/,"").replace(/\/*\s*$/,"")==b&&d?(a.photos.ignore_scrolltop=!0,a.photos.dispatch()):location.hash=b?"/"+b+"/":"#/"},goToAnchor:function(b){b=
a("a[name="+b+"]");b.length&&a(document).scrollTop(b.position().top)},photo_stream_cache:new PhotoStream,onCreateAlbum:function(b,d){var g=tmpl("template-album-list-item",b),l=a("#album-list");if(d){var q=l.find("li[rel="+d+"]");var n=q.find("ul:first");n.length||(q.append('<ul class="menu"></ul>'),n=q.find("ul:first"),q.find(".count:first").after('<i class="icon16 darr overhanging collapse-handler" id="album-'+d+'-handler"></i>'));n.prepend(g)}else n=l.find("ul:first"),n.length||(l.find(".p-empty-album-list").hide(),
l.prepend('<ul class="menu"><li class="drag-newposition"></li></ul>').find("ul:first")),l.find("ul:first").prepend(g);l.find(".new-item").removeClass("new-item").mouseover();b.type||(g=a("#p-upload-step2 select[name=album_id]"),d?(d=g.find("option[value="+d+"]"),g=d.text().replace(/[^-]/g,"")+"-",d.after('<option value="'+b.id+'">'+g+" "+b.name+"</option>")):g.find("optgroup").prepend('<option value="'+b.id+'">'+b.name+"</option>"))},onDeleteAlbum:function(b){var d=a("#album-list"),g=d.find("li[rel="+
b+"]"),l=g.find("ul:first"),q=g.parents("ul:first");g.hide();if(l.length){g.prev(".drag-newposition:first").remove();g.next(".drag-newposition:first").remove();var n=l.children("li");n.hide().insertAfter(g);l.remove();g.remove();n.show()}else g.next(".drag-newposition:first").remove().end().remove();q.length&&!q.find("li:not(.drag-newposition)").length&&(g=q.parent("li"),g.length&&g.find("i.collapse-handler").remove(),q.remove());d.find("ul:first").length||d.find(".p-empty-album-list").show();a("#p-upload-step2 select[name=album_id]").find("option[value="+
b+"]").remove()},fixRightToolbar:function(){a.photos.fixRightToolbar._handler=function d(){var g=a("#p-toolbar");g.length&&(g.hasClass("rendered")?g.removeClass("p-fixed"):(d.top||(d.top=g.children(":first").position().top),a(this).scrollTop()>d.top?g.addClass("p-fixed"):g.removeClass("p-fixed")))};a.photos.fixRightToolbar._handler.call(document);a(document).bind("scroll",a.photos.fixRightToolbar._handler)},photo_stack_cache:new PhotoStream,isSelectedAnyPhoto:function(){return!!a("#photo-list li.selected:first").length},
getRatingHtml:function(b,d,g){b=Math.round(2*b)/2;if(!b&&!g)return"";d="";for(g=1;5>=g;g+=1)d+='<i class="fa-star',d=g>b?.5==g-b?d+"-half fas":d+" far":d+" fas",d+='" data-rate-value="'+g+'"></i>';return d},uploadDialog:function(){a.get("?module=upload").done(function(b){a.waDialog({html:b,onOpen:function(d,g){a.photos.onUploadDialog(d,g)}})})},dialogClearSteps:function(){var b=a(this);b.find("#p-upload-step2").hide();b.find("#p-upload-step2-buttons").hide();b.find("#p-upload-step3").hide();b.find("#p-upload-step3-buttons").hide();
b.find("#p-upload-step1").show();b.find("#p-upload-step1-buttons").show()},onUploadDialog:function(b,d){b.find(".files").empty();var g=a.storage.get("photos/hash"),l=b.find("#p-upload-step2 select[name=album_id]");g&&~g.indexOf("album")?(g=parseInt(g.replace(/\/?album\//,"")),g=l.find("optgroup option[value="+g+"]"),g.length?g.attr("selected",!0):l.find("option:first").attr("selected",!0)):l.find("option:first").attr("selected",!0);b.find("form").on("submit",function(q){q.preventDefault();a(this).find("#p-start-upload-button").click()});
a(document).on("fileuploadsend fileuploaddone",function(){d.resize()})},massPost:function(b){function d(x){r?(v?(l=v.splice(0,g),b.data=q.concat(l)):b.data=q,r-=g,r=0<r?r:0,a.ajax(b)):"function"==typeof b.fullSuccess&&b.fullSuccess(x)}var g=b.chunk_count||25,l,q=[];if(a.isArray(b.data))q=q.concat(b.data);else if("object"==typeof b.data)for(var n in b.data)q.push({name:n,value:b.data[n]});b.type="post";var r=parseInt(b.count)||0,v=b.photo_id;if(b.photo_id){v=b.photo_id;if(a.isArray(v))v=[].concat(v);
else{q.push({name:"photo_id",value:v});b.data=q;b.success=b.fullSuccess;a.ajax(b);return}r=v.length}if("function"==typeof b.success){var y=b.success;b.success=function(x){y(x,q);d(x)}}else b.success=d;d()},confirmDialog:function(b){var d=a("#confirm-dialog");d.length||(d=a('<div id="confirm-dialog"></div>'),a("body").append(d));b.url&&d.load(b.url,function(){var g=a.extend({},b);delete g.url;var l=a(this),q=g.onOpen,n=g.onSubmit,r=g.attr||null;g.onOpen=function(v,y){if(r)for(var x in r)r.hasOwnProperty(x)&&
v.attr(x,r[x]);v.find("input[type=submit]").focus();"function"===typeof q&&q(v,y);if("function"===typeof n)v.find("form").on("submit",function(w){w.preventDefault();n(v,y)})};delete g.onSubmit;g.$wrapper=l.find("div:first");a.waDialog(g)})},showServerError:function(b){b?(console&&console.log("Server error occurred:\n"+b),alert(b)):console&&console.log("Server error occurred")},initAlbumThumbsDragAndDrop:function(b,d){b.sortable({delay:100,delayOnTouchOnly:!0,animation:150,forceFallback:!0,ghostClass:"album-list-ghost",
chosenClass:"album-list-chosen",dragClass:"album-list-drag",onEnd:function(g){g=a(g.item);var l=g.find("[onclick]"),q=l.attr("onclick");l.attr("onclick","javascript:void(0);");setTimeout(function(){return l.attr("onclick",q)},500);a.post("?module=album&action=move",{id:g.data("album-id"),before_id:g.next().data("album-id")||0,parent_id:d})}})},initPhotoThumbsDragAndDrop:function(b,d){b.sortable({delay:100,delayOnTouchOnly:!0,animation:150,forceFallback:!0,ghostClass:"photo-list-ghost",chosenClass:"photo-list-chosen",
dragClass:"photo-list-drag",onEnd:function(g){g=a(g.item);var l=[],q=g.next().data("photo-id")||0,n=g.find("[onclick]"),r=n.attr("onclick");n.attr("onclick","javascript:void(0);");setTimeout(function(){return n.attr("onclick",r)},500);l.push(g.data("photo-id"));a.post("?module=album&action=photoMove",{photo_id:l,album_id:d,before_id:q},function(v){"ok"==v.status&&a.photos.photo_stream_cache.move(l,q)},"json")}})},hooks_manager:{handlers:{},bind:function(b,d,g){if(1==arguments.length&&arguments[0]&&
"object"===typeof arguments[0]){var l=arguments[0];for(b in l)l.hasOwnProperty(b)&&this.bind(b,l[b])}else return g=g||(""+Math.random()).slice(2),this.handlers[b]=this.handlers[b]||{},this.handlers[b][g]=d,d.handler_name=g},unbind:function(b,d){var g=d;"undefined"===typeof d?this.handlers[b]={}:("function"===typeof d&&(g=d.handler_name),"function"===typeof this.handlers[b][g]&&delete this.handlers[b][g])},trigger:function(b){var d=this.handlers[b];if(d&&"object"===typeof d){var g=Array.prototype.slice.call(arguments,
1),l;for(l in d)d.hasOwnProperty(l)&&"function"===typeof d[l]&&d[l].apply(null,g)}}}}})(jQuery);
$(function(){$(".p-one-photo .next").on("click",function(){$.photos.shift_next=!0});$(".dialog").off().on("change_loading_status",function(a,c){c=c||!1;a=$(this).find("input[type=submit]");c?a.attr("disabled",!0).after('<i class="fas fa-spin fa-spinner loading"></i>'):a.attr("disabled",!1).next("i").remove()});(function(){var a=!1;$(document).on("selectstart","#photo-list",function(){return!a});$(document).keydown(function(c){16==c.keyCode&&(a=!0)}).keyup(function(c){16==c.keyCode&&(a=!1)})})();$(document).on("select",
"#photo-list li",function(a,c,e){e=void 0!==e?e:!0;(void 0!==c?c:1)?$(this).addClass("selected").find("input:first").attr("checked",!0):(a=$("#selector-menu").find('[data-action="select-photos"]'),a.data("checked")&&a.data("checked",!1).find(".unchecked").show().end().find(".checked").hide(),$(this).removeClass("selected").find("input:first").attr("checked",!1));e&&$(".js-toolbar-dropdown-button").trigger("recount")});(function(){function a(f,h,b){if(f&&h&&f[0]&&h[0]&&!f.is(h[0])){var d=!1;h.parent().children().each(function(g,
l){if(d){if(f.is(l)||h.is(l))return!1;g=$(l).find(".p-details input:checkbox");g.prop("checked")!=b&&g.prop("checked",b).change()}else if(f.is(l)||h.is(l))d=!0})}}var c=null,e=null;$("#content").on("click","#photo-list li .p-details input:checkbox, #photo-list li .p-details label, #photo-list li .p-details .wa-checkbox",function(f){var h=$(this).closest("li"),b=h.find(".p-details input:checkbox");if(b.is(f.target))var d=b.prop("checked");else d=!b.prop("checked"),b.prop("checked",d).change();d?(f.shiftKey&&
c&&a(c,h,!0),c=h,e=null):(f.shiftKey&&e&&a(e,h,!1),c=null,e=h);h=$(".js-toolbar-dropdown");f=$(".js-toolbar-dropdown-button").find(".js-count");h=h.parent();b=$('#photo-list :checkbox[name="photo_id[]"]:checked').length;h.toggleClass("is-fixed",!!b);b?f.text(b).show():f.empty().hide()})})();$("#content").off($.photos.namespace+"-photo-list-select-checkbox").on("change"+$.photos.namespace+"-photo-list-select-checkbox",':checkbox[name="photo_id[]"]',function(){this.checked?$(this).closest("li").addClass("selected"):
$(this).closest("li").removeClass("selected");$(".js-toolbar-dropdown-button").trigger("recount")});$.photos.hooks_manager.bind("afterLoadPhoto",function(){$.photos.photo_stream_cache.getPrev()?$("#p-block .p-one-photo > .p-image-nav.p-rewind").show():$("#p-block .p-one-photo > .p-image-nav.p-rewind").hide();$.photos.photo_stream_cache.getNext()?$("#p-block .p-one-photo > .p-image-nav.p-ff").show():$("#p-block .p-one-photo > .p-image-nav.p-ff").hide()});$.photos_dragndrop.init()});
function ToolbarMenu(a,c){var e=null;return{init:function(){e=$(a);e.length&&e.activeMenu(c);return this},enable:function(f){f?e.activeMenu("enable",f):(e.parents("section:first").show(),e.activeMenu("fire"));return this},disable:function(f){f?e.activeMenu("disable",f):e.parents("section:first").hide();return this},setAction:function(f,h){c[f]=h;e&&e.activeMenu("setOption",f,h);return this},getAction:function(f){return c[f]},is:function(f){return e?e.is(f):$(a).is(f)}}};(function(a){a.photos.menu.register("list","#share-menu",{embedAction:function(){var c=a("#embed-photo-list-dialog"),e=a.storage.get("photos/embed_size"),f=a("#photo-list li.selected").map(function(){var g=a(this).attr("data-photo-id"),l=a.photos.photo_stream_cache.getById(g);0>=l.status&&(g+=":"+l.hash);return g}).toArray().join(","),h=a.photos.getAlbum(),b=a.photos.hash,d={photo_ids:f,hash:b,size:e};h&&0>=h.status&&(b=b.replace(/\/*$/,"")+":"+h.hash+"/",d.hash=b);h="?module=dialog&action=embedPhotoList&photo_ids="+
f+"&hash="+b;e&&(h+="&size="+e);c.length||(c=a('<div id="embed-photo-list-dialog"></div>'),a("body").append(c));c.load(h,function(){a.waDialog({$wrapper:c.find("div:first"),onOpen:function(g,l){function q(w){var A=q.data,D=!1,J;for(J in A)if(A.hasOwnProperty(J)&&A[J]!==w[J]){D=!0;break}q.data=a.extend({},w);D&&(g.find(".dialog-header").find(".loading").parent().show(),a.post("?module=photo&action=embedList",w,function(L){if("ok"==L.status){var C=L.data.context;g.find("input[name=link]").val(C.link);
g.find("a.link").attr("href",C.link);g.find("textarea[name=urls]").val(C.urls);y.val(C.html);v.val(C.html_with_descriptions);g.find("textarea[name=smarty_code]").val(C.smarty_code);g.find("h1 span:first").text("("+C.count+")");C.all_public?g.find(".exclamation-message").hide():g.find(".exclamation-message").show();C.domains=C.domains||{};x.children().each(function(){var H=a(this),T=H.attr("value");H.data("frontend-url",(C.domains[T]||{}).frontend_url||"")});n();r()}g.find(".dialog-header").find(".loading").parent().hide()},
"json"))}function n(){a.each(["textarea[name=urls]","#embed-photo-list-html","#embed-photo-list-html-with-descriptions"],function(w,A){w=a(A);w.data("context_data",w.val())})}function r(){if(!x.length)return!1;a.each(["textarea[name=urls]","#embed-photo-list-html","#embed-photo-list-html-with-descriptions"],function(A,D){A=a(D);A.val(A.data("context_data").split(x.data("original-domain")).join(x.val()))});var w=x.children(":selected");w.data("frontend-url")?(g.find("input[name=link]").val(w.data("frontend-url")).closest(".field").slideDown(),
g.find("a.link").attr("href",w.data("frontend-url"))):g.find("input[name=link]").closest(".field").slideUp()}l=g.find("select[name=size]");var v=a("#embed-photo-list-html-with-descriptions"),y=a("#embed-photo-list-html");e&&l.val(e);l.change(function(){var w=a(this).val();d.size=w;q(d);a.storage.set("photos/embed_size",w)});g.find("input[name=description]").on("click",function(){this.checked?(v.show().attr("disabled",!1),y.hide().attr("disabled",!0)):(y.show().attr("disabled",!1),v.hide().attr("disabled",
!0))});g.find("input[name=link], textarea[name=urls], textarea[name=html], textarea[name=smarty_code]").on("click",function(){var w=a(this);w.getSelection().length||w.select()});g.find("input[name=link]").focus().select();g.find(".switcher").activeMenu({selectedPhotosAction:function(w){d.size=g.find("select[name=size]").val();d.photo_ids=f;q(d)},allListPhotosAction:function(w){d.size=g.find("select[name=size]").val();d.photo_ids="";q(d)}}).find("li").click(function(){a(this).parent().find(".selected").removeClass("selected").end().addClass("selected")});
q.data=q.data||a.extend({},d);var x=g.find("select[name=domain]");x.length&&(n(),r(),x.change(r))}})});return!1},beforeAnyAction:function(c){if(!a.photos.isSelectedAnyPhoto()&&"blog-post"!=c&&"embed"!=c)return alert($_("Please select at least one photo")),!1},blogPostAction:function(){for(var c=a("#blog-post-form"),e=[].concat($jscomp.arrayFromIterable(document.querySelectorAll("#photo-list li.selected"))).map(function(g){return g.getAttribute("data-photo-id")}),f=[0,0],h=0;h<e.length;h++){var b=
a.photos.photo_stream_cache.getById(e[h]);b||(b=a.photos.photo_stack_cache.getById(e[h]));b&&(b.hash&&(e[h]+=":"+b.hash),++f[b.status])}h=a.photos.getAlbum();b=a.photos.hash;var d={photo_ids:e.join(","),hash:b,size:obligatory_size};h&&0>=h.status&&(b=b.replace(/\/*$/,"")+":"+h.hash+"/",d.hash=b);d.hash=null;a("#photo-blog-dialog :submit").attr("disabled",!0);a.post("?module=photo&action=embedList",d,function(g){"ok"==g.status&&(g=g.data.context,c.find('[name="title"]:input').val(a("#photo-list-name").text()),
c.find('[name="text"]:input').val(blog_smarty_enabled?g.smarty_code:g.html_with_descriptions),f[0]?a("#photo-blog-dialog :submit").attr("disabled",!1):c.submit())},"json");f[0]&&(h=a("#photo-blog-dialog").clone(),a.waDialog({$wrapper:h,onOpen:function(g){var l=g.find('[type="submit"]');g=g.find("p");var q=[f[0],e.length];g.html(g.html().replace(/(%d)/g,function(){return q.shift()}));l.on("click",function(n){n.preventDefault();c.submit()})}}));return!1},onFire:function(){a(".js-toolbar-dropdown-button").trigger("recount")}});
a.photos.menu.register("list","#organize-menu",{addToAlbumAction:function(){var c=a("#choose-albums");c.length&&c.parent().remove();a("<div></div>").appendTo("body").load("?module=dialog&action=albums",function(){a.waDialog({$wrapper:a("#choose-albums"),onOpen:function(e,f){e.find("h3:first span:first").text("("+a("#photo-list li.selected").length+")");var h=e.find('[type="submit"]'),b=e.find("form");h.on("click",function(d){d.preventDefault();d=a("input[name^=photo_id]").serializeArray();var g=b.serializeArray();
if(!g.length)return alert($_("Please select at least one album")),!1;if(!d.length)return f.close(),!1;e.trigger("change_loading_status",!0);a.photos.addToAlbums({photo_id:d,album_id:g,copy:1,fn:function(){a("#photo-list li.selected").trigger("select",!1);e.trigger("change_loading_status",!1);f.close()}})})}})})},assignTagsAction:function(){var c=$_("add a tag"),e=a("#photo-list-tags-dialog"),f=e.clone(),h;a.waDialog({$wrapper:f,onOpen:function(b,d){var g=b.find("#photos-list-tags"),l=[],q={},n=a.photos.photo_stream_cache.getAll(),
r=b.find("#photos-tags-remove-list"),v=b.find("#photo-tags-remove"),y=b.find("form"),x=a("input[name^=photo_id]:checked"),w=b.find("#photos-popular-tags");h=e.detach();b.find(".tagsinput").length||(a.fn.tagsInput.bind(g),g.tagsInput({autocomplete_url:"?module=tag&action=list",height:200,width:"100%",defaultText:c}));g.importTags("");b.find(".js-selected-counter").text("("+x.length+")");x.each(function(){l.push(a(this).val())});for(var A={},D=0,J=a.photos.photo_stream_cache.length();D<J;A={$jscomp$loop$prop$p$18:A.$jscomp$loop$prop$p$18},
D++)if(A.$jscomp$loop$prop$p$18=n[D],l.some(function(T){return function(X){return X==T.$jscomp$loop$prop$p$18.id}}(A))){var L=A.$jscomp$loop$prop$p$18.tags;if(!a.isEmptyObject(L))if(a.isEmptyObject(q))q=L;else for(var C in L)L.hasOwnProperty(C)&&(q[C]=L[C])}r.empty();if(jQuery.isEmptyObject(q))v.hide();else{v.show();for(var H in q)r.append(a("<label></label>").text(q[H]).prepend('<input name="delete_tags[]" value="'+H+'" type="checkbox"> ')).append("<br>")}w.off("click.photos","a").on("click.photos",
"a",function(){var T=a(this).text();g.removeTag(T);g.addTag(T)});q=b.find("#photos-list-tags_tag");q.length&&q.val()!=c&&(n=jQuery.Event("keypress",{which:13}),q.trigger(n));y.on("submit",function(T){T.preventDefault();T=x.serializeArray();var X=g.val(),ma=r.find("input[name^=delete_tags]:checked").serializeArray();console.log(X);console.log(a("#photo-list-tags-dialog #photos-list-tags").val());if(!X.length&&!ma.length)return alert($_("Please select at least one tag")),!1;if(!T.length)return d.close(),
!1;b.trigger("change_loading_status",!0);a.photos.assignTags({photo_id:T,tags:X,delete_tags:ma,fn:function(Y){if("ok"==Y.status){Y=Y.data.tags;var da=a("#photo-list li.selected"),pa;for(pa in Y)if(Y.hasOwnProperty(pa)){var qa=tmpl("template-photo-list-photo-tags",{tags:Y[pa]});da.filter("[data-photo-id="+pa+"]:first").find(".tags>span").html(qa)}da.trigger("select",!1);b.trigger("change_loading_status",!1);d.close()}}})})},onClose:function(){a("body").append(h)}})},deleteFromAlbumAction:function(){var c=
a("input[name^=photo_id]").serializeArray();if(c.length){var e=a.photos.getAlbum().id;a.post("?module=photo&action=deleteFromAlbum&id="+e,c,function(){a.photos.dispatch()},"json")}},deletePhotosAction:function(){var c=a("input[name^=photo_id]").serializeArray();c.length&&a.photos.confirmDialog({url:"?module=dialog&action=confirmDeletePhotos&cnt="+c.length,onSubmit:function(e,f){e.trigger("change_loading_status",!0);a.photos.deletePhotos(c,function(){a.photos.unsetCover();e.trigger("change_loading_status",
!1);a("#photo-list li.selected").trigger("select",!1);f.close()});return!1}})},setRateAction:function(){a.photos.confirmDialog({url:"?module=dialog&action=rates",attr:{id:"set-rate"},onOpen:function(c,e){c.find(".p-rate-photo-counter").text("("+a("input[name^=photo_id]:checked").length+")");var f=c.find("#photos-rate");f.rateWidget({withClearAction:!1,onUpdate:function(){var h=f.rateWidget("getOption","rate"),b=a("input[name^=photo_id]").map(function(){return this.checked?{name:"id[]",value:this.value}:
null}).toArray();if(!b.length)return e.close(),!1;a.photos.saveField({id:b,name:"rate",value:h,fn:function(d){if("ok"==d.status){d=d.data;var g=d.allowed_photo_id&&!a.isArray(d.allowed_photo_id)?d.allowed_photo_id:{};a("#photo-list li.selected").each(function(){var l=a(this);g[l.attr("data-photo-id")]&&a.photos.updateThumbRate(l,h)}).find("input:first").trigger("select",!1);d.count&&a("#rated-count").text(0<d.count?d.count:"");d.alert_msg&&alert(d.alert_msg);e.close()}}});return!1}})}})},makeStackAction:function(){var c=
a("input[name^=photo_id]").serializeArray();if(2>c.length)return alert($_("Please select at least two photos")),!1;a.photos.makeStack(c);return!1},manageAccessAction:function(){var c=a("input[name^=photo_id]").serializeArray();a.photos.showManageAccessDialog(c,function(e,f){var h=e.serializeArray(),b=e.find("input[name=status]:checked").val();c.length||f.close();e.trigger("change_loading_status",!0);var d=a("#photo-list li.selected");a.photos.saveAccess({photo_id:c,data:h,fn:function(g,l){g=0;for(var q=
l.length;g<q;++g){var n=d.filter("[data-photo-id="+l[g]+"]:first").find(".p-image-corner.top.left");n.find(".fa-lock").remove();0>=b&&n.append('<i class="fas fa-lock p-private-photo" title="'+$_("Private photo")+'"></i>')}a.photos._updateStreamCache(l,{status:b});d.trigger("select",!1);e.trigger("change_loading_status",!1);f.close()}});return!1});return!1},beforeAnyAction:function(c){if("make-stack"!=c&&!a.photos.isSelectedAnyPhoto())return alert($_("Please select at least one photo")),!1},onFire:function(){a(".js-toolbar-dropdown-button").trigger("recount")}});
a.photos.menu.register("list","#save-menu",{saveDescriptionAction:function(){var c={},e,f,h;a("#photo-list.p-descriptions :text,#photo-list.p-descriptions textarea").each(function(){if(this.defaultValue!=this.value&&(e=a(this).attr("name").match(/^photo\[(\d+)\]\[(\w+)\]$/))){f=e[1];h=e[2];var d=a.photos.photo_stream_cache.getById(f);d&&this.value==d[h]||(c[f]||(c[f]={id:f}),c[f][h]=this.value)}});a.photos.saveFields(c);a("#photo-list.p-descriptions :text.highlighted,#photo-list.p-descriptions textarea.highlighted").each(function(){a(this).removeClass("highlighted")});
var b=a(".js-toolbar-dropdown-button > .js-count");b.length&&(b.text(0),a("#save-menu-block input.button").removeClass("yellow"),b.hide());return!1},hideNameAction:function(c,e){var f=c.find(":checkbox"),h=f.prop("checked");"INPUT"!=e.target.tagName&&(h=!h);h?(a('#photo-list li :text[name$="[name]"]').hide(),a('#photo-list li textarea[name$="[description]"].js-small').css("height","+=27").removeClass("js-small").addClass("js-big")):(a('#photo-list li :text[name$="[name]"]').show(),a('#photo-list li textarea[name$="[description]"].js-big').css("height",
"-=27").removeClass("js-big").addClass("js-small"));setTimeout(function(){f.attr("checked",h)},50);a.storage.set("photos/list/hide_name",h)},onFire:function(){var c=a(".js-toolbar-dropdown-button > .js-count");c.length&&(c.text("0"),a("#save-menu-block input.button").removeClass("yellow"),c.hide())},onInit:function(c){c.find('[data-action="hide-name"] :checkbox').prop("checked",a.storage.get("photos/list/hide_name",!1));c=function(){var e=[],f;a("#photo-list.p-descriptions :text,#photo-list.p-descriptions textarea").each(function(){if(this.defaultValue!=
this.value&&(f=a(this).attr("name").match(/^photo\[(\d+)\]\[(\w+)\]$/))){var d=f[1];if(0>e.indexOf(d)){var g=a.photos.photo_stream_cache.getById(d);g&&this.value==g[f[2]]?a(this).hasClass("highlighted")&&a(this).removeClass("highlighted"):(a(this).addClass("highlighted"),e.push(d))}}else a(this).hasClass("highlighted")&&a(this).removeClass("highlighted")});var h=a(".js-toolbar-dropdown-button > .js-count"),b=e.length;h.length&&h.text(b);b?(a("#save-menu-block input.button").addClass("yellow"),h.show()):
(a("#save-menu-block input.button").removeClass("yellow"),h.hide())};a("#p-content").on("change.photos-save-menu","#photo-list.p-descriptions :text, #photo-list.p-descriptions textarea",c);a("#p-content").on("keyup.photos-save-menu","#photo-list.p-descriptions :text, #photo-list.p-descriptions textarea",c)}});a.photos.menu.register("list","#selector-menu",{selectPhotosAction:function(c){var e=a(".js-toolbar-dropdown-button > .js-count");c.data("checked")?(c.data("checked",!1),c.find(".unchecked").show().end().find(".checked").hide(),
e.text("").hide()):(c.data("checked",!0),c.find(".checked").show().end().find(".unchecked").hide(),e.text(a.photos.total_count).show());a("#photo-list li").trigger("select",[!!c.data("checked"),!1])}});a("#p-sidebar a, #wa-header a, #js-photos-view-toggle button, #photo-list div.p-image a").on("click",function(c){if(a("#save-menu-block").is(":visible")&&a("#save-menu-block input.button").hasClass("yellow")&&!confirm($_("Unsaved changes will be lost if you leave this page now. Are you sure?")))return c.preventDefault(),
!1})})(jQuery);(function(a){a.photos.menu.register("photo","#photo-organize-menu",{addToAlbumAction:function(){a.photos.confirmDialog({url:"?module=dialog&action=albums&id="+a.photos.getPhotoId(),onSubmit:function(c){var e=a.photos.photo_stream_cache.getCurrent().id;a.photos.addToAlbums({photo_id:e,album_id:a(this).serializeArray(),copy:0,fn:function(f){if("ok"==f.status){var h=f.data.old_albums||[],b=a.photos.getAlbum();f=f.data.albums;if(b)for(var d=0,g=h.length;d<g;++d)if(b.id==h[d].id){f.length?a.photos.goToHash("/album/"+
f[0].id+"/photo/"+e):a.photos.goToHash("/photo/"+e);c.trigger("close");return}a("#photo-albums").html(tmpl("template-photo-albums",{albums:f}));c.trigger("close")}}});return!1}})},deletePhotoAction:function(){a.photos.confirmDialog({url:"?module=dialog&action=confirmDeletePhoto&id="+a.photos.getPhotoId(),onSubmit:function(c){c.trigger("close");a.photos.setCover();a.photos.deletePhotos(a.photos.getPhotoId(),function(){a.photos.unsetCover()});return!1}})},unstackAction:function(){a.photos.confirmDialog({url:"?module=dialog&action=confirmUnstack&cnt="+
a.photos.photo_stack_cache.length(),onSubmit:function(c){c.trigger("close");c=a.photos.photo_stream_cache.getCurrent().id;a.post("?module=stack&action=unmake&id="+c,{},function(e){a.photos.goToHash(a.photos.hash)},"json");return!1}})},manageAccessAction:function(){var c=a.photos.photo_stream_cache.getCurrent().id;a.photos.showManageAccessDialog("photo_id="+c,function(e){var f=a(this).serializeArray();f.push({name:"one_photo",value:1});a.photos.saveAccess({photo_id:a.photos.photo_stream_cache.getCurrent().id,
data:f,fn:function(h){var b=h.data.photo,d=h.data.stack;if(b)b=a.photos.photo_stream_cache.updateById(b.id,b),a.photos.initPhotoContentControlWidget({frontend_link_template:h.data.frontend_link_template,photo:b}),a.photos.updatePhotoImgs(b);else if(d&&a.isArray(d)&&d.length){b=a.photos.photo_stack_cache;for(var g=b.getCurrent(),l=0,q=d.length;l<q;++l)b.updateById(d[l].id,d[l]);a.photos.initPhotoContentControlWidget({frontend_link_template:h.data.frontend_link_template,photo:g});a.photos.updatePhotoImgs(g)}e.trigger("close")},
onDeniedExist:function(){alert($_("You don't have sufficient access rights"))}});return!1});return!1}});a.photos.menu.register("photo","#edit-menu",{beforeAnyAction:function(){a.photos.setCover(!0)},rotateLeftAction:function(){a.photos.rotate(a.photos.getPhotoId(),"left",function(){a.photos.unsetCover(!0)})},rotateRightAction:function(){a.photos.rotate(a.photos.getPhotoId(),"right",function(){a.photos.unsetCover(!0)})},onInit:function(){}});a.photos.menu.register("photo","#share-menu",{embedAction:function(){var c=
a("#embed-photo-dialog-wrapper"),e=a.photos.getPhotoId(),f=a.photos.hash,h=a.storage.get("photos/embed_size");e="?module=dialog&action=embedPhoto&photo_id="+e+"&hash="+f;h&&(e+="&size="+h);c.length||(c=a('<div id="embed-photo-dialog-wrapper"></div>'),a("body").append(c));c.load(e,function(){a.waDialog({$wrapper:a("#embed-photo-dialog"),onOpen:function(b){function d(){q.length&&a.each(["textarea[name=html]","input[name=url]"],function(n,r){n=a(r);n.data("context_data",n.val())})}function g(){if(!q.length)return!1;
a.each(["textarea[name=html]","input[name=url]"],function(r,v){r=a(v);r.val(r.data("context_data").split(q.data("original-domain")).join(q.val()))});var n=q.children(":selected");n.data("frontend-url")?(b.find("input[name=link]").val(n.data("frontend-url")).closest(".field").slideDown(),b.find("a.link").attr("href",n.data("frontend-url"))):b.find("input[name=link]").closest(".field").slideUp()}var l=b.find("select[name=size]");l.val(h);l.change(function(){var n=a(this).val(),r=b.data("contexts")[n];
b.find("textarea[name=html]").val(r.html);b.find("input[name=url]").val(r.url);a.storage.set("photos/embed_size",n);d();g()});var q=b.find("select[name=domain]");q.length&&(d(),g(),q.change(g));b.find("input[name=url], textarea[name=html], input[name=link]").on("click",function(){a(this).getSelection().length||a(this).select()});b.find("input[name=link]").focus().select()}})});return!1},blogPostAction:function(){var c=a("#blog-post-form"),e=a.photos.getPhotoId(),f=a.photos.photo_stream_cache.getById(e);
f||(f=a.photos.photo_stack_cache.getById(e));f&&(e=f.id,f.hash&&(e+=":"+f.hash),e={photo_ids:e,hash:null,size:obligatory_size},a("#photo-blog-dialog :submit").attr("disabled",!0),a.post("?module=photo&action=embedList",e,function(h){"ok"==h.status&&(h=h.data.context,c.find('[name="title"]:input').val(f.name),h=h.html_with_descriptions,c.find('[name="text"]:input').val(h.replace(/^<p>(.*)<\/p>$/mi,"$1")),parseInt(f.status)?c.submit():a("#photo-blog-dialog :submit").attr("disabled",!1))},"json"),parseInt(f.status)||
a("#photo-blog-dialog").waDialog({onLoad:function(){a("#photo-blog-dialog :submit").attr("disabled",!0);var h=a("#photo-blog-dialog p"),b=[1,1];h.html(h.html().replace(/(%d)/g,function(){return b.shift()}))},onSubmit:function(){c.submit();return!1}}));return!1}})})(jQuery);$.photos=$.photos||{};$.photos.widget=$.photos.widget||{};
$.photos.widget.loupe={options:{animate:!0,debug:!1},css:{init:{width:null,"max-width":null,"margin-left":0,"margin-top":0,height:null}},drag:!1,loaded:!1,photo_data:null,thumb_data:null,container:null,helper:null,link:null,offset:{},status:"thumb",image_container_width:0,image_container_height:0,image_width:0,image_height:0,init:function(a){this.options=$.extend(this.options,a||{});var c=this;c.trace("init");$.photos.hooks_manager.bind("afterRenderImg",function(e,f,h){c.trace("afterRenderImg");c.prepare(e,
f,h)});$.photos.hooks_manager.bind("beforeLoadPhoto",function(){c.trace("beforeLoadPhoto")});$.photos.hooks_manager.bind("onAbortPrevLoading",function(){c.trace("onAbortPrevLoading")})},trace:function(a){console&&this.options.debug&&console.log(a)},prepare:function(a,c,e){var f=this;$(".p-one-photo a.next").off("click.loupe").on("click.loupe",function(h){return f.clickNextHandler.apply(f,[this,h])});this.trace("prepare, status="+this.status);this.photo_data=c;this.container=a;a=this.container.closest(".p-one-photo");
this.image_container_width=a.width();this.image_container_height=a.height();this.image_width=this.container.width();this.image_height=this.container.height();this.thumb_data={height:this.image_height,width:this.image_width,src:e.url2x};c.height>=this.image_container_height?this.container.css({width:this.image_width+"px",height:this.image_height+"px"}):this.container.css({width:e.size.width+"px",height:e.size.height+"px"});window.addEventListener("resize",function(){var h=f.container.closest(".p-one-photo");
f.image_container_width=h.width();f.image_container_height=h.height();f.image_width=f.container.width();f.image_height=f.container.height();f.thumb_data={height:f.image_height,width:f.image_width,src:e.url2x};c.height>=f.image_container_height?f.container.css({width:f.image_width+"px",height:f.image_height+"px"}):f.container.css({width:e.size.width+"px",height:e.size.height+"px"})});"thumb"!=this.status&&this.stop();this.loaded=!1;this.reset()},reset:function(){var a=this;this.trace("reset, status="+
this.status);this.link=$("#photo-loupe-link");$("div.photo-loupe-wrapper").length&&(this.container.css({width:this.image_width+"px","max-width":"",height:this.image_height+"px","margin-left":"","margin-top":""}),this.container.unwrap());this.status="thumb";this.link.find(".minimize").hide();this.image_container_width&&this.image_container_width<this.photo_data.width||this.image_container_height&&this.image_container_height<this.photo_data.height?(this.link.find(".maximize").show(),this.options.animate=
this.image_container_height&&this.image_container_width?!0:!1):this.link.find(".maximize").hide();this.link.unbind(".loupe").bind("click.loupe",function(c){return a.clickHandler.apply(a,[this,c])}).show();window.addEventListener("resize",function(){a.image_container_width&&a.image_container_width<a.photo_data.width||a.image_container_height&&a.image_container_height<a.photo_data.height?(a.link.find(".maximize").show(),a.options.animate=a.image_container_height&&a.image_container_width?!0:!1):a.link.find(".maximize").hide();
a.link.unbind(".loupe").bind("click.loupe",function(c){return a.clickHandler.apply(a,[this,c])}).show()})},clickHandler:function(){this.trace("clickHandler, status="+this.status);switch(this.status){case "loading":this.container.stop();case "maximized":this.status="unloading";this.link.find(".minimize").hide();this.link.find(".maximize").show();this.decrease();break;case "thumb":this.status="loading",this.link.find(".minimize").hide(),this.link.find(".maximize").hide(),this.enlarge()}return!1},clickNextHandler:function(a,
c){(a="thumb"==this.status?!0:!1)||c.preventDefault();this.trace("clickNextHandler "+a);return a},interaction:function(a,c,e){e=e.parents("body");switch(c.type){case "mouseup":this.drag&&(c.preventDefault(),this.drag=!1,$("div.photo-loupe-wrapper").css("cursor","auto"),$("body").css("cursor",""),e.unbind(".loupe-move"));break;case "mousedown":case "click":this.clickNextHandler(a,c);if(!this.drag){$("div.photo-loupe-wrapper").css("cursor","move");this.drag=!0;this.offset.mouseX=c.pageX;this.offset.mouseY=
c.pageY;var f=this;e.bind("mouseover.loupe-move mousemove.loupe-move",function(h){return f.watch.apply(f,[this,h])})}break;case "mouseleave":this.drag&&(c.preventDefault(),$("div.photo-loupe-wrapper").css("cursor","auto"),this.drag=!1,e.unbind(".loupe-move"))}},enlarge:function(){this.drag=!1;var a=this;this.trace("enlarge, status="+this.status);$("#photo").removeClass("ui-draggable").closest(".p-image").addClass("p-image-maximized");this.offset=this.container.offset();this.offset.x=Math.round((this.image_container_width-
this.photo_data.width)/2);this.offset.y=Math.round((this.image_container_height-this.photo_data.height)/2);this.container.wrap('<div class="photo-loupe-wrapper" style="height:'+this.image_container_height+"px;width:"+this.image_container_width+'px;position: relative;"/>');window.addEventListener("resize",function(){this.offset=this.container.offset();this.offset.x=Math.round((this.image_container_width-this.photo_data.width)/2);this.offset.y=Math.round((this.image_container_height-this.photo_data.height)/
2);this.container.wrap('<div class="photo-loupe-wrapper" style="height:'+this.image_container_height+"px;width:"+this.image_container_width+'px;position: relative;"/>')});this.container.removeAttr("width").removeAttr("height").css({width:this.image_width+"px",height:this.image_height+"px","margin-left":0,"margin-top":0,"max-height":this.photo_data.height+"px","max-width":this.photo_data.width+"px",display:"inline-block"});this.options.animate=!0;this.options.animate?this.container.animate({width:this.photo_data.width+
"px",height:this.photo_data.height+"px","margin-left":this.offset.x+"px","margin-top":this.offset.y+"px","max-height":this.photo_data.height+"px","max-width":this.photo_data.width+"px"},function(){a.enlargeComplete.apply(a,[this])}):(this.container.css({width:this.photo_data.width+"px",height:this.photo_data.height+"px","margin-left":this.offset.x+"px","margin-top":this.offset.y+"px","max-width":this.photo_data.width+"px"}),this.enlargeComplete());this.link.find(".minimize").show();this.bind(this.container);
if(!this.helper){var c=$("#photo-loupe");this.helper=c.length?c.first():$('<img id="photo-loupe"/>');this.helper.load(function(e){a.loaded=!0})}this.helper.attr("src","?module=photo&action=download&photo_id="+this.photo_data.id+"&attach="+(this.photo_data.edit_datetime||this.photo_data.upload_datetime))},enlargeComplete:function(){if(this.loaded)this.trace("enlargeComplete, status="+this.status),this.helper.css({width:this.photo_data.width+"px",height:this.photo_data.height+"px","margin-left":this.offset.x+
"px","margin-top":this.offset.y+"px","max-width":this.photo_data.width+"px"}).show(),this.container.before(this.helper).hide(),this.container.unbind(".loupe .loupe-move"),this.bind(this.helper),this.container.css({width:this.thumb_data.width+"px","max-width":"",height:this.thumb_data.height+"px","margin-left":"","margin-top":""}),this.link.find(".minimize").show(),this.status="maximized";else{var a=this;setTimeout(function(){return a.enlargeComplete.apply(a,[this])},50)}},bind:function(a){this.trace("bind, status="+
this.status);var c=this;a.bind("mousedown.loupe",function(e){return c.interaction.apply(c,[this,e,a])});$(document).bind("mouseup.loupe",function(e){return c.interaction.apply(c,[this,e,a])})},stop:function(){this.trace("stop at status="+this.status);var a=this.status;this.status="stop";switch(a){case "loading":this.container.stop();this.decrease(!0);break;case "maximized":this.decrease(!0);break;case "unloading":this.helper&&this.helper.stop(),this.decreaseComplete(!0)}this.container&&this.container.find("*").unbind(".loupe .loupe-move");
$(document).unbind(".loupe .loupe-move");a=$("div.photo-loupe-wrapper");$("#photo-loupe-link img:visible").hide();$("body").css("cursor","");a.length&&this.container.unwrap();this.helper&&(this.helper.remove(),this.helper=null);this.status="thumb"},decrease:function(a){this.trace("decrease, status="+this.status);this.loaded=!1;var c=this,e=this.photo_data.height>=this.image_container_height?{width:this.image_width+"px",height:this.image_height+"px","margin-left":0,"margin-top":0}:{width:this.thumb_data.width+
"px",height:this.thumb_data.height+"px","margin-left":0,"margin-top":0};a||!this.options.animate?(this.helper.css(e),c.decreaseComplete()):this.helper.animate(e,function(){c.decreaseComplete()});return!1},decreaseComplete:function(a){this.trace("decreaseComplete, status="+this.status);$("#photo").addClass("ui-draggable").closest(".p-image").removeClass("p-image-maximized");this.container.css(this.css.init).show();this.helper.hide();a||this.reset()},watch:function(a,c){this.drag&&(c.preventDefault(),
this.offset.x=Math.min(0,Math.max(this.image_width-this.photo_data.width,Math.round(this.offset.x-this.offset.mouseX+c.pageX))),this.offset.y=Math.min(0,Math.max(this.image_height-this.photo_data.height,Math.round(this.offset.y-this.offset.mouseY+c.pageY))),this.offset.mouseX=c.pageX,this.offset.mouseY=c.pageY,("loading"==this.status?this.container:this.helper).css({"margin-left":this.offset.x+"px","margin-top":this.offset.y+"px"}))}};(function(){jQuery.each({getSelection:function(){var a=this.jquery?this[0]:this;return("selectionStart"in a&&function(){var c=a.selectionEnd-a.selectionStart;return{start:a.selectionStart,end:a.selectionEnd,length:c,text:a.value.substr(a.selectionStart,c)}}||document.selection&&function(){a.focus();var c=document.selection.createRange();if(null===c)return{start:0,end:a.value.length,length:0};var e=a.createTextRange(),f=e.duplicate();e.moveToBookmark(c.getBookmark());f.setEndPoint("EndToStart",e);
return{start:f.text.length,end:f.text.length+c.text.length,length:c.text.length,text:c.text}}||function(){return null})()},replaceSelection:function(a){var c="function"==typeof this.id?this.get(0):this,e=a||"";return("selectionStart"in c&&function(){c.value=c.value.substr(0,c.selectionStart)+e+c.value.substr(c.selectionEnd,c.value.length);return this}||document.selection&&function(){c.focus();document.selection.createRange().text=e;return this}||function(){c.value+=e;return jQuery(c)})()}},function(a){jQuery.fn[a]=
this})})();
